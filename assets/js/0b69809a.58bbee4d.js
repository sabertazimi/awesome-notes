"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[53788],{17156:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>u,frontMatter:()=>i,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"programming/android/storage","title":"Storage","description":"Files","source":"@site/content/programming/android/storage.md","sourceDirName":"programming/android","slug":"/programming/android/storage","permalink":"/notes/programming/android/storage","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/programming/android/storage.md","tags":[{"inline":true,"label":"Programming","permalink":"/notes/tags/programming"},{"inline":true,"label":"Android","permalink":"/notes/tags/android"},{"inline":true,"label":"Storage","permalink":"/notes/tags/storage"},{"inline":true,"label":"File","permalink":"/notes/tags/file"},{"inline":true,"label":"Database","permalink":"/notes/tags/database"},{"inline":true,"label":"Preference","permalink":"/notes/tags/preference"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":11,"frontMatter":{"sidebar_position":11,"tags":["Programming","Android","Storage","File","Database","Preference"]},"sidebar":"tutorialSidebar","previous":{"title":"Broadcast","permalink":"/notes/programming/android/broadcast"},"next":{"title":"Service","permalink":"/notes/programming/android/service"}}');var a=t(35656),l=t(86145);const i={sidebar_position:11,tags:["Programming","Android","Storage","File","Database","Preference"]},s="Storage",d={},c=[{value:"Files",id:"files",level:2},{value:"Shared Preferences",id:"shared-preferences",level:2},{value:"SQLite",id:"sqlite",level:2},{value:"Create Table",id:"create-table",level:3},{value:"Operators",id:"operators",level:3},{value:"Transactions",id:"transactions",level:3},{value:"Content Provider",id:"content-provider",level:2},{value:"Read",id:"read",level:3},{value:"Provide",id:"provide",level:3}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"storage",children:"Storage"})}),"\n",(0,a.jsx)(n.h2,{id:"files",children:"Files"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.code,{children:"/data/data/<packageName>/files/"})}),"\n",(0,a.jsx)(n.p,{children:"Write"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'String data = "Data to save";\nFileOutputStream out = null;\nBufferedWriter writer = null;\ntry {\n    out = openFileOutput("data", Context.MODE_PRIVATE);\n    writer = new BufferedWriter(new OutputStreamWriter(out));\n    writer.write(data);\n} catch (IOException e) {\n    e.printStackTrace();\n} finally {\n    try {\n        if (writer != null) {\n            writer.close();\n        }\n    } catch (IOException e) {\n        e.printStackTrace();\n    }\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"Read"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'FileInputStream in = null;\nBufferedReader reader = null;\nStringBuilder content = new StringBuilder();\ntry {\n    in = openFileInput("data");\n    reader = new BufferedReader(new InputStreamReader(in));\n    String line = "";\n    while ((line = reader.readLine()) != null) {\n        content.append(line);\n    }\n} catch (IOException e) {\n    e.printStackTrace();\n} finally {\n    if (reader != null) {\n        try {\n            reader.close();\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n}\n\nreturn content.toString();\n'})}),"\n",(0,a.jsx)(n.h2,{id:"shared-preferences",children:"Shared Preferences"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.code,{children:"/data/data/<packageName>/shared_preferences/"})}),"\n",(0,a.jsx)(n.p,{children:"Write"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'//get Editor\nSharedPreferences.Editor editor = getSharedPreferences("data", MODE_PRIVATE).edit();\n//store date\neditor.putString("name", "Tom");\neditor.putInt("age", 28);\neditor.putBoolean("married", false);\n//commit\neditor.commit();\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"editor.clear();\n"})}),"\n",(0,a.jsx)(n.p,{children:"clear pref file content"}),"\n",(0,a.jsx)(n.p,{children:"Read"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'SharedPreferences pref = getSharedPreferences("data", MODE_PRIVATE);\n//second argument - default value if target key don\'t exists\nString name = pref.getString("name", "");\nint age = pref.getInt("age", 0);\nboolean married = pref.getBoolean("married", false);\n'})}),"\n",(0,a.jsx)(n.h2,{id:"sqlite",children:"SQLite"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.code,{children:"/data/data/<package name>/databases/"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'@Override\nonCreate()\n@Override\npublic void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {\n    switch (oldVersion) {\n        case 1:\n            db.execSQL(CREATE_CATEGORY);\n        case 2:\n            db.execSQL("alter table Book add column category_id integer");\n        default:\n    }\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:["Custom \u5b9e\u73b0\u521b\u5efa\u3001\u5347\u7ea7\u6570\u636e\u5e93\u7684\u903b\u8f91\n\u6784\u5efa\u51fa SQLiteOpenHelper \u7684\u5b9e\u4f8b\u540e,\u518d\u8c03\u7528",(0,a.jsx)(n.code,{children:"getReadableDatabase()"}),"\u6216",(0,a.jsx)(n.code,{children:"getWritableDatabase()"}),"\u65b9\u6cd5\u521b\u5efa\u6570\u636e\u5e93"]}),"\n",(0,a.jsx)(n.h3,{id:"create-table",children:"Create Table"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"create table Book (\n    id integer primary key autoIncrement,\n    author text,\n    price real,\n    pages integer,\n    name text\n    )\n"})}),"\n",(0,a.jsx)(n.h3,{id:"operators",children:"Operators"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u6570\u636e\u5e93\u5e76\u8fd4\u56de\u4e00\u4e2a SQLiteDatabase \u5bf9\u8c61"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"Context.createDatabase(String name,int version ,int mode,CursorFactory factory);\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u5220\u9664\u6570\u636e\u5e93"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'this.deleteDatabase("myDatabase.db");\n'})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u6253\u5f00\u6570\u636e\u5e93"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'SQLiteDatabase my_DataBase =\nthis.openOrCreateDatabase("myDateBase.db",MODE_PRIVATE , null);\nmy_DataBase.close();\n'})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u975e\u67e5\u8be2 SQL \u6307\u4ee4"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'//\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a"test"\u5e76\u5e26\u4e24\u4e2a\u53c2\u6570\u7684\u8868\nmy_DataBase.execSQL("CREATE TABLE test (_id INTEGER PRIMARY KEY,\nsomeNumber INTEGER);");\n//\u5728\u6570\u636e\u5e93\u4e2d\u63d2\u5165\u4e00\u4e2a\u5143\u7ec4\nmy_DataBase.execSQL("INSERT INTO test (_id,someNumber) values(1,8);");\n\nSQLiteDatabase db = dbHelper.getWritableDatabase();\n\n//INSERT\nContentValues values = new ContentValues();\n// \u5f00\u59cb\u7ec4\u88c5\u7b2c\u4e00\u6761\u6570\u636e\nvalues.put("name", "The Da Vinci Code");\nvalues.put("author", "Dan Brown");\nvalues.put("pages", 454);\nvalues.put("price", 16.96);\ndb.insert("Book", null, values); // \u63d2\u5165\u7b2c\u4e00\u6761\u6570\u636e\nvalues.clear();\n// \u5f00\u59cb\u7ec4\u88c5\u7b2c\u4e8c\u6761\u6570\u636e\nvalues.put("name", "The Lost Symbol");\nvalues.put("author", "Dan Brown");\nvalues.put("pages", 510);\nvalues.put("price", 19.95);\ndb.insert("Book", null, values); // \u63d2\u5165\u7b2c\u4e8c\u6761\u6570\u636e\n\n//update\nContentValues values = new ContentValues();\nvalues.put("price", 10.99);\ndb.update("Book", values, "name = ?", new String[] { "The DaVinci Code"  });\n\n//delete\ndb.delete("Book", "pages > ?", new String[] { "500"  });\n\n//\u5220\u9664\u8868\nmy_DataBase.execSQL("DROP TABLE test");\n'})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\u67e5\u8be2 SQL \u6307\u4ee4-\u6e38\u6807 Cursors","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"query()"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{style:{textAlign:"left"},children:"\u65b9\u6cd5\u53c2\u6570"}),(0,a.jsx)(n.th,{style:{textAlign:"left"},children:"\u5bf9\u5e94 SQL \u90e8\u5206"}),(0,a.jsx)(n.th,{style:{textAlign:"left"},children:"\u63cf\u8ff0"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"table"}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"from tableName"}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"\u6307\u5b9a\u67e5\u8be2\u7684\u8868\u540d"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"columns"}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"select column1, column2"}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"\u6307\u5b9a\u67e5\u8be2\u7684\u5217\u540d"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"selection"}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"where column = value"}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"\u6307\u5b9a where \u7684\u7ea6\u675f\u6761\u4ef6"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"selectionArgs"}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"-"}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"\u4e3a where \u4e2d\u7684\u5360\u4f4d\u7b26\u63d0\u4f9b\u5177\u4f53\u7684\u503c"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"groupBy"}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"group by column"}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"\u6307\u5b9a\u9700\u8981 group by \u7684\u5217"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"having"}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"having column = value"}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"\u5bf9 group by \u540e\u7684\u7ed3\u679c\u8fdb\u4e00\u6b65\u7ea6\u675f"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"orderBy"}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"order by column1, column2"}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"\u6307\u5b9a\u67e5\u8be2\u7ed3\u679c\u7684\u6392\u5e8f\u65b9\u5f0f"})]})]})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'SQLiteDatabase db = dbHelper.getWritableDatabase();\n// \u67e5\u8be2Book\u8868\u4e2d\u6240\u6709\u7684\u6570\u636e\nCursor cursor = db.query("Book", null, null, null, null, null, null);\n// \u904d\u5386Cursor\u5bf9\u8c61,\u53d6\u51fa\u6570\u636e\n//cursor.moveToFirst()\n//cursor.moveToNext()\nString name = cursor.getString(cursor.getColumnIndex("name"));\nString author = cursor.getString(cursor.getColumnIndex("author"));\nint pages = cursor.getInt(cursor.getColumnIndex("pages"));\ndouble price = cursor.getDouble(cursor.getColumnIndex("price"));\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'//\u4e3a\u4e86\u521b\u5efa\u4e00\u4e2aCursor(\u6e38\u6807),\u5fc5\u987b\u6267\u884c\u4e00\u4e2a\u67e5\u8be2,\u8981\u4e48\u901a\u8fc7SQL\u4f7f\u7528rawQuery()\u65b9\u6cd5\n//\u6216\u662f\u66f4\u7cbe\u5fc3\u8bbe\u8ba1\u7684\u65b9\u6cd5,\u50cfquery()\u65b9\u6cd5\nCursor cur = my_DataBase.rawQuery("SELECT * FORM test", null);\n\nif(cur!=null) {//\u6e38\u6807\u4e0d\u4e3a\u7a7a\n    //\u8fd4\u56de\u7ed9\u5b9a\u540d\u79f0\u7684\u5217\u7684\u57fa\u4e8e0\u5f00\u59cb\u7684index,\u5982\u679c\u8be5\u5c5e\u6027\u5217\u4e0d\u5b58\u5728\u5219\u8fd4\u56de-1\n    //\u901a\u8fc7\u5b83\u4eec\u7684index\u6765\u68c0\u7d22\u5c5e\u6027\u503c\n    int numColumn=cur.getColumnIndex("someNumber");\n\n    if(cur.moveToFirst()) {\n        //cur.moveToFirst()\u8ba9\u6e38\u6807\u6307\u5411\u7b2c\u4e00\u884c,\u5982\u679c\u6e38\u6807\u6307\u5411\u7b2c\u4e00\u884c,\u5219\u8fd4\u56detrue\n        do {\n        int num=cur.getInt(numColumn);//\u83b7\u5f97\u5f53\u524d\u884c\u8be5\u5c5e\u6027\u7684\u503c\n        /*Cursor\u63d0\u4f9b\u4e86\u4e0d\u540c\u7684\u65b9\u6cd5\u6765\u56de\u7d22\u4e0d\u540c\u7684\u6570\u636e\u7c7b\u578b\n        \u4f8b\u5982getInt(int index)/getString(int index)\u7b49\u7b49*/\n        /*\u505a\u4e00\u4e9b\u4e8b\u60c5*/\n        } while (cur.moveToNext());\n        /*\u6e38\u6807\u79fb\u52a8\u5230\u4e0b\u4e00\u884c,\u5982\u679c\u6e38\u6807\u5df2\u7ecf\u901a\u8fc7\u4e86\u7ed3\u679c\u96c6\u4e2d\u7684\u6700\u540e,\n        \u5373\u6ca1\u6709\u884c\u53ef\u4ee5\u79fb\u52a8\u65f6,\u5219\u8fd4\u56defalse*/\n        //\u5176\u4ed6\u53ef\u80fd\u79fb\u52a8\u7684\u662f previous() \u548cfirst()\u65b9\u6cd5\n    }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"transactions",children:"Transactions"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["SQLiteDatabase \u7684",(0,a.jsx)(n.code,{children:"beginTransaction()"}),"\u65b9\u6cd5"]}),"\n",(0,a.jsxs)(n.li,{children:["\u8c03\u7528",(0,a.jsx)(n.code,{children:"setTransactionSuccessful()"}),"\u8868\u793a\u4e8b\u52a1\u5df2\u7ecf\u6267\u884c\u6210\u529f"]}),"\n",(0,a.jsxs)(n.li,{children:["finally \u4ee3\u7801\u5757\u4e2d\u8c03\u7528",(0,a.jsx)(n.code,{children:"endTransaction()"}),"\u6765\u7ed3\u675f\u4e8b\u52a1"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"content-provider",children:"Content Provider"}),"\n",(0,a.jsx)(n.h3,{id:"read",children:"Read"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'Uri uri = Uri.parse("content://com.example.app.provider/table1");\ngetContentResolver().query/insert/delete/update();\n'})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"ContactsContract.CommonDataKinds.Phone.DISPLAY_NAME"}),"\n",(0,a.jsx)(n.li,{children:"ContactsContract.CommonDataKinds.Phone.NUMBER"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"provide",children:"Provide"}),"\n",(0,a.jsx)(n.p,{children:"With ContentProvider:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"public class MyProvider extends ContentProvider {\n    @Override\n    public boolean onCreate() {\n        return false;\n    }\n    @Override\n    public Cursor query(Uri uri, String[] projection, String selection,\n      String[] selectionArgs, String sortOrder) {\n        return null;\n    }\n    @Override\n    public Uri insert(Uri uri, ContentValues values) {\n        return null;\n    }\n    @Override\n    public int update(Uri uri, ContentValues values, String selection,\n      String[] selectionArgs) {\n        return 0;\n    }\n    @Override\n    public int delete(Uri uri, String selection, String[] selectionArgs) {\n        return 0;\n    }\n    @Override\n    public String getType(Uri uri) {\n        return null;\n    }\n}\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"UriMatcher.addURI(uri, customNumber)/.match(uri)\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u4e3a\u4f20\u5165 URI \u6307\u5b9a\u81ea\u5b9a\u4e49\u5e38\u91cf\u4f5c\u4e3a\u4ee3\u53f7"}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}},86145:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>s});var r=t(57140);const a={},l=r.createContext(a);function i(e){const n=r.useContext(l);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);