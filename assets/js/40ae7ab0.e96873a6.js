"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[96843],{99828:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"web/react/testing","title":"Testing","description":"Mindset","source":"@site/content/web/react/testing.md","sourceDirName":"web/react","slug":"/web/react/testing","permalink":"/notes/web/react/testing","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/react/testing.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"React","permalink":"/notes/tags/react"},{"inline":true,"label":"Testing","permalink":"/notes/tags/testing"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":18,"frontMatter":{"sidebar_position":18,"tags":["Web","React","Testing"]},"sidebar":"tutorialSidebar","previous":{"title":"Performance","permalink":"/notes/web/react/performance"},"next":{"title":"Styled Components","permalink":"/notes/web/react/style"}}');var s=t(35656),i=t(86145);const c={sidebar_position:18,tags:["Web","React","Testing"]},o="Testing",l={},a=[{value:"Mindset",id:"mindset",level:2},{value:"Installation",id:"installation",level:2},{value:"Events",id:"events",level:2},{value:"FireEvent",id:"fireevent",level:3},{value:"UserEvent",id:"userevent",level:3},{value:"Hooks",id:"hooks",level:2},{value:"Async",id:"async",level:3},{value:"Error",id:"error",level:3},{value:"APIs",id:"apis",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"References",id:"references",level:2}];function d(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"testing",children:"Testing"})}),"\n",(0,s.jsx)(n.h2,{id:"mindset",children:"Mindset"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"User behavior"})," and ",(0,s.jsx)(n.code,{children:"A11Y"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Rather than tests focusing on the ",(0,s.jsx)(n.strong,{children:"implementation"})," (props and state) (Enzyme),\ntests are more focused on ",(0,s.jsx)(n.strong,{children:"user behavior"})," (react-testing-library)."]}),"\n",(0,s.jsxs)(n.li,{children:["React testing library enforce to\nuse ",(0,s.jsx)(n.code,{children:"placeholder"}),", ",(0,s.jsx)(n.code,{children:"aria"}),", ",(0,s.jsx)(n.code,{children:"test-ids"})," to access elements,\nbenefiting for a11y components\n(write tests > build accessible components > tests pass)."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"But sometimes may need to test the internals of the component\nwhen just testing the DOM from user\u2019s perspective may not make sense."}),"\n",(0,s.jsx)(n.p,{children:"So depending on the use cases,\nwe can choose between these two libraries\nor just install them all for individual use cases."}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Enzyme for Internal API, React testing library for user behavior."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"pnpm add -D @testing-library/react @testing-library/dom @testing-library/jest-dom @testing-library/user-event\n"})}),"\n",(0,s.jsx)(n.h2,{id:"events",children:"Events"}),"\n",(0,s.jsx)(n.h3,{id:"fireevent",children:"FireEvent"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"fireEvent"})," trigger DOM event: ",(0,s.jsx)(n.code,{children:"fireEvent(node, event)"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"fireEvent.*"})," helpers for default event types:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"click fireEvent.click(node)."}),"\n",(0,s.jsxs)(n.li,{children:["See ",(0,s.jsx)(n.a,{href:"https://github.com/testing-library/dom-testing-library/blob/main/src/event-map.js",children:"all supported events"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"import { fireEvent, render, wait } from '@testing-library/react'\nimport { api } from './api'\nimport { App } from './App'\n\n// Normally you can mock entire module using jest.mock('./api);\nconst mockCreateItem = (api.createItem = jest.fn())\n\ntest('allows users to add items to their list', async () => {\n  const todoText = 'Learn spanish'\n  mockCreateItem.mockResolvedValueOnce({ id: 123, text: todoText })\n\n  const { getByText, getByLabelText } = render(<App />)\n\n  const input = getByLabelText('What needs to be done?')\n  const button = getByText('Add #1')\n\n  fireEvent.change(input, { target: { value: todoText } })\n  fireEvent.click(button)\n\n  await wait(() => getByText(todoText))\n\n  expect(mockCreateItem).toBeCalledTimes(1)\n  expect(mockCreateItem).toBeCalledWith('/items', expect.objectContaining({ text: todoText }))\n})\n"})}),"\n",(0,s.jsx)(n.h3,{id:"userevent",children:"UserEvent"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://testing-library.com/docs/ecosystem-user-event",children:"User Event"}),"\nprovides more advanced simulation of browser interactions\nthan the built-in ",(0,s.jsx)(n.code,{children:"fireEvent method"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"pnpm add -D @testing-library/user-event @testing-library/dom\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"import { render, screen } from '@testing-library/react'\nimport userEvent from '@testing-library/user-event'\n\ntest('click', () => {\n  render(\n    <div>\n      <label htmlFor=\"checkbox\">Check</label>\n      <input id=\"checkbox\" type=\"checkbox\" />\n    </div>,\n  )\n\n  userEvent.click(screen.getByText('Check'))\n  expect(screen.getByLabelText('Check')).toBeChecked()\n})\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"/**\n * render: render the component\n * screen: finding elements along with user\n */\nimport { render, screen } from '@testing-library/react'\nimport userEvent from '@testing-library/user-event'\nimport { Checkbox, Welcome } from './'\n\ndescribe('Welcome should', () => {\n  test('has correct welcome message', () => {\n    render(<Welcome firstName=\"John\" lastName=\"Doe\" />)\n    expect(screen.getByRole('heading')).toHaveTextContent('Welcome, John Doe')\n  })\n\n  test('has correct input value', () => {\n    render(<Welcome firstName=\"John\" lastName=\"Doe\" />)\n    expect(screen.getByRole('form')).toHaveFormValues({\n      firstName: 'John',\n      lastName: 'Doe',\n    })\n  })\n\n  test('handles click correctly', () => {\n    render(<Checkbox />)\n    userEvent.click(screen.getByText('Check'))\n    expect(screen.getByLabelText('Check')).toBeChecked()\n  })\n})\n"})}),"\n",(0,s.jsx)(n.h2,{id:"hooks",children:"Hooks"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { useCallback, useState } from 'react'\n\nexport default function useCounter(initialValue = 0) {\n  const [count, setCount] = useState(initialValue)\n  const increment = useCallback(() => setCount(x => x + 1), [])\n  const reset = useCallback(() => setCount(initialValue), [initialValue])\n  return { count, increment, reset }\n}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { act, renderHook } from '@testing-library/react-hooks'\nimport useCounter from './useCounter'\n\ntest('should reset counter to updated initial value', () => {\n  const { result, rerender } = renderHook(({ initialValue }) => useCounter(initialValue), {\n    initialProps: { initialValue: 0 },\n  })\n\n  rerender({ initialValue: 10 })\n\n  act(() => {\n    result.current.reset()\n  })\n\n  expect(result.current.count).toBe(10)\n})\n"})}),"\n",(0,s.jsx)(n.h3,{id:"async",children:"Async"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { use, useCallback, useState } from 'react'\n\nexport default function useCounter(initialValue = 0) {\n  const [count, setCount] = useState(initialValue)\n  const step = use(CounterStepContext)\n  const increment = useCallback(() => setCount(x => x + step), [step])\n  const incrementAsync = useCallback(() => setTimeout(increment, 100), [increment])\n  const reset = useCallback(() => setCount(initialValue), [initialValue])\n  return { count, increment, incrementAsync, reset }\n}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { renderHook } from '@testing-library/react-hooks'\nimport useCounter from './useCounter'\n\ntest('should increment counter after delay', async () => {\n  const { result, waitForNextUpdate } = renderHook(() => useCounter())\n  result.current.incrementAsync()\n  await waitForNextUpdate()\n  expect(result.current.count).toBe(1)\n})\n"})}),"\n",(0,s.jsx)(n.h3,{id:"error",children:"Error"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { use, useCallback, useState } from 'react'\n\nexport default function useCounter(initialValue = 0) {\n  const [count, setCount] = useState(initialValue)\n  const step = use(CounterStepContext)\n  const increment = useCallback(() => setCount(x => x + step), [step])\n  const incrementAsync = useCallback(() => setTimeout(increment, 100), [increment])\n  const reset = useCallback(() => setCount(initialValue), [initialValue])\n\n  if (count > 9000)\n    throw new Error('It\\'s over 9000!')\n\n  return { count, increment, incrementAsync, reset }\n}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { act, renderHook } from '@testing-library/react-hooks'\nimport { useCounter } from './useCounter'\n\nit('should throw when over 9000', () => {\n  const { result } = renderHook(() => useCounter(9000))\n\n  act(() => {\n    result.current.increment()\n  })\n\n  expect(result.error).toEqual(new Error('It\\'s over 9000!'))\n})\n"})}),"\n",(0,s.jsx)(n.h2,{id:"apis",children:"APIs"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"getByXXX"})," queries: common use case."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"queryByXXX"})," queries: not throw error when nothing match."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"findByXXX"})," queries: ",(0,s.jsx)(n.code,{children:"getBy"})," queries + ",(0,s.jsx)(n.code,{children:"waitFor"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"API"}),(0,s.jsx)(n.th,{children:"No Match"}),(0,s.jsx)(n.th,{children:"1 Match"}),(0,s.jsx)(n.th,{children:"1+ Match"}),(0,s.jsx)(n.th,{children:"Await"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"getBy"}),(0,s.jsx)(n.td,{children:"throw"}),(0,s.jsx)(n.td,{children:"return"}),(0,s.jsx)(n.td,{children:"throw"}),(0,s.jsx)(n.td,{children:"No"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"queryBy"}),(0,s.jsx)(n.td,{children:"null"}),(0,s.jsx)(n.td,{children:"return"}),(0,s.jsx)(n.td,{children:"throw"}),(0,s.jsx)(n.td,{children:"No"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"findBy"}),(0,s.jsx)(n.td,{children:"throw"}),(0,s.jsx)(n.td,{children:"return"}),(0,s.jsx)(n.td,{children:"throw"}),(0,s.jsx)(n.td,{children:"Yes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"getAllBy"}),(0,s.jsx)(n.td,{children:"throw"}),(0,s.jsx)(n.td,{children:"array"}),(0,s.jsx)(n.td,{children:"array"}),(0,s.jsx)(n.td,{children:"No"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"queryAllBy"}),(0,s.jsx)(n.td,{children:"[]"}),(0,s.jsx)(n.td,{children:"array"}),(0,s.jsx)(n.td,{children:"array"}),(0,s.jsx)(n.td,{children:"No"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"findAllBy"}),(0,s.jsx)(n.td,{children:"throw"}),(0,s.jsx)(n.td,{children:"array"}),(0,s.jsx)(n.td,{children:"array"}),(0,s.jsx)(n.td,{children:"Yes"})]})]})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"import { render, screen } from '@testing-library/react'\nimport userEvent from '@testing-library/user-event'\nimport TransactionCreateStepTwo from './TransactionCreateStepTwo'\n\ntest('if amount and note is entered, pay button becomes enabled', async () => {\n  render(<TransactionCreateStepTwo sender={{ id: '5' }} receiver={{ id: '5' }} />)\n\n  expect(await screen.findByRole('button', { name: /pay/i })).toBeDisabled()\n\n  userEvent.type(screen.getByPlaceholderText(/amount/i), '50')\n  userEvent.type(screen.getByPlaceholderText(/add a note/i), 'dinner')\n  expect(await screen.findByRole('button', { name: /pay/i })).toBeEnabled()\n})\n"})}),"\n",(0,s.jsxs)(n.admonition,{title:"waitFor",type:"tip",children:[(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"findBy"})," handles DOM waiting automatically,\n",(0,s.jsx)(n.code,{children:"waitFor"})," is more suitable for non-DOM things,\ne.g. function/spy was called or resolved:"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// DOM waiting\nexpect(await screen.findByText('Data loaded')).toBeInTheDocument()\n\n// Non-DOM waiting\nawait waitFor(() => expect(window.fetch).toHaveBeenCalled())\n"})})]}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Good frontend tests ",(0,s.jsx)(n.a,{href:"https://howtotestfrontend.com/resources/how-to-write-good-frontend-tests",children:"guide"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Custom Jest DOM ",(0,s.jsx)(n.a,{href:"https://github.com/testing-library/jest-dom",children:"matchers"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["React testing library ",(0,s.jsx)(n.a,{href:"https://testing-library.com/docs/react-testing-library/cheatsheet",children:"cheat sheet"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["UI testing with ",(0,s.jsx)(n.a,{href:"https://storybook.js.org/blog/how-to-automate-ui-tests-with-github-actions",children:"GitHub Actions"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["React testing ",(0,s.jsx)(n.a,{href:"https://www.robinwieruch.de/react-testing-tutorial",children:"tutorial"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Cypress testing ",(0,s.jsx)(n.a,{href:"https://glebbahmutov.com/blog/tags/cypress",children:"recipes"}),"."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},86145:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>o});var r=t(57140);const s={},i=r.createContext(s);function c(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);