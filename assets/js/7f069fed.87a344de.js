"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[37172],{54677:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"web/react/hooks/form","title":"Form","description":"State","source":"@site/content/web/react/hooks/form.md","sourceDirName":"web/react/hooks","slug":"/web/react/hooks/form","permalink":"/notes/web/react/hooks/form","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/react/hooks/form.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"React","permalink":"/notes/tags/react"},{"inline":true,"label":"Hook","permalink":"/notes/tags/hook"},{"inline":true,"label":"Form","permalink":"/notes/tags/form"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":22,"frontMatter":{"sidebar_position":22,"tags":["Web","React","Hook","Form"]},"sidebar":"tutorialSidebar","previous":{"title":"Event","permalink":"/notes/web/react/hooks/event"},"next":{"title":"Media","permalink":"/notes/web/react/hooks/media"}}');var a=t(35656),s=t(86145);const o={sidebar_position:22,tags:["Web","React","Hook","Form"]},i="Form",l={},d=[{value:"State",id:"state",level:2},{value:"Ref",id:"ref",level:2},{value:"DOM Ref",id:"dom-ref",level:2}];function f(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"form",children:"Form"})}),"\n",(0,a.jsx)(n.h2,{id:"state",children:"State"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"useState"})," for form entire state and form control data."]}),"\n",(0,a.jsxs)(n.li,{children:["Custom logic via hooks ",(0,a.jsx)(n.code,{children:"params"})," function."]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"import { useState } from 'react'\n\nfunction useForm(callback) {\n  const [values, setValues] = useState({})\n\n  const handleSubmit = (event) => {\n    if (event)\n      event.preventDefault()\n    callback()\n  }\n\n  const handleChange = (event) => {\n    event.persist()\n    setValues(values => ({\n      ...values,\n      [event.target.name]: event.target.value,\n    }))\n  }\n\n  return {\n    handleChange,\n    handleSubmit,\n    values,\n  }\n}\n\nexport default useForm\n"})}),"\n",(0,a.jsx)(n.h2,{id:"ref",children:"Ref"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"useState"})," for form entire state."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"useRef"})," for form control data."]}),"\n",(0,a.jsxs)(n.li,{children:["Custom logic via hooks ",(0,a.jsx)(n.code,{children:"params"})," function."]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"export function useField(\n  name,\n  form,\n  { defaultValue, validations = [], fieldsToValidateOnChange = [name] } = {}\n) {\n  const [value, setValue] = useState(defaultValue)\n  const [errors, setErrors] = useState([])\n  const [pristine, setPristine] = useState(true)\n  const [validating, setValidating] = useState(false)\n  const validateCounter = useRef(0)\n\n  const validate = async () => {\n    const validateIteration = ++validateCounter.current\n    setValidating(true)\n    const formData = form.getFormData()\n    let errorMessages = await Promise.all(\n      validations.map(validation => validation(formData, name))\n    )\n    errorMessages = errorMessages.filter(Boolean)\n    if (validateIteration === validateCounter.current) {\n      // this is the most recent invocation\n      setErrors(errorMessages)\n      setValidating(false)\n    }\n    return errorMessages.length === 0\n  }\n\n  useEffect(() => {\n    if (pristine)\n      return // Avoid validate on mount\n    form.validateFields(fieldsToValidateOnChange)\n  }, [value])\n\n  const field = {\n    name,\n    value,\n    errors,\n    setErrors,\n    pristine,\n    onChange: (e) => {\n      if (pristine)\n        setPristine(false)\n\n      setValue(e.target.value)\n    },\n    validate,\n    validating,\n  }\n  form.addField(field)\n  return field\n}\n\nexport function useForm({ onSubmit }) {\n  const [submitted, setSubmitted] = useState(false)\n  const [submitting, setSubmitting] = useState(false)\n  const fields = useRef([])\n\n  const validateFields = async (fieldNames) => {\n    let fieldsToValidate\n    if (Array.is(fieldNames)) {\n      fieldsToValidate = fields.current.filter(field =>\n        fieldNames.includes(field.name)\n      )\n    } else {\n      // If fieldNames not provided, validate all fields.\n      fieldsToValidate = fields.current\n    }\n    const fieldsValid = await Promise.all(\n      fieldsToValidate.map(field => field.validate())\n    )\n    return fieldsValid.every(Boolean)\n  }\n\n  const getFormData = () => {\n    return fields.current.reduce((formData, f) => {\n      formData[f.name] = f.value\n      return formData\n    }, {})\n  }\n\n  return {\n    onSubmit: async (e) => {\n      e.preventDefault()\n      setSubmitting(true)\n      setSubmitted(true) // User has attempted to submit form at least once\n      const formValid = await validateFields()\n      const returnVal = await onSubmit(getFormData(), formValid)\n      setSubmitting(false)\n      return returnVal\n    },\n    isValid: () => fields.current.every(f => f.errors.length === 0),\n    addField: field => fields.current.push(field),\n    getFormData,\n    validateFields,\n    submitted,\n    submitting,\n  }\n}\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:'interface Props {\n  label: string\n  name: string\n  value: string\n  onChange: Function\n  errors: string[]\n  setErrors: Function[]\n  pristine: boolean\n  validating: boolean\n  validate: Function\n  formSubmitted: boolean\n}\n\nexport default function Field({\n  label,\n  name,\n  value,\n  onChange,\n  errors,\n  setErrors,\n  pristine,\n  validating,\n  validate,\n  formSubmitted,\n  ...other\n}: Props) {\n  const showErrors = (!pristine || formSubmitted) && !!errors.length\n\n  return (\n    <FormControl className="field" error={showErrors}>\n      <InputLabel htmlFor={name}>{label}</InputLabel>\n      <Input\n        id={name}\n        value={value}\n        onChange={onChange}\n        onBlur={() => !pristine && validate()}\n        endAdornment={(\n          <InputAdornment position="end">\n            {validating && <LoadingIcon className="rotate" />}\n          </InputAdornment>\n        )}\n        {...other}\n      />\n      <FormHelperText component="div">\n        {showErrors\n          && errors.map(errorMsg => <div key={errorMsg}>{errorMsg}</div>)}\n      </FormHelperText>\n    </FormControl>\n  )\n}\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"export default function App(props) {\n  const form = useForm({\n    onSubmit: async (formData, valid) => {\n      if (!valid)\n        return\n      await timeout(2000) // Simulate network time\n      if (formData.username.length < 10) {\n        // Simulate 400 response from server.\n        usernameField.setErrors(['Make a longer username'])\n      } else {\n        // Simulate 201 response from server.\n        window.alert(\n          `form valid: ${valid}, form data: ${JSON.stringify(formData)}`\n        )\n      }\n    },\n  })\n\n  const usernameField = useField('username', form, {\n    defaultValue: '',\n    validations: [\n      async (formData) => {\n        await timeout(2000)\n        return formData.username.length < 6 && 'Username already exists'\n      },\n    ],\n    fieldsToValidateOnChange: [],\n  })\n  const passwordField = useField('password', form, {\n    defaultValue: '',\n    validations: [\n      formData =>\n        formData.password.length < 6\n        && 'Password must be at least 6 characters',\n    ],\n    fieldsToValidateOnChange: ['password', 'confirmPassword'],\n  })\n  const confirmPasswordField = useField('confirmPassword', form, {\n    defaultValue: '',\n    validations: [\n      formData =>\n        formData.password !== formData.confirmPassword\n        && 'Passwords do not match',\n    ],\n    fieldsToValidateOnChange: ['password', 'confirmPassword'],\n  })\n\n  const requiredFields = [usernameField, passwordField, confirmPasswordField]\n\n  return (\n    <div id=\"form-container\">\n      <form onSubmit={form.onSubmit}>\n        <Field\n          {...usernameField}\n          formSubmitted={form.submitted}\n          label=\"Username\"\n        />\n        <Field\n          {...passwordField}\n          formSubmitted={form.submitted}\n          label=\"Password\"\n          type=\"password\"\n        />\n        <Field\n          {...confirmPasswordField}\n          formSubmitted={form.submitted}\n          label=\"Confirm Password\"\n          type=\"password\"\n        />\n        <Button\n          type=\"submit\"\n          disabled={\n            !form.isValid()\n            || form.submitting\n            || requiredFields.some(f => f.pristine)\n          }\n        >\n          {form.submitting ? 'Submitting' : 'Submit'}\n        </Button>\n      </form>\n    </div>\n  )\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"dom-ref",children:"DOM Ref"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"useState"})," for form entire state."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"useRef"})," for form control data."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"Function Refs"})," bind to native ",(0,a.jsx)(n.code,{children:"<input />"})," elements."]}),"\n",(0,a.jsxs)(n.li,{children:["Custom logic via hooks ",(0,a.jsx)(n.code,{children:"return"})," function."]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"// https://github.com/react-hook-form/react-hook-form/blob/v7.29.0/src/logic/createFormControl.ts\nfunction createFormControl() {\n  return {\n    register: (name, options = {}) => {\n      // Register input filed.\n      let field = get(_fields, name)\n      const disabledIsDefined = isBoolean(options.disabled)\n\n      set(_fields, name, {\n        _f: {\n          ...(field && field._f ? field._f : { ref: { name } }),\n          name,\n          mount: true,\n          ...options,\n        },\n      })\n      _names.mount.add(name)\n\n      field\n        ? disabledIsDefined\n        && set(\n          _formValues,\n          name,\n          options.disabled\n            ? undefined\n            : get(_formValues, name, getFieldValue(field._f))\n        )\n        : updateValidAndValue(name, true, options.value)\n\n      return {\n        // Bind to Form Input Element.\n        ref: (ref: HTMLInputElement | null): void => {\n          if (ref) {\n            register(name, options)\n            field = get(_fields, name)\n\n            const fieldRef = isUndefined(ref.value)\n              ? ref.querySelectorAll\n                ? (ref.querySelectorAll('input,select,textarea')[0] as Ref)\n                || ref\n                : ref\n              : ref\n            const radioOrCheckbox = isRadioOrCheckbox(fieldRef)\n            const refs = field._f.refs || []\n\n            if (\n              radioOrCheckbox\n                ? refs.find((option: Ref) => option === fieldRef)\n                : fieldRef === field._f.ref\n            ) {\n              return\n            }\n\n            set(_fields, name, {\n              _f: {\n                ...field._f,\n                ...(radioOrCheckbox\n                  ? {\n                      refs: [...refs.filter(live), fieldRef],\n                      ref: { type: fieldRef.type, name },\n                    }\n                  : { ref: fieldRef }),\n              },\n            })\n\n            updateValidAndValue(name, false, undefined, fieldRef)\n          } else {\n            field = get(_fields, name, {})\n\n            if (field._f)\n              field._f.mount = false\n            ;(_options.shouldUnregister || options.shouldUnregister)\n            && !(isNameInFieldArray(_names.array, name) && _stateFlags.action)\n            && _names.unMount.add(name)\n          }\n        },\n        value,\n        min,\n        max,\n        required,\n        disabled,\n        ...fieldPropValues,\n      }\n    },\n    // Higher order function: onSubmit (Use Code) => onSubmit (Bind to Form Element).\n    handleSubmit: (onSubmit) => {\n      return (event: SubmitEvent) => {\n        onSubmit(this._getFormData())\n      }\n    },\n  }\n}\n\nfunction useForm() {\n  // Detailed logic handlers: DOM refs, field getter/setter, submit handler.\n  const formControl = useRef<FormControl>(createFormControl())\n  // Entire form state: valid, errors etc.\n  const formState = useState<FormState>()\n\n  return {\n    ...formControl.current,\n  }\n}\n\nexport default function App() {\n  const { register, handleSubmit } = useForm()\n  const onSubmit = data => console.log(data)\n\n  return (\n    <form onSubmit={handleSubmit(onSubmit)}>\n      <input {...register('name')} type=\"text\" />\n      <input {...register('password')} type=\"password\" />\n    </form>\n  )\n}\n"})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(f,{...e})}):f(e)}},86145:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>i});var r=t(57140);const a={},s=r.createContext(a);function o(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);