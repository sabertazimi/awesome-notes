"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[79009],{48093:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>a,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"web/react/router","title":"Router","description":"Nested","source":"@site/content/web/react/router.md","sourceDirName":"web/react","slug":"/web/react/router","permalink":"/notes/web/react/router","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/react/router.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"React","permalink":"/notes/tags/react"},{"inline":true,"label":"Router","permalink":"/notes/tags/router"},{"inline":true,"label":"Internals","permalink":"/notes/tags/internals"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":15,"frontMatter":{"sidebar_position":15,"tags":["Web","React","Router","Internals"]},"sidebar":"tutorialSidebar","previous":{"title":"Internals","permalink":"/notes/web/react/hooks/internals"},"next":{"title":"Redux","permalink":"/notes/web/react/redux/"}}');var o=t(35656),s=t(86145);const a={sidebar_position:15,tags:["Web","React","Router","Internals"]},i="Router",c={},l=[{value:"Nested",id:"nested",level:2},{value:"Protected",id:"protected",level:2},{value:"Props",id:"props",level:2},{value:"URL Params",id:"url-params",level:2},{value:"Navigation",id:"navigation",level:2},{value:"Deployment",id:"deployment",level:2},{value:"Relative Path",id:"relative-path",level:3},{value:"Webpack",id:"webpack",level:3},{value:"Express.js",id:"expressjs",level:3},{value:"Nginx",id:"nginx",level:3},{value:"Internals",id:"internals",level:2},{value:"Route",id:"route",level:3},{value:"Link",id:"link",level:3},{value:"Redirect",id:"redirect",level:3},{value:"Hooks",id:"hooks",level:3}];function d(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.header,{children:(0,o.jsx)(e.h1,{id:"router",children:"Router"})}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:'import {\n  Redirect,\n  Route,\n  BrowserRouter as Router,\n  Switch,\n} from \'react-router-dom\'\n\nclass App extends Component {\n  render() {\n    return (\n      <Router>\n        <Switch>\n          <Route exact path="/" component={Home} />\n          <Route\n            exact\n            path="/tags"\n            render={() => {\n              return <Redirect to="/tags/all" />\n            }}\n          />\n          <Route path="/tags/:tagName" component={Tags} />\n          <Route path="/posts/:mdFile" component={Post} />\n          <Route path="/book" component={Book} />\n          <Route component={NotFound} />\n        </Switch>\n      </Router>\n    )\n  }\n}\n'})}),"\n",(0,o.jsx)(e.h2,{id:"nested",children:"Nested"}),"\n",(0,o.jsxs)(e.p,{children:["In component of parent route, should render ",(0,o.jsx)(e.code,{children:"{this.props.children}"}),":"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:'import {\n  Redirect,\n  Route,\n  BrowserRouter as Router,\n  Switch,\n} from \'react-router-dom\'\n\nrender(\n  <Router>\n    <Route path="/" component={App}>\n      <Route path="/repos" component={Repos}>\n        <Route path="/repos/:userName/:repoName" component={Repo} />\n      </Route>\n    </Route>\n  </Router>,\n  document.getElementById(\'app\')\n)\n'})}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:["In ",(0,o.jsx)(e.code,{children:"App.js"}),": ",(0,o.jsx)(e.code,{children:"render() { return (<div>... {this.props.children}</ div>); }"}),"."]}),"\n",(0,o.jsxs)(e.li,{children:["In ",(0,o.jsx)(e.code,{children:"Repos.js"}),": ",(0,o.jsx)(e.code,{children:"render() { return (<div>... {this.props.children}</ div>); }"}),"."]}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"protected",children:"Protected"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"import { Redirect, Route } from 'react-router-dom'\n\ninterface Props {\n  location: string\n}\n\nexport default function PrivateRoute({\n  component,\n  toAuth,\n  ...rest\n}: {\n  component: React.Component<Props>\n  toAuth: string\n}) {\n  return (\n    <Route\n      {...rest}\n      render={(props: Props) => (\n        auth.isAuthenticated() === true\n          ? (<Component {...props} />)\n          : (\n              <Redirect\n                to={{\n                  pathname: toAuth,\n                  state: {\n                    from: props.location,\n                  },\n                }}\n              />\n            ))}\n    />\n  )\n}\n"})}),"\n",(0,o.jsx)(e.h2,{id:"props",children:"Props"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"subRoutes."}),"\n",(0,o.jsx)(e.li,{children:"id/size."}),"\n",(0,o.jsx)(e.li,{children:"etc...."}),"\n"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"import { Route } from 'react-router-dom'\n\ninterface Props {}\n\nexport default function RenderRoute({\n  component,\n}: {\n  component: React.Component<Props>\n}) {\n  return <Route render={props => <Component {...props} />} />\n}\n"})}),"\n",(0,o.jsx)(e.h2,{id:"url-params",children:"URL Params"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"import { Route } from 'react-router-dom'\n\nexport default function App() {\n  return <Route path=\"/repos/:userName/:repoName\" component={Repo} />\n}\n"})}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"// In Repo.js\nexport default function Repo() {\n  return (\n    <div>\n      <div>{this.props.params.userName}</div>\n      <div>{this.props.params.repoName}</div>\n    </div>\n  )\n}\n"})}),"\n",(0,o.jsx)(e.h2,{id:"navigation",children:"Navigation"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.code,{children:"onEnter = { () => store.dispatch(createRouteAction(params))}"}),"."]}),"\n",(0,o.jsxs)(e.li,{children:["Return ",(0,o.jsx)(e.code,{children:"<Redirect />"})," conditionally and ",(0,o.jsx)(e.code,{children:"withRouter"})," wrapper (",(0,o.jsx)(e.code,{children:"this.props.history.push('nextURL')"}),")."]}),"\n"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"import { Redirect } from 'react-router-dom'\n\nclass Login {\n  login = () => {\n    // 1. login\n    // 2. setState and pushHistory (500ms delay)\n    auth.login(() => {\n      const { from } = this.props.location.state || { from: { pathname: '/' } }\n      this.setState({ redirect: true })\n      this.props.history.push(from)\n    }, 500)\n  }\n\n  render() {\n    const { redirect } = this.state\n    const { from } = this.props.location.state || { from: { pathname: '/' } }\n\n    if (redirect)\n      return <Redirect to={from} />\n\n    return (\n      <div>\n        <button type=\"button\" onClick={this.login}>Login</button>\n      </div>\n    )\n  }\n}\n\n// apply `history` object to props of `Login` component\nconst LoginWithRouter = withRouter(Login)\nexport default LoginWithRouter\n"})}),"\n",(0,o.jsx)(e.h2,{id:"deployment",children:"Deployment"}),"\n",(0,o.jsx)(e.h3,{id:"relative-path",children:"Relative Path"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:'export default function App() {\n  const history = useHistory()\n  return (\n    <ConnectedRouter history={history} basename="/react-boilerplate">\n      <Switch>\n        <Route exact path={`${process.env.PUBLIC_URL}/`} component={Home} />\n        <Route path={`${process.env.PUBLIC_URL}/about`} component={About} />\n        <Route\n          path={`${process.env.PUBLIC_URL}/404`}\n          render={() => <Redirect to={`${process.env.PUBLIC_URL}/`} />}\n        />\n      </Switch>\n    </ConnectedRouter>\n  )\n}\n\nfunction Header() {\n  return (\n    <div>\n      <NavLink to={`${process.env.PUBLIC_URL}/`}>Home</NavLink>\n      <NavLink to={`${process.env.PUBLIC_URL}/about`}>About</NavLink>\n    </div>\n  )\n}\n'})}),"\n",(0,o.jsx)(e.h3,{id:"webpack",children:"Webpack"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.code,{children:"publicPath: '/'"})}),"\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.code,{children:"historyApiFallback: true"})}),"\n"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"const path = require('node:path')\nconst HtmlWebpackPlugin = require('html-webpack-plugin')\n\nmodule.exports = {\n  entry: './app/index.js',\n  output: {\n    path: path.resolve(__dirname, 'dist'),\n    filename: 'index_bundle.js',\n    publicPath: '/',\n  },\n  module: {\n    rules: [\n      { test: /\\.(js)$/, use: 'babel-loader' },\n      { test: /\\.css$/, use: ['style-loader', 'css-loader'] },\n    ],\n  },\n  devServer: {\n    historyApiFallback: true,\n  },\n  plugins: [\n    new HtmlWebpackPlugin({\n      template: 'app/index.html',\n    }),\n  ],\n}\n"})}),"\n",(0,o.jsx)(e.h3,{id:"expressjs",children:"Express.js"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"app.use(express.static(path.resolve(__dirname, 'build')))\n\n// always serve index.html for any request\napp.get('*', (req, res) => {\n  res.sendFile(path.resolve(__dirname, 'build', 'index.html'))\n})\n"})}),"\n",(0,o.jsx)(e.h3,{id:"nginx",children:"Nginx"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-nginx",children:"# always serve index.html for any request (react-router for single page application)\nroot /var/www/blog/html/build;\nindex index.html;\nserver_name blog.sabertazimi.cn;\n\nlocation / {\n   try_files $uri /index.html;\n}\n"})}),"\n",(0,o.jsx)(e.h2,{id:"internals",children:"Internals"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.code,{children:"<Route>"})," instances listen to ",(0,o.jsx)(e.code,{children:"popstate"})," event to ",(0,o.jsx)(e.code,{children:"forceUpdate"}),"."]}),"\n",(0,o.jsxs)(e.li,{children:["When click ",(0,o.jsx)(e.code,{children:"<Link>"}),"/",(0,o.jsx)(e.code,{children:"<Redirect>"}),", ",(0,o.jsx)(e.code,{children:"historyPush"})," or ",(0,o.jsx)(e.code,{children:"historyReplace"})," get called,\n",(0,o.jsx)(e.code,{children:"<Route>"})," instances re-match and re-render."]}),"\n"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"const instances = []\n\nconst register = comp => instances.push(comp)\nconst unregister = comp => instances.splice(instances.indexOf(comp), 1)\n\nfunction historyPush(path) {\n  window.history.pushState({}, null, path)\n  instances.forEach(instance => instance.forceUpdate())\n}\n\nfunction historyReplace(path) {\n  window.history.replaceState({}, null, path)\n  instances.forEach(instance => instance.forceUpdate())\n}\n"})}),"\n",(0,o.jsx)(e.h3,{id:"route",children:"Route"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"function matchPath(pathname, options) {\n  const { exact = false, path } = options\n\n  if (!path) {\n    return {\n      path: null,\n      url: pathname,\n      isExact: true,\n    }\n  }\n\n  const match = new RegExp(`^${path}`).exec(pathname)\n\n  if (!match) {\n    // There wasn't a match.\n    return null\n  }\n\n  const url = match[0]\n  const isExact = pathname === url\n\n  if (exact && !isExact) {\n    // There was a match, but it wasn't\n    // an exact match as specified by\n    // the exact prop.\n\n    return null\n  }\n\n  return {\n    path,\n    url,\n    isExact,\n  }\n}\n\ninterface Props {\n  path: string\n  exact: boolean\n  component: Function\n  render: Function\n}\n\nclass Route extends Component<Props> {\n  UNSAFE_componentWillMount() {\n    window.addEventListener('popstate', this.handlePop)\n    register(this)\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('popstate', this.handlePop)\n    unregister(this)\n  }\n\n  handlePop = () => {\n    this.forceUpdate()\n  }\n\n  render() {\n    const { path, exact, component, render } = this.props\n\n    const match = matchPath(window.location.pathname, { path, exact })\n\n    if (!match)\n      return null\n\n    if (component)\n      return React.createElement(component, { match })\n\n    if (render)\n      return render({ match })\n\n    return null\n  }\n}\n"})}),"\n",(0,o.jsx)(e.h3,{id:"link",children:"Link"}),"\n",(0,o.jsxs)(e.p,{children:["Whenever a ",(0,o.jsx)(e.code,{children:"<Link>"})," is clicked and the location changes,\neach ",(0,o.jsx)(e.code,{children:"<Route>"})," will be aware of that and re-match and re-render with ",(0,o.jsx)(e.code,{children:"instances"}),"."]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"interface Props {\n  to: string\n  children: ReactElement\n}\n\nclass Link extends Component<Props> {\n  handleClick = (event) => {\n    const { replace, to } = this.props\n    event.preventDefault()\n\n    replace ? historyReplace(to) : historyPush(to)\n  }\n\n  render() {\n    const { to, children } = this.props\n\n    return (\n      <a href={to} onClick={this.handleClick}>\n        {children}\n      </a>\n    )\n  }\n}\n"})}),"\n",(0,o.jsx)(e.h3,{id:"redirect",children:"Redirect"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"class Redirect extends Component {\n  static defaultProps = {\n    push: false,\n  }\n\n  componentDidMount() {\n    const { to, push } = this.props\n\n    push ? historyPush(to) : historyReplace(to)\n  }\n\n  render() {\n    return null\n  }\n}\n"})}),"\n",(0,o.jsx)(e.h3,{id:"hooks",children:"Hooks"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"/**\n * @see https://github.com/ashok-khanna/react-snippets\n */\n\nimport { useEffect, useState } from 'react'\n\nexport default function Router({ routes, defaultComponent }) {\n  // state to track URL and force component to re-render on change\n  const [currentPath, setCurrentPath] = useState(window.location.pathname)\n\n  useEffect(() => {\n    const onLocationChange = () => {\n      // update path state to current window URL\n      setCurrentPath(window.location.pathname)\n    }\n\n    // listen for popstate event\n    window.addEventListener('popstate', onLocationChange)\n\n    // clean up event listener\n    return () => {\n      window.removeEventListener('popstate', onLocationChange)\n    }\n  }, [])\n  return (\n    routes.find(({ path, component }) => path === currentPath)?.component\n    || defaultComponent\n  )\n}\n\nexport function Link({ className, href, children }: {\n  className: string\n  href: string\n  children: ReactElement\n}) {\n  const onClick = (event) => {\n    // if ctrl or meta key are held on click,\n    // allow default behavior of opening link in new tab\n    if (event.metaKey || event.ctrlKey)\n      return\n\n    // prevent full page reload\n    event.preventDefault()\n\n    // update url\n    window.history.pushState({}, '', href)\n\n    // communicate to Routes that URL has changed\n    const navEvent = new PopStateEvent('popstate')\n    window.dispatchEvent(navEvent)\n  }\n\n  return (\n    <a className={className} href={href} onClick={onClick}>\n      {children}\n    </a>\n  )\n}\n\nfunction navigate(href) {\n  // update url\n  window.history.pushState({}, '', href)\n\n  // communicate to Routes that URL has changed\n  const navEvent = new PopStateEvent('popstate')\n  window.dispatchEvent(navEvent)\n}\n"})})]})}function p(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(d,{...n})}):d(n)}},86145:(n,e,t)=>{t.d(e,{R:()=>a,x:()=>i});var r=t(57140);const o={},s=r.createContext(o);function a(n){const e=r.useContext(s);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:a(n.components),r.createElement(s.Provider,{value:e},n.children)}}}]);