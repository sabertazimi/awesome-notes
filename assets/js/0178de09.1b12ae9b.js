"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[18095],{98314:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"web/react/state","title":"State","description":"SetState","source":"@site/content/web/react/state.md","sourceDirName":"web/react","slug":"/web/react/state","permalink":"/notes/web/react/state","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/react/state.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"React","permalink":"/notes/tags/react"},{"inline":true,"label":"State","permalink":"/notes/tags/state"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":2,"frontMatter":{"sidebar_position":2,"tags":["Web","React","State"]},"sidebar":"tutorialSidebar","previous":{"title":"Components","permalink":"/notes/web/react/components"},"next":{"title":"Synthetic Events","permalink":"/notes/web/react/event"}}');var o=n(35656),i=n(86145);const r={sidebar_position:2,tags:["Web","React","State"]},a="State",c={},d=[{value:"SetState",id:"setstate",level:2},{value:"componentDidMount",id:"componentdidmount",level:2}];function l(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"state",children:"State"})}),"\n",(0,o.jsx)(t.h2,{id:"setstate",children:"SetState"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"setState"})," synchronous way:\nwhen it comes ",(0,o.jsx)(t.code,{children:"blocking mode"}),"\n(",(0,o.jsx)(t.code,{children:"ReactDOM.createBlockingRoot(rootNode).render(<App />)"}),"),\n",(0,o.jsx)(t.code,{children:"setState"})," works in synchronous mode:\n",(0,o.jsx)(t.code,{children:"scheduleUpdateOnFiber"})," -> ",(0,o.jsx)(t.code,{children:"ensureRootIsScheduled"})," -> ",(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"flushSyncCallbackQueue"})}),"."]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"setState"})," asynchronous way:\nat most of the other time, ",(0,o.jsx)(t.code,{children:"setState"})," works in asynchronous mode,\nincluding ",(0,o.jsx)(t.code,{children:"legacy mode"}),"(",(0,o.jsx)(t.code,{children:"ReactDOM.render(<App />, rootNode)"}),")\nand ",(0,o.jsx)(t.code,{children:"concurrent mode"}),"(",(0,o.jsx)(t.code,{children:"ReactDOM.createRoot(rootNode).render(<App />)"}),")."]}),"\n",(0,o.jsxs)(t.li,{children:["\u5728\u5f02\u6b65\u6a21\u5f0f\u4e0b, \u4e3a\u4e86\u9632\u6b62\u5b50\u7ec4\u4ef6\u5728\u5904\u7406\u4e8b\u4ef6\u65f6\u591a\u6b21\u6e32\u67d3,\n\u5c06\u591a\u4e2a ",(0,o.jsx)(t.code,{children:"setState"})," (\u5305\u62ec\u7236\u7ec4\u4ef6) \u79fb\u5230\u6d4f\u89c8\u5668\u4e8b\u4ef6\u4e4b\u540e\u6267\u884c\n(",(0,o.jsx)(t.code,{children:"Batched Updates"}),": \u6b64\u65f6 React \u5185\u90e8\u53d8\u91cf ",(0,o.jsx)(t.code,{children:"isBatchingUpdates"})," \u53d8\u6210 ",(0,o.jsx)(t.code,{children:"true"}),"),\n\u53ef\u4ee5\u63d0\u5347 React \u6027\u80fd.\n\u672a\u6765\u4f1a\u5728\u66f4\u591a\u7684\u53ef\u4ee5 ",(0,o.jsx)(t.code,{children:"Batched Updates"})," \u7684\u573a\u666f\u4e0b\u5c06 ",(0,o.jsx)(t.code,{children:"setState"})," \u8bbe\u4e3a\u5f02\u6b65\u6267\u884c,\n\u6240\u4ee5\u7f16\u5199\u4ee3\u7801\u65f6\u6700\u597d\u5c06 ",(0,o.jsx)(t.code,{children:"setState"})," \u603b\u662f\u5f53\u505a\u5f02\u6b65\u6267\u884c\u51fd\u6570."]}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-tsx",children:"class Example extends React.Component {\n  constructor() {\n    super()\n    this.state = {\n      val: 0,\n    }\n  }\n\n  componentDidMount() {\n    this.setState({ val: this.state.val + 1 })\n    console.log(this.state.val) // \u7b2c 1 \u6b21 log\n\n    this.setState({ val: this.state.val + 1 })\n    console.log(this.state.val) // \u7b2c 2 \u6b21 log\n\n    const timeout = setTimeout(() => {\n      this.setState({ val: this.state.val + 1 })\n      console.log(this.state.val) // \u7b2c 3 \u6b21 log\n\n      this.setState({ val: this.state.val + 1 })\n      console.log(this.state.val) // \u7b2c 4 \u6b21 log\n    }, 0)\n  }\n\n  componentWillUnmount() {\n    clearTimeout(timeout)\n  }\n\n  render() {\n    return <div>Example</div>\n  }\n}\n\n// => 0 0 2 3\n"})}),"\n",(0,o.jsxs)(t.admonition,{title:"State Structure Principles",type:"tip",children:[(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.a,{href:"https://react.dev/learn/choosing-the-state-structure",children:"Principles for structuring state"}),":"]}),(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Group related state."}),"\n",(0,o.jsx)(t.li,{children:"Avoid contradictions in state."}),"\n",(0,o.jsx)(t.li,{children:"Avoid duplication in state."}),"\n",(0,o.jsx)(t.li,{children:"Avoid redundant state."}),"\n",(0,o.jsx)(t.li,{children:"Avoid deeply nested state."}),"\n"]})]}),"\n",(0,o.jsx)(t.h2,{id:"componentdidmount",children:"componentDidMount"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["Don't ",(0,o.jsx)(t.code,{children:"setState"})," directly in this method."]}),"\n",(0,o.jsxs)(t.li,{children:["Can use ",(0,o.jsx)(t.code,{children:"setInterval"}),"/",(0,o.jsx)(t.code,{children:"setTimeout"}),"/AJAX request/",(0,o.jsx)(t.code,{children:"fetch"})," in this method,\nand call ",(0,o.jsx)(t.code,{children:"setState"})," as ",(0,o.jsx)(t.code,{children:"callback"})," inside these functions."]}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-tsx",children:"class MyComponent extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      error: null,\n      isLoaded: false,\n      items: [],\n    }\n  }\n\n  componentDidMount() {\n    fetch('https://api.example.com/items')\n      .then(res => res.json())\n      .then(\n        (result) => {\n          this.setState({\n            isLoaded: true,\n            items: result.items,\n          })\n        },\n        // Note: it's important to handle errors here\n        // instead of a catch() block so that we don't swallow\n        // exceptions from actual bugs in components.\n        (error) => {\n          this.setState({\n            isLoaded: true,\n            error,\n          })\n        },\n      )\n  }\n\n  render() {\n    const { error, isLoaded, items } = this.state\n    if (error) {\n      return (\n        <div>\n          Error:\n          {error.message}\n        </div>\n      )\n    } else if (!isLoaded) {\n      return <div>Loading...</div>\n    } else {\n      return (\n        <ul>\n          {items.map(item => (\n            <li key={item.name}>\n              {item.name}\n              {' '}\n              {item.price}\n            </li>\n          ))}\n        </ul>\n      )\n    }\n  }\n}\n"})})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},86145:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>a});var s=n(57140);const o={},i=s.createContext(o);function r(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);