"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[67973],{97100:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"web/network/ip","title":"IP","description":"Protocol","source":"@site/content/web/network/ip.md","sourceDirName":"web/network","slug":"/web/network/ip","permalink":"/notes/web/network/ip","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/network/ip.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"Network","permalink":"/notes/tags/network"},{"inline":true,"label":"IP","permalink":"/notes/tags/ip"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":13,"frontMatter":{"sidebar_position":13,"tags":["Web","Network","IP"]},"sidebar":"tutorialSidebar","previous":{"title":"TLS","permalink":"/notes/web/network/tls"},"next":{"title":"Ethernet","permalink":"/notes/web/network/ethernet"}}');var s=i(35656),r=i(86145);const l={sidebar_position:13,tags:["Web","Network","IP"]},o="IP",d={},c=[{value:"Protocol",id:"protocol",level:2},{value:"Service Model",id:"service-model",level:2},{value:"Router",id:"router",level:2},{value:"IPv4",id:"ipv4",level:2},{value:"Packet Format",id:"packet-format",level:2},{value:"ICMP",id:"icmp",level:2}];function a(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"ip",children:"IP"})}),"\n",(0,s.jsx)(n.h2,{id:"protocol",children:"Protocol"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"IP Header",src:i(77129).A+"",title:"IP Header",width:"625",height:"765"})}),"\n",(0,s.jsx)(n.h2,{id:"service-model",children:"Service Model"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Prevent packets looping forever(TTL/time to live field in header):\nif TTL gets decreased to zero, then drop this datagram."}),"\n",(0,s.jsx)(n.li,{children:"Limit fragment packets size(Packet ID, Flags, Fragment Offset)."}),"\n",(0,s.jsx)(n.li,{children:"Reduce changes of wrong destination(Checksum, Destination Address)."}),"\n",(0,s.jsxs)(n.li,{children:["\u64cd\u4f5c\u7cfb\u7edf\u534f\u8bae\u6808\u7684 IP \u6a21\u5757\u4f1a\u68c0\u67e5 IP \u62a5\u6587\u5934\u90e8:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5224\u65ad\u672c\u673a\u662f\u5426\u4e3a\u63a5\u6536\u65b9."}),"\n",(0,s.jsx)(n.li,{children:"\u5224\u65ad\u7f51\u7edc\u5305\u662f\u5426\u7ecf\u8fc7\u5206\u7247."}),"\n",(0,s.jsx)(n.li,{children:"\u5c06\u5305\u8f6c\u4ea4\u7ed9 TCP \u6a21\u5757\u6216 UDP \u6a21\u5757."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{title:"IP Layer",type:"tip",children:(0,s.jsx)(n.p,{children:"IP \u672c\u8eab\u4e0d\u8d1f\u8d23\u5305\u7684\u4f20\u8f93,\n\u800c\u662f\u59d4\u6258\u5404\u79cd\u901a\u4fe1\u6280\u672f\u5c06\u5305\u4f20\u8f93\u5230\u4e0b\u4e00\u4e2a\u8def\u7531\u5668 (\u7eaf\u7cb9\u8def\u7531\u5668).\n\u6781\u7b80\u7684 IP Layer \u8bbe\u8ba1,\n\u53ef\u4ee5\u6839\u636e\u9700\u8981\u7075\u6d3b\u8fd0\u7528\u5404\u79cd\u901a\u4fe1\u6280\u672f (\u4ee5\u592a\u7f51, \u65e0\u7ebf\u7f51 etc),\n\u4ece\u800c\u6784\u5efa\u51fa\u4e92\u8054\u7f51\u8fd9\u4e00\u89c4\u6a21\u5de8\u5927\u7684\u7f51\u7edc."})}),"\n",(0,s.jsx)(n.h2,{id:"router",children:"Router"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u8def\u7531\u5668\u7684\u5404\u4e2a\u7aef\u53e3\u90fd\u5177\u6709 MAC \u5730\u5740\u548c IP \u5730\u5740."}),"\n",(0,s.jsx)(n.li,{children:"\u8def\u7531\u5668\u4f1a\u5ffd\u7565\u4e3b\u673a\u53f7, \u53ea\u5339\u914d\u7f51\u7edc\u53f7.\n\u901a\u8fc7\u8def\u7531\u805a\u5408, \u51cf\u5c11\u8def\u7531\u8868\u8bb0\u5f55\u6570, \u5408\u5e76\u5b50\u7f51."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"ipv4",children:"IPv4"}),"\n",(0,s.jsx)(n.p,{children:"Address structure:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["32 bits long: ",(0,s.jsx)(n.code,{children:"a.b.c.d"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Historical:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Class A: ",(0,s.jsx)(n.code,{children:"0-network(7 bits)-host(24 bits)"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Class B: ",(0,s.jsx)(n.code,{children:"10-network(14 bits)-host(16 bits)"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Class C: ",(0,s.jsx)(n.code,{children:"110-network(21 bits)-host(8 bits)"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Today:\n",(0,s.jsx)(n.code,{children:"171.64.0.0/16"})," means ",(0,s.jsx)(n.code,{children:"171.64.0.0"})," to ",(0,s.jsx)(n.code,{children:"171.64.255.255"}),",\n",(0,s.jsx)(n.code,{children:"A/24"})," describes ",(0,s.jsx)(n.code,{children:"256"})," addresses, ",(0,s.jsx)(n.code,{children:"A/20"})," describes ",(0,s.jsx)(n.code,{children:"4096"})," addresses."]}),"\n",(0,s.jsxs)(n.li,{children:["Longest prefix matching and netmask (",(0,s.jsx)(n.code,{children:"A/16"}),"):\ne.g. ",(0,s.jsx)(n.code,{children:"0.0.0.0/0"})," => matching all addresses."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"packet-format",children:"Packet Format"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Network is big-endian."}),"\n",(0,s.jsxs)(n.li,{children:["In x86 processor, use ",(0,s.jsx)(n.code,{children:"htons()/ntohs()/htonl()/ntohl()"})," host:\nnetwork ",(0,s.jsx)(n.code,{children:"short"}),"/",(0,s.jsx)(n.code,{children:"long"})," helper function to transform format."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cpp",children:"#include <arpa/inet.h>\n\nuint16_t http_port = 80;\nuint16_t packet_port = ntohs(packet->port);\n\nif (packet_port == http_port) {\n    // OK\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"icmp",children:"ICMP"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Report error conditions back."}),"\n",(0,s.jsx)(n.li,{children:"Help diagnose problems."}),"\n",(0,s.jsx)(n.li,{children:"Site above IP:\nICMP \u62a5\u6587\u5305\u542b\u5728 IP \u6570\u636e\u62a5\u4e2d, \u5c5e\u4e8e IP \u7684\u4e00\u4e2a\u7528\u6237.\n\u4e00\u4e2a ICMP \u62a5\u6587\u5305\u62ec IP \u5934\u90e8 + ICMP \u5934\u90e8 + ICMP \u62a5\u6587.\nIP \u5934\u90e8\u7684 Protocol \u503c\u4e3a 1 \u8868\u793a\u8fd9\u662f\u4e00\u4e2a ICMP \u62a5\u6587."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"ICMP Header",src:i(94157).A+"",title:"ICMP Header",width:"756",height:"786"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"0 type 0 code: echo reply(by ping)"}),"\n",(0,s.jsx)(n.li,{children:"3 type 0 code: destination network unreachable"}),"\n",(0,s.jsx)(n.li,{children:"3 type 1 code: destination host unreachable"}),"\n",(0,s.jsx)(n.li,{children:"3 type 3 code: destination port unreachable"}),"\n",(0,s.jsx)(n.li,{children:"8 type 0 code: echo request(by ping)"}),"\n",(0,s.jsx)(n.li,{children:"11 type 0 code: TTL(time to live) Expired(by ping)"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},94157:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/icmp-header-405be01b3360384b4b9674700f54d76e.png"},77129:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/ip-header-f3b1dddfa12eafc7b67fe8235db22b77.png"},86145:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>o});var t=i(57140);const s={},r=t.createContext(s);function l(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);