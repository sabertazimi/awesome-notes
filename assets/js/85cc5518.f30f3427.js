"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[63849],{30270:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>p,contentTitle:()=>c,default:()=>d,frontMatter:()=>t,metadata:()=>s,toc:()=>r});const s=JSON.parse('{"id":"programming/ffmpeg/ffmpeg","title":"FFmpeg","description":"Media conversion:","source":"@site/content/programming/ffmpeg/ffmpeg.md","sourceDirName":"programming/ffmpeg","slug":"/programming/ffmpeg/","permalink":"/notes/programming/ffmpeg/","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/programming/ffmpeg/ffmpeg.md","tags":[{"inline":true,"label":"Programming","permalink":"/notes/tags/programming"},{"inline":true,"label":"Linux","permalink":"/notes/tags/linux"},{"inline":true,"label":"Video","permalink":"/notes/tags/video"},{"inline":true,"label":"FFmpeg","permalink":"/notes/tags/f-fmpeg"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"frontMatter":{"tags":["Programming","Linux","Video","FFmpeg"]},"sidebar":"tutorialSidebar","previous":{"title":"Kubernetes","permalink":"/notes/programming/devops/k8s"},"next":{"title":"Game Design","permalink":"/notes/programming/game/"}}');var l=i(35656),a=i(86145);const t={tags:["Programming","Linux","Video","FFmpeg"]},c="FFmpeg",p={},r=[{value:"Probe",id:"probe",level:2},{value:"Transform",id:"transform",level:2},{value:"Cutting",id:"cutting",level:2},{value:"Mixing",id:"mixing",level:2},{value:"Screenshot",id:"screenshot",level:2},{value:"Gif",id:"gif",level:2},{value:"Subtitle",id:"subtitle",level:2},{value:"Watermark",id:"watermark",level:2},{value:"Desktop Recording",id:"desktop-recording",level:2},{value:"Live Streaming",id:"live-streaming",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"ffmpeg",children:"FFmpeg"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.a,{href:"https://web.dev/media-conversion",children:"Media conversion"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# https://www.yanxurui.cc/posts/tool/2017-10-07-use-ffmpeg-to-edit-video\nffmpeg -global_options -input_1_options -i input_1 -input_2_options -i input_2 \\\n  -output_1_options output_1 ...\n"})}),"\n",(0,l.jsx)(n.h2,{id:"probe",children:"Probe"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"ffprobe input.mp4\nffmpeg -hide_banner -i input.mkv\n"})}),"\n",(0,l.jsx)(n.h2,{id:"transform",children:"Transform"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"MP4"}),": ",(0,l.jsx)(n.code,{children:"H264"}),"Video + ",(0,l.jsx)(n.code,{children:"AAC"}),"Audio"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"WebM"}),": ",(0,l.jsx)(n.code,{children:"VP8"}),"Video + ",(0,l.jsx)(n.code,{children:"Vorbis"}),"Audio"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"OGG"}),": ",(0,l.jsx)(n.code,{children:"Theora"}),"Video + ",(0,l.jsx)(n.code,{children:"Vorbis"}),"Audio"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# code decoder information\nffmpeg -codecs\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# mkv to mp4\nffmpeg -i input.mkv -codec copy output.mp4\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# compress\nffmpeg -i input.mkv -c copy -c:v libx264 -vf scale=-2:720 output.mkv\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# make mkv with video and subtitle\nffmpeg -i input.avi -i input.srt \\\n  -map 0:0 -map 0:1 -map 1:0 -c:v libx264 -c:a aac -c:s srt output.mkv\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# flac to mp3\nffmpeg -i "Michael Jackson - Billie Jean.flac" \\\n  -ab 320k "Michael Jackson - Billie Jean.mp3"\nffmpeg -i music_flac.flac \\\n  -acodec libmp3lame      \\\n  -ar 44100               \\\n  -ab 320k                \\\n  -ac 2 music_flac_mp3.mp3\n# - acodec: Audio Coder Decoder \u97f3\u9891\u7f16\u7801\u89e3\u7801\u5668\n# - libmp3lame: MP3 \u89e3\u7801\u5668\n# - ar: audio rate \u97f3\u9891\u91c7\u6837\u7387, \u9ed8\u8ba4\u7528\u539f\u97f3\u9891\u7684\u91c7\u6837\u7387\n# - ab: audio bit rate \u97f3\u9891\u6bd4\u7279\u7387, \u9ed8\u8ba4 128K\n# - ac: audio channels \u97f3\u9891\u58f0\u9053, \u9ed8\u8ba4\u91c7\u7528\u6e90\u97f3\u9891\u7684\u58f0\u9053\u6570\n'})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# mp4 to avi\nffmpeg -i video.mp4 \\\n  -s 1920x1080      \\\n  -pix_fmt yuv420p  \\\n  -vcodec libx264   \\\n  -preset medium    \\\n  -profile:v high   \\\n  -level:v 4.1      \\\n  -crf 23           \\\n  -r 30             \\\n  -acodec aac       \\\n  -ar 44100         \\\n  -ac 2             \\\n  -b:a 128k video_avi.avi\n# - s: \u7f29\u653e\u89c6\u9891\u65b0\u5c3a\u5bf8 (size)\n# - pix_fmt\uff1apixel format, \u8bbe\u7f6e\u89c6\u9891\u989c\u8272\u7a7a\u95f4\n# - vcodec: Video Coder Decoder, \u89c6\u9891\u7f16\u7801\u89e3\u7801\u5668\n# - preset: \u7f16\u7801\u5668\u9884\u8bbe\n# - profile:v: \u7f16\u7801\u5668\u914d\u7f6e, \u4e0e\u538b\u7f29\u6bd4\u6709\u5173. \u5b9e\u65f6\u901a\u8baf-baseline, \u6d41\u5a92\u4f53-main, \u8d85\u6e05\u89c6\u9891-high\n# - level:v: \u5bf9\u7f16\u7801\u5668\u8bbe\u7f6e\u7684\u5177\u4f53\u89c4\u8303\u548c\u9650\u5236, \u6743\u8861\u538b\u7f29\u6bd4\u548c\u753b\u8d28\n# - crf: \u8bbe\u7f6e\u7801\u7387\u63a7\u5236\u6a21\u5f0f, constant rate factor\u6052\u5b9a\u901f\u7387\u56e0\u5b50\u6a21\u5f0f, \u8303\u56f4 0~51, \u6570\u503c\u8d8a\u5c0f, \u753b\u8d28\u8d8a\u9ad8\n# - r:\u8bbe\u7f6e\u89c6\u9891\u5e27\u7387\n# - b:a: \u97f3\u9891\u6bd4\u7279\u7387, \u5927\u591a\u6570\u7f51\u7ad9\u9650\u5236\u97f3\u9891\u6bd4\u7279\u7387 128k, 129k\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Scale pictures\nffmpeg -i input.jpg -vf scale=320:240 output_320x240.png\n"})}),"\n",(0,l.jsx)(n.h2,{id:"cutting",children:"Cutting"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# audio only\nffmpeg -i cut.mp4 -vn output.mp3\nffmpeg -i video.mp4 -vn -acodec copy video_noVideo.m4a\n\n# video only\nffmpeg -i video.mp4 -vcodec copy -an video_silent.mp4\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# from to cutting\nffmpeg -i music.mp3 -ss 00:00:30 -to 00:02:00 -acodec copy music_cutout.mp3\nffmpeg -i in.mp4 -ss 00:01:00 -to 00:01:10 -c copy out.mp4\nffmpeg -ss 00:01:00 -i in.mp4 -to 00:01:10 -c copy -copyts out.mp4\n\n# 30s duration cutting\nffmpeg -ss 00:02:00.0 -i input.mkv -t 30 -c copy output.mkv\nffmpeg -i input.mkv -ss 00:02:00.0 -t 30 -c copy output.mkv\nffmpeg -ss 00:01:30.0 -i input.mkv -ss 00:00:30.0 -t 30 output.mkv\n"})}),"\n",(0,l.jsx)(n.h2,{id:"mixing",children:"Mixing"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# replace audio\nffmpeg -i input.mkv -i input.mp3 -map 0:v -map 1:a -c copy -shortest output.mp4\n\n# merge audio and video\nffmpeg -i video_noVideo.m4a -i video_silent.mp4 -c copy video_merge.mp4\n\nffmpeg -i "concat:01.mp4|02.mp4|03.mp4" -c copy out.mp4\n\nffmpeg -i input.mkv -i output.aac \\\n  -filter_complex "[0:a][1:a]amerge=inputs=2[a]" -map 0:v -map "[a]" \\\n  -c:v copy -c:a aac -ac 2 -shortest output.mp4\n'})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# Merge pictures\nffmpeg -i 1.png -i 2.png -filter_complex "vstack" output.png\n'})}),"\n",(0,l.jsx)(n.h2,{id:"screenshot",children:"Screenshot"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# -vf -> -filter:v\nffmpeg -ss 00:30:14.435 -i input.mkv -vframes 1 out.png\nffmpeg -i input.mkv -vf fps=1/60 -strftime 1 out_%Y%m%d%H%M%S.jpg\n"})}),"\n",(0,l.jsx)(n.h2,{id:"gif",children:"Gif"}),"\n",(0,l.jsx)(n.p,{children:"GIF \u683c\u5f0f\u6548\u7387\u8f83\u4f4e\uff0c\u901a\u5e38\u9700\u8981\u964d\u4f4e\u5e27\u7387\u548c\u5206\u8fa8\u7387\u4ee5\u63a7\u5236\u6587\u4ef6\u5927\u5c0f:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\u5e27\u7387\u9009\u62e9:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"10-15 fps: \u64cd\u4f5c\u6b65\u9aa4\u3001UI \u4ea4\u4e92\u5c55\u793a"}),"\n",(0,l.jsx)(n.li,{children:"24-30 fps: \u6d41\u7545\u52a8\u753b\u3001\u6e38\u620f\u753b\u9762"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u5206\u8fa8\u7387\u9009\u62e9:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"960px: \u7f51\u9875\u5d4c\u5165\u3001\u6587\u6863\u914d\u56fe"}),"\n",(0,l.jsx)(n.li,{children:"1280-1920px: \u4fdd\u6301\u539f\u5bbd"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# 10fps + 960px \u5bbd\u5ea6 + \u8c03\u8272\u677f\u4f18\u5316\u753b\u8d28\nffmpeg -i input.mp4 \\\n  -vf "fps=10,scale=960:-1:flags=lanczos,split[s0][s1];[s0]palettegen[p];[s1][p]paletteuse" \\\n  -loop 0 output.gif\n\n# 15fps + 1280px \u5bbd\u5ea6\nffmpeg -i input.mp4 \\\n  -vf "fps=15,scale=1280:-1:flags=lanczos,split[s0][s1];[s0]palettegen[p];[s1][p]paletteuse" \\\n  -loop 0 output.gif\n'})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# \u57fa\u7840\u8f6c\u6362\nffmpeg -i video.mp4 -ss 7.5 -to 8.5 -s 640x320 -r 15 video_gif.gif\n\n# \u4f7f\u7528\u81ea\u5b9a\u4e49\u8c03\u8272\u677f\npalette="/tmp/palette.png"\nfilters="fps=10,scale=-1:144:flags=lanczos"\nffmpeg -ss 30 -t 5 -i input.mp4 -vf "$filters,palettegen" -y $palette\nffmpeg -ss 30 -t 5 -i input.mp4 -i $palette \\\n  -filter_complex "$filters [x]; [x][1:v] paletteuse" -y output.gif\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u53c2\u6570\u8bf4\u660e:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"fps=N"}),": \u8bbe\u7f6e\u5e27\u7387"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"scale=W:H"}),": \u8bbe\u7f6e\u5206\u8fa8\u7387\uff0c",(0,l.jsx)(n.code,{children:"-1"})," \u8868\u793a\u81ea\u52a8\u8ba1\u7b97\u4fdd\u6301\u6bd4\u4f8b"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"flags=lanczos"}),": \u4f7f\u7528 Lanczos \u7b97\u6cd5\u8fdb\u884c\u9ad8\u8d28\u91cf\u7f29\u653e"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"palettegen"}),": \u751f\u6210\u81ea\u5b9a\u4e49\u8c03\u8272\u677f (\u4ece 88842 \u8272\u4e2d\u751f\u6210 256 \u8272)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"paletteuse"}),": \u5e94\u7528\u8c03\u8272\u677f"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"-loop 0"}),": \u65e0\u9650\u5faa\u73af"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"split[s0][s1]"}),": \u5206\u6d41\u89c6\u9891\u6d41, \u4e00\u8def\u7528\u4e8e\u751f\u6210\u8c03\u8272\u677f, \u4e00\u8def\u7528\u4e8e\u5e94\u7528"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"subtitle",children:"Subtitle"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"ffmpeg -i input.mkv -vf subtitles=input.srt output.mp4\nffmpeg -i input.mkv -vf ass=input.ass output.mp4\n"})}),"\n",(0,l.jsx)(n.h2,{id:"watermark",children:"Watermark"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'ffmpeg -i input.mkv -i input.png \\\n  -filter_complex "overlay=W-w-5:5" -c copy -c:v libx264 output.mkv\n'})}),"\n",(0,l.jsx)(n.h2,{id:"desktop-recording",children:"Desktop Recording"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# windows\nffmpeg -f gdigrab -i desktop rec.mp4\n\n# linux\nsudo ffmpeg -f fbdev -framerate 10 -i /dev/fb0 rec.mp4\n"})}),"\n",(0,l.jsx)(n.h2,{id:"live-streaming",children:"Live Streaming"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'ffmpeg -re i rec.mp4 \u6309\u7167\u7f51\u7ad9\u8981\u6c42\u7f16\u7801 -f flv "\u4f60\u7684 RTMP \u5730\u5740/\u4f60\u7684\u76f4\u64ad\u7801"\n'})})]})}function d(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}},86145:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>c});var s=i(57140);const l={},a=s.createContext(l);function t(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);