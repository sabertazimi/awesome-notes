"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[93208],{63717:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>g,frontMatter:()=>l,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"web/testing/debugging","title":"Debugging","description":"Monkey Patch","source":"@site/content/web/testing/debugging.md","sourceDirName":"web/testing","slug":"/web/testing/debugging","permalink":"/notes/web/testing/debugging","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/testing/debugging.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"Testing","permalink":"/notes/tags/testing"},{"inline":true,"label":"Debugging","permalink":"/notes/tags/debugging"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":10,"frontMatter":{"sidebar_position":10,"tags":["Web","Testing","Debugging"]},"sidebar":"tutorialSidebar","previous":{"title":"Cypress","permalink":"/notes/web/testing/cypress"},"next":{"title":"DevTools","permalink":"/notes/web/testing/devtools"}}');var r=i(35656),s=i(86145);const l={sidebar_position:10,tags:["Web","Testing","Debugging"]},o="Debugging",a={},c=[{value:"Monkey Patch",id:"monkey-patch",level:2},{value:"Window State",id:"window-state",level:3},{value:"Event Propagation",id:"event-propagation",level:3},{value:"Window Scroll",id:"window-scroll",level:3},{value:"Logging",id:"logging",level:2},{value:"Type",id:"type",level:3},{value:"Information",id:"information",level:3},{value:"Setup",id:"setup",level:3},{value:"Clock",id:"clock",level:3},{value:"Tracing",id:"tracing",level:2},{value:"Trace Property",id:"trace-property",level:3},{value:"Node.js",id:"nodejs",level:2},{value:"Bug List",id:"bug-list",level:2},{value:"Basic Bug",id:"basic-bug",level:3},{value:"C Bug",id:"c-bug",level:3},{value:"Occasional Bug",id:"occasional-bug",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"debugging",children:"Debugging"})}),"\n",(0,r.jsx)(n.h2,{id:"monkey-patch",children:"Monkey Patch"}),"\n",(0,r.jsx)(n.h3,{id:"window-state",children:"Window State"}),"\n",(0,r.jsxs)(n.p,{children:["Inject trace function (log, monitor, report service)\nto window ",(0,r.jsx)(n.code,{children:"pushState"})," and ",(0,r.jsx)(n.code,{children:"replaceState"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"function _wr(type) {\n  const orig = window.history[type]\n\n  return function (...args) {\n    const rv = orig.apply(this, args)\n    const e = new Event(type.toLowerCase())\n    e.arguments = args\n    window.dispatchEvent(e)\n    return rv\n  }\n}\n\nwindow.history.pushState = _wr('pushState')\nwindow.history.replaceState = _wr('replaceState')\n\nwindow.addEventListener('pushstate', (event) => {\n  console.trace('pushState')\n})\n\nwindow.addEventListener('replacestate', (event) => {\n  console.trace('replaceState')\n})\n"})}),"\n",(0,r.jsx)(n.h3,{id:"event-propagation",children:"Event Propagation"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const originalStopPropagation = MouseEvent.prototype.stopPropagation\n\nMouseEvent.prototype.stopPropagation = function (...args) {\n  console.trace('stopPropagation')\n  originalStopPropagation.call(this, ...args)\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"window-scroll",children:"Window Scroll"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"let originalScrollTop = element.scrollTop\n\nObject.defineProperty(element, 'scrollTop', {\n  get() {\n    return originalScrollTop\n  },\n  set(newVal) {\n    console.trace('scrollTop')\n    originalScrollTop = newVal\n  },\n})\n"})}),"\n",(0,r.jsx)(n.h2,{id:"logging",children:"Logging"}),"\n",(0,r.jsx)(n.h3,{id:"type",children:"Type"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Application client log."}),"\n",(0,r.jsx)(n.li,{children:"Web server log."}),"\n",(0,r.jsx)(n.li,{children:"Database server log."}),"\n",(0,r.jsx)(n.li,{children:"Access log."}),"\n",(0,r.jsx)(n.li,{children:"Debug log."}),"\n",(0,r.jsx)(n.li,{children:"Error log."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"information",children:"Information"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u65e5\u5fd7\u65f6\u95f4: \u5305\u542b\u65f6\u533a\u4fe1\u606f\u548c\u6beb\u79d2."}),"\n",(0,r.jsx)(n.li,{children:"\u65e5\u5fd7\u7ea7\u522b."}),"\n",(0,r.jsx)(n.li,{children:"\u4f1a\u8bdd\u6807\u8bc6."}),"\n",(0,r.jsx)(n.li,{children:"\u529f\u80fd\u6807\u8bc6."}),"\n",(0,r.jsx)(n.li,{children:"\u7cbe\u70bc\u5185\u5bb9: \u573a\u666f\u4fe1\u606f, \u72b6\u6001\u4fe1\u606f (\u5f00\u59cb/\u4e2d\u65ad/\u7ed3\u675f), \u91cd\u8981\u53c2\u6570."}),"\n",(0,r.jsx)(n.li,{children:"\u5176\u4ed6\u4fe1\u606f: \u7248\u672c\u53f7, \u7ebf\u7a0b\u53f7."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"setup",children:"Setup"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const { createLogger, format, transports } = require('winston')\n\nconst logLevels = {\n  fatal: 0,\n  error: 1,\n  warn: 2,\n  info: 3,\n  debug: 4,\n  trace: 5,\n}\n\nconst logger = createLogger({\n  levels: logLevels,\n  format: format.combine(format.timestamp(), format.json()),\n  transports: [new transports.Console()],\n})\n\nlogger.info('System Started')\nlogger.fatal('Fatal error occurred')\n"})}),"\n",(0,r.jsx)(n.h3,{id:"clock",children:"Clock"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"performance.now()"})," is more precise (100 us)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"performance.now()"})," is strictly monotonic (unaffected by changes of machine time)."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"let lastVisibilityChange = 0\n\nwindow.addEventListener('visibilitychange', () => {\n  lastVisibilityChange = performance.now()\n})\n\n// don\u2019t log any metrics started before the last visibility change\n// don't log any metrics if the page is hidden\n// discard perf data from when the machine was not running app at full speed\nfunction metrics() {\n  if (metric.start < lastVisibilityChange || document.hidden)\n    return\n\n  process()\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"requestAnimationFrame(() => {\n  requestAnimationFrame((timestamp) => {\n    metric.finish(timestamp)\n  })\n})\n"})}),"\n",(0,r.jsx)(n.h2,{id:"tracing",children:"Tracing"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"debugger"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// debugger;\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"copy(obj) // to clipboard\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"window.onerror = function (errorMessage, scriptURI, lineNo, columnNo, error) {\n  console.log(`errorMessage: ${errorMessage}`) // \u5f02\u5e38\u4fe1\u606f\n  console.log(`scriptURI: ${scriptURI}`) // \u5f02\u5e38\u6587\u4ef6\u8def\u5f84\n  console.log(`lineNo: ${lineNo}`) // \u5f02\u5e38\u884c\u53f7\n  console.log(`columnNo: ${columnNo}`) // \u5f02\u5e38\u5217\u53f7\n  console.log(`error: ${error}`) // \u5f02\u5e38\u5806\u6808\u4fe1\u606f\n  // ...\n  // \u5f02\u5e38\u4e0a\u62a5\n}\n\nwindow.addEventListener('error', () => {\n  console.log(error)\n  // ...\n  // \u5f02\u5e38\u4e0a\u62a5\n})\n"})}),"\n",(0,r.jsx)(n.h3,{id:"trace-property",children:"Trace Property"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"function traceProperty(object, property) {\n  let value = object[property]\n  Object.defineProperty(object, property, {\n    get() {\n      console.trace(`${property} requested`)\n      return value\n    },\n    set(newValue) {\n      console.trace(`setting ${property} to `, newValue)\n      value = newValue\n    },\n  })\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"nodejs",children:"Node.js"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"node --inspect"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://github.com/GoogleChromeLabs/ndb",children:"ndb"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"node --inspect\nndb index.js\n"})}),"\n",(0,r.jsx)(n.h2,{id:"bug-list",children:"Bug List"}),"\n",(0,r.jsx)(n.h3,{id:"basic-bug",children:"Basic Bug"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5fc5\u987b\u8fdb\u884c\u8f93\u5165\u9a8c\u8bc1 - \u6c38\u8fdc\u4e0d\u8981\u76f8\u4fe1\u7528\u6237\u8f93\u5165."}),"\n",(0,r.jsx)(n.li,{children:"\u6c38\u4e0d\u4f7f\u7528\u672a\u7ecf\u9a8c\u8bc1\u7684\u6570\u503c\u7684\u957f\u5ea6\u6216\u5927\u5c0f."}),"\n",(0,r.jsx)(n.li,{children:"\u5fc5\u987b\u8fd4\u56de\u6b63\u786e\u7684\u9519\u8bef\u72b6\u6001."}),"\n",(0,r.jsx)(n.li,{children:"\u6ce8\u610f(\u9690\u5f0f)\u7c7b\u578b\u8f6c\u6362."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"c-bug",children:"C Bug"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u6808\u7f13\u51b2\u533a\u6ea2\u51fa."}),"\n",(0,r.jsx)(n.li,{children:"\u7a7a\u6307\u9488\u89e3\u5f15\u7528."}),"\n",(0,r.jsx)(n.li,{children:"(\u9690\u5f0f)\u7c7b\u578b\u8f6c\u6362."}),"\n",(0,r.jsx)(n.li,{children:"GOT \u8986\u5199 (Global Offset Table)."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"occasional-bug",children:"Occasional Bug"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u591a\u8fdb\u7a0b\u5b8c\u5168\u5f02\u6b65\u7f16\u7a0b\u7684\u590d\u6742\u6027."}),"\n",(0,r.jsx)(n.li,{children:"\u9010\u6e10\u5730\u5185\u5b58\u6cc4\u6f0f."}),"\n"]})]})}function g(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},86145:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>o});var t=i(57140);const r={},s=t.createContext(r);function l(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);