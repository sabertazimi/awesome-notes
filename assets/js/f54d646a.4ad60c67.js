"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[11249],{93748:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"web/vue/animation","title":"Animation","description":"- v-enter-from.","source":"@site/content/web/vue/animation.md","sourceDirName":"web/vue","slug":"/web/vue/animation","permalink":"/notes/web/vue/animation","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/vue/animation.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"Vue","permalink":"/notes/tags/vue"},{"inline":true,"label":"Animation","permalink":"/notes/tags/animation"},{"inline":true,"label":"Transition","permalink":"/notes/tags/transition"},{"inline":true,"label":"Internals","permalink":"/notes/tags/internals"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":13,"frontMatter":{"tags":["Web","Vue","Animation","Transition","Internals"],"sidebar_position":13},"sidebar":"tutorialSidebar","previous":{"title":"Composition","permalink":"/notes/web/vue/composition"},"next":{"title":"Concurrent","permalink":"/notes/web/vue/concurrent"}}');var a=t(35656),i=t(86145);const o={tags:["Web","Vue","Animation","Transition","Internals"],sidebar_position:13},r="Animation",l={},d=[{value:"Fade",id:"fade",level:2},{value:"Slide",id:"slide",level:2},{value:"Group",id:"group",level:2},{value:"Hooks",id:"hooks",level:2},{value:"Internals",id:"internals",level:2},{value:"Component",id:"component",level:3},{value:"Module",id:"module",level:3},{value:"Group Component",id:"group-component",level:3}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"animation",children:"Animation"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"v-enter-from"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"v-enter-to"}),": CSS defaults."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"v-enter-active"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"v-leave-from"}),": CSS defaults."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"v-leave-to"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"v-leave-active"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"name"}),": transition name (different from ",(0,a.jsx)(n.code,{children:"v"}),")."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"mode"}),":","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"out-in"}),": rectify router components transition."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"in-out"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-css",children:".v-enter-from {\n  opacity: 0;\n}\n\n@media (prefers-reduced-motion: no-preference) {\n  .v-enter-active,\n  .v-leave-active {\n    transition: opacity 0.3s ease-out;\n  }\n}\n\n.v-leave-to {\n  opacity: 0;\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"fade",children:"Fade"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-html",children:'<template>\n  <div>\n    <h1>This is a modal page</h1>\n    <button @click="toggleModal">Open</button>\n    <transition name="fade" mode="out-in">\n      <div v-if="isOpen" class="modal">\n        <p><button @click="toggleModal">Close</button></p>\n      </div>\n    </transition>\n  </div>\n</template>\n\n<style>\n  .fade-enter-from {\n    opacity: 0;\n  }\n\n  @media (prefers-reduced-motion: no-preference) {\n    .fade-enter-active,\n    .fade-leave-active {\n      transition: opacity 0.5s ease-out;\n    }\n  }\n\n  .fade-leave-to {\n    opacity: 0;\n  }\n</style>\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-html",children:"<style>\n  @media only screen and (prefers-reduced-motion: no-preference) {\n    .enter,\n    .leave {\n      transition: opacity 0.5s ease-out;\n    }\n  }\n\n  .before-enter,\n  .leave {\n    opacity: 0;\n  }\n\n  .enter,\n  .before-leave {\n    opacity: 1;\n  }\n</style>\n\n<script>\n  function enter(el, done) {\n    el.classList.add('before-enter')\n\n    setTimeout(() => {\n      el.classList.remove('before-enter')\n      el.classList.add('enter')\n    }, 20)\n\n    setTimeout(() => {\n      el.classList.remove('enter')\n      done()\n    }, 500)\n  }\n\n  function leave(el, done) {\n    el.classList.add('before-leave')\n\n    setTimeout(() => {\n      el.classList.remove('before-leave')\n      el.classList.add('leave')\n    }, 0)\n\n    setTimeout(() => {\n      el.classList.remove('leave')\n      done()\n    }, 500)\n  }\n<\/script>\n"})}),"\n",(0,a.jsx)(n.h2,{id:"slide",children:"Slide"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-css",children:".slide-fade-enter-from {\n  opacity: 0;\n  transform: translateX(10px);\n}\n\n@media (prefers-reduced-motion: no-preference) {\n  .slide-fade-enter-active,\n  .slide-fade-leave-active {\n    transition: all 0.2s ease;\n  }\n}\n\n.slide-fade-leave-to {\n  opacity: 0;\n  transform: translateX(-10px);\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"group",children:"Group"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-html",children:'<template>\n  <div>\n    <input type="text" v-model="newContact" placeholder="Name" />\n    <button @click="addContact">Add Contact</button>\n    <button @click="sortContacts">Sort</button>\n    <transition-group name="slide-up" tag="ul" appear>\n      <li v-for="contact in contacts" :key="contact">{{ contact }}</li>\n    </transition-group>\n  </div>\n</template>\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-css",children:".slide-up-enter-from {\n  opacity: 0;\n  transform: translateY(10px);\n}\n\n@media (prefers-reduced-motion: no-preference) {\n  .slide-up-enter-active {\n    transition: all 0.2s ease;\n  }\n\n  .slide-up-move {\n    transition: transform 0.8s ease-in;\n  }\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"hooks",children:"Hooks"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:':css="false"'})," tells Vue don't handle transition classes,\nwe're relying on JavaScript hooks instead."]}),"\n",(0,a.jsx)(n.p,{children:"When it comes to JavaScript animation library,\ntransition JavaScript hooks helps a lot."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-html",children:'<transition\n  @before-enter="beforeEnter"\n  @enter="enter"\n  @after-enter="afterEnter"\n  @enter-cancelled="enterCancelled"\n  @before-leave="beforeLeave"\n  @leave="leave"\n  @after-leave="afterLeave"\n  @leave-cancelled="leaveCancelled"\n  :css="false"\n>\n  <div>Modal</div>\n</transition>\n\n<transition-group\n  @before-enter="beforeEnter"\n  @enter="enter"\n  @after-enter="afterEnter"\n  @enter-cancelled="enterCancelled"\n  @before-leave="beforeLeave"\n  @leave="leave"\n  @after-leave="afterLeave"\n  @leave-cancelled="leaveCancelled"\n  :css="false"\n>\n  <div class="card" v-for="card in cards" :key="card.id">\n    <p>{{ card.title }}</p>\n  </div>\n</transition-group>\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"export default {\n  methods: {\n    beforeEnter(el) {},\n    enter(el, done) {\n      done()\n    },\n    afterEnter(el) {},\n    enterCancelled(el) {},\n    beforeLeave(el) {},\n    leave(el, done) {\n      done()\n    },\n    afterLeave(el) {},\n    leaveCancelled(el) {},\n  },\n}\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-html",children:'<template>\n  <transition appear @before-enter="beforeEnter" @enter="enter" :css="false">\n    <div class="card"></div>\n  </transition>\n</template>\n\n<script>\n  import gsap from \'gsap\'\n\n  export default {\n    methods: {\n      beforeEnter(el) {\n        el.style.opacity = 0\n        el.style.transform = \'scale(0, 0)\'\n      },\n      enter(el, done) {\n        gsap.to(el, {\n          duration: 1,\n          opacity: 1,\n          scale: 1,\n          ease: \'bounce.inOut\',\n          onComplete: done,\n        })\n      },\n    },\n  }\n<\/script>\n'})}),"\n",(0,a.jsx)(n.h2,{id:"internals",children:"Internals"}),"\n",(0,a.jsx)(n.h3,{id:"component",children:"Component"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"const Transition = {\n  name: 'Transition',\n  setup(props, { slots }) {\n    return () => {\n      const innerVNode = slots.default()\n\n      innerVNode.transition = {\n        beforeEnter(el) {\n          el.classList.add('enter-from')\n          el.classList.add('enter-active')\n        },\n        enter(el) {\n          nextFrame(() => {\n            el.classList.remove('enter-from')\n            el.classList.add('enter-to')\n\n            el.addEventListener('transitionend', () => {\n              el.classList.remove('enter-to')\n              el.classList.remove('enter-active')\n            })\n          })\n        },\n        leave(el, performRemove) {\n          el.classList.add('leave-from')\n          el.classList.add('leave-active')\n\n          nextFrame(() => {\n            el.classList.remove('leave-from')\n            el.classList.add('leave-to')\n\n            el.addEventListener('transitionend', () => {\n              el.classList.remove('leave-to')\n              el.classList.remove('leave-active')\n\n              performRemove()\n            })\n          })\n        },\n      }\n\n      return innerVNode\n    }\n  },\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"module",children:"Module"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"platforms/web/runtime/modules/transition.js"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u81ea\u52a8\u55c5\u63a2\u76ee\u6807\u5143\u7d20\u662f\u5426\u5e94\u7528\u4e86 CSS \u8fc7\u6e21\u6216\u52a8\u753b, \u5728\u6070\u5f53\u7684\u65f6\u673a\u6dfb\u52a0/\u5220\u9664 CSS \u7c7b\u540d."}),"\n",(0,a.jsx)(n.li,{children:"\u8fc7\u6e21\u7ec4\u4ef6\u63d0\u4f9b JavaScript \u94a9\u5b50\u51fd\u6570\u63a5\u53e3, \u94a9\u5b50\u51fd\u6570\u5c06\u5728\u6070\u5f53\u7684\u65f6\u673a\u88ab\u8c03\u7528."}),"\n",(0,a.jsxs)(n.li,{children:["\u6838\u5fc3\u903b\u8f91\u4f4d\u4e8e ",(0,a.jsx)(n.code,{children:"enter()"})," \u4e0e ",(0,a.jsx)(n.code,{children:"leave()"})," \u51fd\u6570."]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"export default {\n  create: _enter,\n  activate: _enter,\n  remove(vnode: VNode, rm: Function) {\n    if (vnode.data.show !== true)\n      leave(vnode, rm)\n    else rm()\n  },\n}\n\nfunction _enter(_: any, vnode: VNodeWithData) {\n  if (vnode.data.show !== true)\n    enter(vnode)\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"group-component",children:"Group Component"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"const TransitionGroup = defineComponent({\n  props: extend(\n    {\n      tag: String,\n      moveClass: String,\n    },\n    transitionProps\n  ),\n\n  beforeMount() {\n    const update = this._update\n    this._update = (vnode, hydrating) => {\n      // force removing pass\n      this.__patch__(\n        this._vnode,\n        this.kept,\n        false, // hydrating\n        true // removeOnly (!important, avoids unnecessary moves)\n      )\n      this._vnode = this.kept\n      update.call(this, vnode, hydrating)\n    }\n  },\n\n  updated() {\n    const children: Array<VNode> = this.prevChildren\n    const moveClass: string = this.moveClass || `${this.name || 'v'}-move`\n\n    if (!children.length || !this.hasMove(children[0].elm, moveClass))\n      return\n\n    // we divide the work into three loops to avoid mixing DOM reads and writes\n    // in each iteration - which helps prevent layout thrashing.\n    children.forEach(callPendingCbs)\n    children.forEach(recordPosition)\n    children.forEach(applyTranslation)\n\n    // force reflow to put everything in position\n    // assign to this to avoid being removed in tree-shaking\n    // $flow-disable-line\n    this._reflow = document.body.offsetHeight\n\n    children.forEach((c: VNode) => {\n      if (c.data.moved) {\n        const el: any = c.elm\n        const s: any = el.style\n        addTransitionClass(el, moveClass)\n        s.transform = s.WebkitTransform = s.transitionDuration = ''\n        el.addEventListener(\n          transitionEndEvent,\n          (el._moveCb = function cb(e) {\n            if (e?.propertyName.endsWith('transform')) {\n              el.removeEventListener(transitionEndEvent, cb)\n              el._moveCb = null\n              removeTransitionClass(el, moveClass)\n            }\n          })\n        )\n      }\n    })\n  },\n\n  methods: {\n    hasMove(el: any, moveClass: string): boolean {\n      if (!hasTransition)\n        return false\n\n      if (this._hasMove)\n        return this._hasMove\n\n      // Detect whether an element with a move class applied has\n      // CSS transitions. Since the element may be inside an entering\n      // transition at this very moment, we make a clone of it and remove\n      // all other transition classes applied to ensure only move class\n      // is applied.\n      const clone: HTMLElement = el.cloneNode()\n\n      if (el._transitionClasses) {\n        el._transitionClasses.forEach((cls: string) => {\n          removeClass(clone, cls)\n        })\n      }\n\n      addClass(clone, moveClass)\n      clone.style.display = 'none'\n      this.$el.appendChild(clone)\n      const info: object = getTransitionInfo(clone)\n      this.$el.removeChild(clone)\n      return (this._hasMove = info.hasTransform)\n    },\n  },\n\n  render(h: Function) {\n    const tag: string = this.tag || this.$vnode.data.tag || 'span'\n    const map: object = Object.create(null)\n    const prevChildren: Array<VNode> = (this.prevChildren = this.children)\n    const rawChildren: Array<VNode> = this.$slots.default || []\n    const children: Array<VNode> = (this.children = [])\n    const transitionData: object = extractTransitionData(this)\n\n    for (let i = 0; i < rawChildren.length; i++) {\n      const c: VNode = rawChildren[i]\n\n      if (c.tag && c.key != null && String(c.key).indexOf('__vList') !== 0) {\n        children.push(c)\n        map[c.key] = c\n        ;(c.data || (c.data = {})).transition = transitionData\n      }\n    }\n\n    if (prevChildren) {\n      const kept: Array<VNode> = []\n      const removed: Array<VNode> = []\n\n      for (let i = 0; i < prevChildren.length; i++) {\n        const c: VNode = prevChildren[i]\n        c.data.transition = transitionData\n        c.data.pos = c.elm.getBoundingClientRect()\n\n        if (map[c.key])\n          kept.push(c)\n        else removed.push(c)\n      }\n\n      this.kept = h(tag, null, kept)\n      this.removed = removed\n    }\n\n    return h(tag, null, children)\n  },\n})\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"Children"})," \u4ece\u65e7\u4f4d\u7f6e\u6309\u7167\u7684\u7f13\u52a8\u65f6\u95f4\u8fc7\u6e21\u504f\u79fb\u5230\u5f53\u524d\u76ee\u6807\u4f4d\u7f6e,\n\u5b9e\u73b0 ",(0,a.jsx)(n.code,{children:"Move"})," \u7684\u8fc7\u6e21\u52a8\u753b:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"function callPendingCbs(c: VNode) {\n  if (c.elm._moveCb)\n    c.elm._moveCb()\n\n  if (c.elm._enterCb)\n    c.elm._enterCb()\n}\n\nfunction recordPosition(c: VNode) {\n  c.data.newPos = c.elm.getBoundingClientRect()\n}\n\nfunction applyTranslation(c: VNode) {\n  const oldPos = c.data.pos\n  const newPos = c.data.newPos\n  const dx = oldPos.left - newPos.left\n  const dy = oldPos.top - newPos.top\n\n  if (dx || dy) {\n    c.data.moved = true\n    const s = c.elm.style\n    s.transform = s.WebkitTransform = `translate(${dx}px,${dy}px)`\n    s.transitionDuration = '0s'\n  }\n}\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},86145:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>r});var s=t(57140);const a={},i=s.createContext(a);function o(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);