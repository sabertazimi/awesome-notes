"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[25267],{30796:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"web/typescript/generic","title":"Generics","description":"Function","source":"@site/content/web/typescript/generic.md","sourceDirName":"web/typescript","slug":"/web/typescript/generic","permalink":"/notes/web/typescript/generic","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/typescript/generic.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"TypeScript","permalink":"/notes/tags/type-script"},{"inline":true,"label":"Generic","permalink":"/notes/tags/generic"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":11,"frontMatter":{"sidebar_position":11,"tags":["Web","TypeScript","Generic"]},"sidebar":"tutorialSidebar","previous":{"title":"Combination","permalink":"/notes/web/typescript/combination"},"next":{"title":"Conditional","permalink":"/notes/web/typescript/conditional"}}');var r=t(35656),i=t(86145);const a={sidebar_position:11,tags:["Web","TypeScript","Generic"]},l="Generics",o={},c=[{value:"Function",id:"function",level:2},{value:"Parameters",id:"parameters",level:2},{value:"Class",id:"class",level:2},{value:"Type Alias",id:"type-alias",level:2},{value:"Discriminated Union",id:"discriminated-union",level:2},{value:"Explicit",id:"explicit",level:2},{value:"Default",id:"default",level:2},{value:"Constrained",id:"constrained",level:2},{value:"Gymnastics",id:"gymnastics",level:2}];function u(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"generics",children:"Generics"})}),"\n",(0,r.jsx)(n.h2,{id:"function",children:"Function"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"function reverse<T>(items: T[]): T[] {\n  const toReturn = []\n  for (let i = items.length - 1; i >= 0; i--)\n    toReturn.push(items[i])\n\n  return toReturn\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"parameters",children:"Parameters"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"type Event\n  = | {\n    type: 'LogIn'\n    payload: {\n      userId: string\n    }\n  }\n  | {\n    type: 'SignOut'\n  }\n\nfunction sendEvent<Type extends Event['type']>(\n  ...args: Extract<Event, { type: Type }> extends { payload: infer Payload }\n    ? [type: Type, payload: Payload]\n    : [type: Type]\n) {\n  // Send event ...\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"class",children:"Class"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// \u521b\u5efa\u4e00\u4e2a\u6cdb\u578b\u7c7b\nclass Queue<T> {\n  private data = []\n  push = (item: T) => this.data.push(item)\n  pop = (): T => this.data.shift()\n}\n\n// \u7b80\u5355\u7684\u4f7f\u7528\nconst queue = new Queue<number>()\nqueue.push(0)\nqueue.push('1') // Error\uff1a\u4e0d\u80fd\u63a8\u5165\u4e00\u4e2a `string`\uff0c\u53ea\u6709 number \u7c7b\u578b\u88ab\u5141\u8bb8\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"interface Listener<T> {\n  (event: T): any\n}\n\ninterface Disposable {\n  dispose: () => any\n}\n\nclass TypedEvent<T> {\n  private listeners: Listener<T>[] = []\n  private listenersOnce: Listener<T>[] = []\n\n  public on = (listener: Listener<T>): Disposable => {\n    this.listeners.push(listener)\n\n    return {\n      dispose: () => this.off(listener),\n    }\n  }\n\n  public once = (listener: Listener<T>): void => {\n    this.listenersOnce.push(listener)\n  }\n\n  public off = (listener: Listener<T>) => {\n    const callbackIndex = this.listeners.indexOf(listener)\n    if (callbackIndex > -1)\n      this.listeners.splice(callbackIndex, 1)\n  }\n\n  public emit = (event: T) => {\n    this.listeners.forEach(listener => listener(event))\n\n    this.listenersOnce.forEach(listener => listener(event))\n    this.listenersOnce = []\n  }\n\n  public pipe = (te: TypedEvent<T>): Disposable => {\n    return this.on(e => te.emit(e))\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"type-alias",children:"Type Alias"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"type CreatesValue<Input, Output> = (input: Input) => Output\n\n// Type: (input: string) => number\nlet creator: CreatesValue<string, number>\n\ncreator = text => text.length // Ok\n\ncreator = text => text.toUpperCase()\n//                ~~~~~~~~~~~~~~~~~~\n// Error: Type 'string' is not assignable to type 'number'.\n"})}),"\n",(0,r.jsx)(n.h2,{id:"discriminated-union",children:"Discriminated Union"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"type Result<Data> = FailureResult | SuccessfulResult<Data>\n\ninterface FailureResult {\n  error: Error\n  succeeded: false\n}\n\ninterface SuccessfulResult<Data> {\n  data: Data\n  succeeded: true\n}\n\nfunction handleResult(result: Result<string>) {\n  if (result.succeeded) {\n    // Type of result: SuccessfulResult<string>\n    console.log(`We did it! ${result.data}`)\n  } else {\n    // Type of result: FailureResult\n    console.error(`Em... ${result.error}`)\n  }\n\n  console.log(result.data)\n  //                 ~~~~\n  // Error: Property 'data' does not exist on type 'Result<string>'.\n  //   Property 'data' does not exist on type 'FailureResult'.\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"explicit",children:"Explicit"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"class Foo<T> {\n  foo: T\n}\n\nconst FooNumber = Foo as { new (): Foo<number> } // ref 1\n\nfunction id<T>(x: T) {\n  return x\n}\n\nconst idNum = id as { (x: number): number }\n"})}),"\n",(0,r.jsx)(n.h2,{id:"default",children:"Default"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"interface Quote<T = string> {\n  value: T\n}\n\nconst explicit: Quote<number> = { value: 123 }\nconst implicit: Quote = {\n  value: 'Be yourself. The world worships the original.',\n}\nconst mismatch: Quote = { value: 123 }\n//                                     ~~~\n// Error: Type 'number' is not assignable to type 'string'.\n\ninterface KeyValuePair<Key, Value = Key> {\n  key: Key\n  value: Value\n}\n\n// Type: KeyValuePair<string, number>\nconst allExplicit: KeyValuePair<string, number> = {\n  key: 'rating',\n  value: 10,\n}\n\n// Type: KeyValuePair<string>\nconst oneDefaulting: KeyValuePair<string> = {\n  key: 'rating',\n  value: 'ten',\n}\n\nconst firstMissing: KeyValuePair = {\n  //            ~~~~~~~~~~~~\n  // Error: Generic type 'KeyValuePair<Key, Value>'\n  // requires between 1 and 2 type arguments.\n  key: 'rating',\n  value: 10,\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"constrained",children:"Constrained"}),"\n",(0,r.jsx)(n.p,{children:"Constrained union types:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"interface Lengthwise {\n  length: number\n}\n\nfunction createList<T extends number | Lengthwise>(): T[] {\n  return [] as T[]\n}\n\nconst numberList = createList<number>() // ok\nconst stringList = createList<string>() // ok\nconst arrayList = createList<any[]>() // ok\nconst boolList = createList<boolean>() // error\n"})}),"\n",(0,r.jsx)(n.p,{children:"Constrained template literal types:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"type RemoveMapsHelper<T> = T extends `maps:${infer U}` ? U : T\ntype RemoveMaps<T> = {\n  [K in keyof T as RemoveMapsHelper<K>]: T[K]\n}\n\ninterface Data {\n  'maps:longitude': string\n  'maps:latitude': string\n  'awesome': boolean\n}\ntype ShapedData = RemoveMaps<Data>\n// type ShapedData = {\n//   longitude: string;\n//   latitude: string;\n//   awesome: boolean;\n// }\n"})}),"\n",(0,r.jsx)(n.p,{children:"Constrained index types:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"function getValue<T, Key extends keyof T>(container: T, key: Key) {\n  return container[key]\n}\n\nconst roles = {\n  favorite: 'Fargo',\n  others: ['Almost Famous', 'Burn After Reading', 'NorthLand'],\n}\n\nconst favorite = getValue(roles, 'favorite') // Type: string\nconst others = getValue(roles, 'others') // Type: string[]\nconst missing = getValue(roles, 'extras')\n//                         ~~~~~~~~\n// Error: Argument of type '\"extras\"' is not assignable\n// to parameter of type '\"favorite\" | \"others\"'.\n\nfunction getDeepValue<\n  T,\n  FirstKey extends keyof T,\n  SecondKey extends keyof T[FirstKey],\n>(target: T, firstKey: FirstKey, secondKey: SecondKey): T[FirstKey][SecondKey] {\n  return target[firstKey][secondKey]\n}\n\nconst target = {\n  foo: {\n    a: true,\n    b: 2,\n  },\n  bar: {\n    c: 'cool',\n    d: 2,\n  },\n}\n\nconst result1 = getDeepValue(target, 'foo', 'a') // boolean\nconst result2 = getDeepValue(target, 'bar', 'c') // string\n"})}),"\n",(0,r.jsx)(n.p,{children:"Constrained default types:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"interface Props {\n  a1: 'Foo'\n  a2: 'Bar'\n  a3: 'FooBar'\n  b1: 'b1'\n  b2: 'b2'\n  b3: 'b3'\n}\n\ntype ExtractValues<T, Keys extends keyof T = Extract<keyof T, `a${string}`>> = {\n  [K in Keys]: T[K]\n}[Keys]\n\ntype Values = ExtractValues<Props>\n// type Values = 'Foo' | 'Bar' | 'FooBar'\n"})}),"\n",(0,r.jsx)(n.h2,{id:"gymnastics",children:"Gymnastics"}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u7c7b\u578b\u7f16\u7a0b\u91cc, \u6cdb\u578b\u5c31\u662f\u53d8\u91cf:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"function pick<T extends object, U extends keyof T>(obj: T, keys: U[]): T[U][] {\n  return keys.map(key => obj[key])\n}\n"})}),"\n",(0,r.jsxs)(n.admonition,{title:"Generic Golden Rule",type:"tip",children:[(0,r.jsxs)(n.p,{children:[(0,r.jsxs)(n.a,{href:"https://effectivetypescript.com/2020/08/12/generics-golden-rule",children:["Type ",(0,r.jsx)(n.code,{children:"T"})," parameters should appear twice"]}),":"]}),(0,r.jsxs)(n.p,{children:["If a type parameter only appears in one location,\nstrongly ",(0,r.jsx)(n.strong,{children:"reconsider"})," if actually need it."]})]})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},86145:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>l});var s=t(57140);const r={},i=s.createContext(r);function a(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);