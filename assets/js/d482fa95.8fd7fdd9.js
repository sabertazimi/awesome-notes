"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[93920],{99558:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"web/security/web","title":"Web","description":"Security Headers","source":"@site/content/web/security/web.md","sourceDirName":"web/security","slug":"/web/security/web","permalink":"/notes/web/security/web","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/security/web.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"DevOps","permalink":"/notes/tags/dev-ops"},{"inline":true,"label":"Security","permalink":"/notes/tags/security"},{"inline":true,"label":"HTTP","permalink":"/notes/tags/http"},{"inline":true,"label":"Headers","permalink":"/notes/tags/headers"},{"inline":true,"label":"Policy","permalink":"/notes/tags/policy"},{"inline":true,"label":"CSP","permalink":"/notes/tags/csp"},{"inline":true,"label":"Crypto","permalink":"/notes/tags/crypto"},{"inline":true,"label":"Privacy","permalink":"/notes/tags/privacy"},{"inline":true,"label":"Fingerprint","permalink":"/notes/tags/fingerprint"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":1,"frontMatter":{"sidebar_position":1,"tags":["Web","DevOps","Security","HTTP","Headers","Policy","CSP","Crypto","Privacy","Fingerprint"]},"sidebar":"tutorialSidebar","previous":{"title":"Security","permalink":"/notes/web/security/"},"next":{"title":"Sandbox","permalink":"/notes/web/security/sandbox"}}');var s=r(35656),t=r(86145);const c={sidebar_position:1,tags:["Web","DevOps","Security","HTTP","Headers","Policy","CSP","Crypto","Privacy","Fingerprint"]},l="Web",d={},o=[{value:"Security Headers",id:"security-headers",level:2},{value:"Same Origin Policy",id:"same-origin-policy",level:2},{value:"Content Security Policy",id:"content-security-policy",level:2},{value:"Trusted Types",id:"trusted-types",level:2},{value:"Crypto",id:"crypto",level:2},{value:"User Privacy",id:"user-privacy",level:2},{value:"Browser Privacy",id:"browser-privacy",level:3},{value:"User Fingerprint",id:"user-fingerprint",level:3}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"web",children:"Web"})}),"\n",(0,s.jsx)(n.h2,{id:"security-headers",children:"Security Headers"}),"\n",(0,s.jsxs)(n.p,{children:["Security headers ",(0,s.jsx)(n.a,{href:"https://web.dev/security-headers",children:"list"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/HTTP/Headers/X-Content-Type-Options",children:"X-Content-Type-Options"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/HTTP/Headers/X-Frame-Options",children:"X-Frame-Options"}),":","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"DENY"}),": \u7981\u6b62\u88ab\u52a0\u8f7d\u8fdb\u4efb\u4f55 frame."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"SAMEORIGIN"}),": \u4ec5\u5141\u8bb8\u88ab\u52a0\u8f7d\u8fdb\u540c\u57df\u5185\u7684 frame."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/HTTP/Headers/X-XSS-Protection",children:"X-XSS-Protection"}),":","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"0"})," :\u8868\u793a\u7981\u7528\u8fd9\u4e2a\u7b56\u7565."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"1"}),": \u9ed8\u8ba4, \u5bf9\u5371\u9669\u811a\u672c\u505a\u4e00\u4e9b\u6807\u5fd7\u6216\u4fee\u6539, \u4ee5\u963b\u6b62\u5728\u6d4f\u89c8\u5668\u4e0a\u6e32\u67d3\u6267\u884c."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"1; mode=block"}),": \u5f3a\u5236\u4e0d\u6e32\u67d3."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Setting ",(0,s.jsx)(n.code,{children:"Content-Security-Policy"})," header."]}),"\n",(0,s.jsx)(n.li,{children:"Ensure all connections to be HTTPS."}),"\n",(0,s.jsxs)(n.li,{children:["Avoid Clicking-jacking using ",(0,s.jsx)(n.code,{children:"X-Frame-Options"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Disable ",(0,s.jsx)(n.code,{children:"X-Powered-By"})," header."]}),"\n",(0,s.jsxs)(n.li,{children:["Not put sensitive data in URL query and ",(0,s.jsx)(n.code,{children:"Referer"})," header."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"same-origin-policy",children:"Same Origin Policy"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"origin"})," = ",(0,s.jsx)(n.code,{children:"protocol"})," + ",(0,s.jsx)(n.code,{children:"domain"})," + ",(0,s.jsx)(n.code,{children:"port"}),":"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:(0,s.jsx)(n.code,{children:"http://www.foo.com"})}),(0,s.jsx)(n.th,{children:"Same Origin"}),(0,s.jsx)(n.th,{})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"https://www.foo.com"})}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"protocol"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"http://app.foo.com"})}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"domain"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"http://foo.com"})}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"domain"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"http://www.foo.com:8080"})}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"port"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"http://www.foo.com/a/"})}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{})]})]})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "Access-Control-Allow-Origin": "https://api.foo.com"\n}\n'})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u7531\u5ba2\u6237\u7aef HTML \u6807\u7b7e\u7b49\u53d1\u51fa\u7684\u8de8\u57df ",(0,s.jsx)(n.code,{children:"GET"})," \u8bf7\u6c42\u9ed8\u8ba4\u5408\u6cd5, \u6784\u6210\u5f00\u653e\u7684 Web \u4e16\u754c:\n\u901a\u8fc7 ",(0,s.jsx)(n.code,{children:"src"})," \u5c5e\u6027\u52a0\u8f7d\u7684\u8d44\u6e90, \u6d4f\u89c8\u5668\u9650\u5236\u4e86 JavaScript \u7684\u6743\u9650, \u4f7f\u5176\u4e0d\u80fd\u8bfb\u5199\u8fd4\u56de\u7684\u5185\u5bb9."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"XMLHttpRequest"})," \u53d7\u540c\u6e90\u7b56\u7565\u9650\u5236: \u9ed8\u8ba4\u53ea\u80fd\u8bbf\u95ee\u540c\u6e90\u5bf9\u8c61\u7684\u5185\u5bb9."]}),"\n",(0,s.jsx)(n.li,{children:"Cookie \u53d7\u540c\u6e90\u7b56\u7565\u9650\u5236."}),"\n",(0,s.jsxs)(n.li,{children:["Web storage \u53d7\u540c\u6e90\u7b56\u7565\u9650\u5236:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Local storage."}),"\n",(0,s.jsx)(n.li,{children:"Session storage."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"content-security-policy",children:"Content Security Policy"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://github.com/foundeo/content-security-policy.com",children:(0,s.jsx)(n.code,{children:"CSP"})}),"\nhelp prevent from ",(0,s.jsx)(n.code,{children:"XSS"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"{\n  \"header\": {\n    \"Content-Security-Policy\":\n      allow 'self';\n      script-src 'nonce-random123' 'strict-dynamic' 'unsafe-eval' script.example.com;\n      media-src media.example.com;\n      img-src img.example.com;\n      object-src 'none';\n      base-uri 'none'\n  }\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Basic CSP ",(0,s.jsx)(n.a,{href:"https://www.writesoftwarewell.com/content-security-policy",children:"usage"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:"<meta\n  http-equiv=\"Content-Security-Policy\"\n  content=\"script-src 'self' https://safe-external-site.com; style-src 'self'\"\n/>\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"upgrade-insecure-requests"}),"\n\u6307\u793a\u6d4f\u89c8\u5668\u5728\u53d1\u51fa\u7f51\u7edc\u8bf7\u6c42\u4e4b\u524d\u5347\u7ea7\u4e0d\u5b89\u5168\u7684 ",(0,s.jsx)(n.code,{children:"URL"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests" />\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"block-all-mixed-content"}),"\n\u6307\u793a\u6d4f\u89c8\u5668\u6c38\u4e0d\u52a0\u8f7d\u6df7\u5408\u5185\u5bb9,\n\u6240\u6709\u6df7\u5408\u5185\u5bb9\u8d44\u6e90\u8bf7\u6c42\u90fd\u4f1a\u88ab\u963b\u6b62,\n\u5305\u62ec\u4e3b\u52a8\u548c\u88ab\u52a8\u6df7\u5408\u5185\u5bb9:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<meta http-equiv="Content-Security-Policy" content="block-all-mixed-content" />\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"nonce"}),"-only ",(0,s.jsx)(n.code,{children:"CSP"})," block 3rd scripts and dynamic scripts generate by trusted users:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<script nonce="random123">\n  alert(\'this is fine!\')\n<\/script>\n<script nonce="random123" src="https://cdnjs.com/lib.js"><\/script>\n\x3c!-- XSS injected by attacker - blocked by CSP --\x3e\n<script>\n  alert(\'xss\')\n<\/script>\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"strict-dynamic"})," ",(0,s.jsx)(n.code,{children:"CSP"})," allow dynamic scripts generate by trusted users:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:"\x3c!-- Content-Security-Policy: script-src 'nonce-random123' 'strict-dynamic' --\x3e\n<script nonce=\"random123\">\n  const s = document.createElement('script')\n  s.src = '/path/to/script.js'\n  s.async = true\n  document.head.appendChild(s) // can execute correctly\n<\/script>\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"domain"}),"-specific ",(0,s.jsx)(n.code,{children:"CSP"})," block untrusted domain scripts:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'\x3c!-- Given this CSP header --\x3e\n\x3c!-- Content-Security-Policy: script-src https://example.com/ --\x3e\n\x3c!-- The following third-party script will not be loaded or executed --\x3e\n<script src="https://not-example.com/js/library.js"><\/script>\n'})}),"\n",(0,s.jsx)(n.h2,{id:"trusted-types",children:"Trusted Types"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"TrustedURL."}),"\n",(0,s.jsx)(n.li,{children:"TrustedHTML."}),"\n",(0,s.jsx)(n.li,{children:"TrustedScript."}),"\n",(0,s.jsx)(n.li,{children:"TrustedScriptURL."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// fallback policy\nTrustedTypes.createPolicy(\n  'default',\n  {\n    createHTML(s) {\n      console.error('Please fix! Insecure string assignment detected:', s)\n      return s\n    },\n  },\n  true\n)\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// Content-Security-Policy-Report-Only: trusted-types myPolicy; report-uri /cspReport\nconst SanitizingPolicy = TrustedTypes.createPolicy(\n  'myPolicy',\n  {\n    createHTML: (s: string) => myCustomSanitizer(s),\n  },\n  false\n)\n\nconst trustedHTML = SanitizingPolicy.createHTML(foo)\nelement.innerHTML = trustedHTML\n"})}),"\n",(0,s.jsx)(n.h2,{id:"crypto",children:"Crypto"}),"\n",(0,s.jsxs)(n.p,{children:["Web crypto ",(0,s.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/API/SubtleCrypto",children:"API"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u516c\u94a5\u52a0\u5bc6\u79c1\u94a5\u89e3\u5bc6: \u53ea\u6709\u79c1\u94a5\u62e5\u6709\u8005\u53ef\u4ee5\u83b7\u53d6\u4fe1\u606f, e.g. HTTPS \u4f1a\u8bdd\u5bc6\u94a5\u4f20\u8f93."}),"\n",(0,s.jsx)(n.li,{children:"\u516c\u94a5\u89e3\u5bc6\u79c1\u94a5\u52a0\u5bc6: \u53ea\u6709\u79c1\u94a5\u62e5\u6709\u8005\u53ef\u4ee5\u53d1\u5e03\u7b7e\u540d, e.g. \u6570\u5b57\u7b7e\u540d."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"user-privacy",children:"User Privacy"}),"\n",(0,s.jsx)(n.h3,{id:"browser-privacy",children:"Browser Privacy"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Browser ",(0,s.jsx)(n.a,{href:"https://browserleaks.com",children:"leaks"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/neberej/exposedbydefault",children:"Exposed"})," by default."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"user-fingerprint",children:"User Fingerprint"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://github.com/neberej/exposedbydefault",children:"User fingerprint"})," can generate by:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Use Canvas or WebGL to generate user\n",(0,s.jsx)(n.a,{href:"https://yinzhicao.org/TrackingFree/crossbrowsertracking_NDSS17.pdf",children:"fingerprint"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Location information:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Country."}),"\n",(0,s.jsx)(n.li,{children:"Region."}),"\n",(0,s.jsx)(n.li,{children:"City."}),"\n",(0,s.jsx)(n.li,{children:"Zip code."}),"\n",(0,s.jsx)(n.li,{children:"Latitude."}),"\n",(0,s.jsx)(n.li,{children:"Longitude."}),"\n",(0,s.jsx)(n.li,{children:"Timezone."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Connection information:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"IP address."}),"\n",(0,s.jsx)(n.li,{children:"Internet service provider."}),"\n",(0,s.jsx)(n.li,{children:"Organization."}),"\n",(0,s.jsx)(n.li,{children:"ASN."}),"\n",(0,s.jsx)(n.li,{children:"Tor browser detection."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Software information:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Browser."}),"\n",(0,s.jsx)(n.li,{children:"Browser plugins detection."}),"\n",(0,s.jsx)(n.li,{children:"Operation system."}),"\n",(0,s.jsx)(n.li,{children:"User agent."}),"\n",(0,s.jsx)(n.li,{children:"Preferred language."}),"\n",(0,s.jsx)(n.li,{children:"Cookie enabled detection."}),"\n",(0,s.jsx)(n.li,{children:"Java enabled detection."}),"\n",(0,s.jsx)(n.li,{children:"DNT header enabled detection."}),"\n",(0,s.jsx)(n.li,{children:"Automated browser detection."}),"\n",(0,s.jsx)(n.li,{children:"Content filters detection: Adblock detection."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Hardware information:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Screen resolution."}),"\n",(0,s.jsx)(n.li,{children:"Color resolution."}),"\n",(0,s.jsx)(n.li,{children:"Device type."}),"\n",(0,s.jsx)(n.li,{children:"Device memory."}),"\n",(0,s.jsx)(n.li,{children:"CPU cores."}),"\n",(0,s.jsx)(n.li,{children:"Max touch points."}),"\n",(0,s.jsx)(n.li,{children:"WebGL vendor."}),"\n",(0,s.jsx)(n.li,{children:"WebGL renderer."}),"\n",(0,s.jsx)(n.li,{children:"Battery level."}),"\n",(0,s.jsx)(n.li,{children:"Battery status."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"function getCanvasFingerprint() {\n  const canvas = document.createElement('canvas')\n  const context = canvas.getContext('2d')\n  context.font = '18pt Arial'\n  context.textBaseline = 'top'\n  context.fillText('Hello, user.', 2, 2)\n  return canvas.toDataURL('image/jpeg')\n}\n\ngetCanvasFingerprint()\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},86145:(e,n,r)=>{r.d(n,{R:()=>c,x:()=>l});var i=r(57140);const s={},t=i.createContext(s);function c(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);