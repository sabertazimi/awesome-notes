"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[76634],{77342:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>a,contentTitle:()=>d,default:()=>m,frontMatter:()=>c,metadata:()=>s,toc:()=>r});const s=JSON.parse('{"id":"programming/design/patterns/command","title":"Command","description":"\u9700\u8981\u5411\u67d0\u4e9b\u5bf9\u8c61\u53d1\u9001\u8bf7\u6c42:","source":"@site/content/programming/design/patterns/command.md","sourceDirName":"programming/design/patterns","slug":"/programming/design/patterns/command","permalink":"/notes/programming/design/patterns/command","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/programming/design/patterns/command.md","tags":[{"inline":true,"label":"Programming","permalink":"/notes/tags/programming"},{"inline":true,"label":"Design","permalink":"/notes/tags/design"},{"inline":true,"label":"Design Pattern","permalink":"/notes/tags/design-pattern"},{"inline":true,"label":"Behavioral Pattern","permalink":"/notes/tags/behavioral-pattern"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":14,"frontMatter":{"sidebar_position":14,"tags":["Programming","Design","Design Pattern","Behavioral Pattern"]},"sidebar":"tutorialSidebar","previous":{"title":"Chain of Responsibility","permalink":"/notes/programming/design/patterns/chain-of-responsibility"},"next":{"title":"Iterator","permalink":"/notes/programming/design/patterns/iterator"}}');var i=t(35656),o=t(86145);const c={sidebar_position:14,tags:["Programming","Design","Design Pattern","Behavioral Pattern"]},d="Command",a={},r=[];function l(n){const e={admonition:"admonition",code:"code",h1:"h1",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"command",children:"Command"})}),"\n",(0,i.jsx)(e.p,{children:"\u9700\u8981\u5411\u67d0\u4e9b\u5bf9\u8c61\u53d1\u9001\u8bf7\u6c42:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u89e3\u8026\u547d\u4ee4: \u4e0d\u6e05\u695a\u8bf7\u6c42\u5177\u4f53\u64cd\u4f5c."}),"\n",(0,i.jsx)(e.li,{children:"\u89e3\u8026\u63a5\u6536\u8005: \u4e0d\u6e05\u695a\u8bf7\u6c42\u7684\u63a5\u6536\u8005 (\u591a\u4e2a\u5bf9\u8c61\u4e2d\u7684\u67d0\u4e2a\u968f\u673a\u5bf9\u8c61)."}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"\u6b64\u65f6\u5e0c\u671b\u7528\u4e00\u79cd\u677e\u8026\u5408\u7684\u65b9\u5f0f\u6765\u8bbe\u8ba1\u7a0b\u5e8f, \u4f7f\u5f97\u8bf7\u6c42\u53d1\u9001\u8005\u548c\u8bf7\u6c42\u63a5\u6536\u8005\u80fd\u591f\u6d88\u9664\u5f7c\u6b64\u7684\u8026\u5408\u5173\u7cfb:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u5c06\u65b9\u6cd5/\u52a8\u4f5c\u5c01\u88c5\u6210\u5bf9\u8c61, \u4f7f\u5f97\u5916\u90e8\u901a\u8fc7\u552f\u4e00\u65b9\u6cd5 ",(0,i.jsx)(e.code,{children:"execute()"}),"/",(0,i.jsx)(e.code,{children:"run()"})," \u8c03\u7528\u5185\u90e8\u65b9\u6cd5/\u52a8\u4f5c."]}),"\n",(0,i.jsxs)(e.li,{children:["\u89e3\u8026\u4e09\u8005: \u5ba2\u6237\u521b\u5efa\u547d\u4ee4, \u8c03\u7528\u8005\u6267\u884c\u8be5\u547d\u4ee4, \u63a5\u6536\u8005\u5728\u547d\u4ee4\u6267\u884c\u65f6\u6267\u884c\u76f8\u5e94\u64cd\u4f5c.","\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5ba2\u6237\u901a\u5e38\u88ab\u5305\u88c5\u4e3a\u4e00\u4e2a\u547d\u4ee4\u5bf9\u8c61."}),"\n",(0,i.jsxs)(e.li,{children:["\u8c03\u7528\u8005\u63a5\u8fc7\u547d\u4ee4\u5e76\u5c06\u5176\u4fdd\u5b58\u4e0b\u6765, \u5b83\u4f1a\u5728\u67d0\u4e2a\u65f6\u5019\u8c03\u7528\u8be5\u547d\u4ee4\u5bf9\u8c61\u7684 ",(0,i.jsx)(e.code,{children:"Command.execute()"})," \u65b9\u6cd5."]}),"\n",(0,i.jsxs)(e.li,{children:["\u8c03\u7528\u8005\u8c03\u7528 ",(0,i.jsx)(e.code,{children:"Command.execute()"})," \u540e, \u6700\u7ec8\u5c06\u8c03\u7528\u63a5\u6536\u8005\u65b9\u6cd5 ",(0,i.jsx)(e.code,{children:"Receiver.action()"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.admonition,{title:"Command Use Case",type:"tip",children:(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["Decouple ",(0,i.jsx)(e.code,{children:"Executor"})," and ",(0,i.jsx)(e.code,{children:"Receiver"}),"."]}),"\n",(0,i.jsxs)(e.li,{children:["GUI applications: bind ",(0,i.jsx)(e.code,{children:"Command"})," to UI components."]}),"\n",(0,i.jsxs)(e.li,{children:["Command sequences (store commands + ",(0,i.jsx)(e.code,{children:"Composite"})," pattern) for batch processing:\n",(0,i.jsx)(e.code,{children:"Macro"}),"/",(0,i.jsx)(e.code,{children:"Batch"}),"/",(0,i.jsx)(e.code,{children:"Undo"}),"/",(0,i.jsx)(e.code,{children:"Redo"})," feature."]}),"\n",(0,i.jsxs)(e.li,{children:["Command queue (cache commands + ",(0,i.jsx)(e.code,{children:"Observer"})," pattern) for transaction management:\n",(0,i.jsx)(e.code,{children:"Redis"}),"/",(0,i.jsx)(e.code,{children:"RabbitMQ"}),"/",(0,i.jsx)(e.code,{children:"Kafka"}),"."]}),"\n"]})}),"\n",(0,i.jsxs)(e.p,{children:["\u5728 JS \u4e2d, ",(0,i.jsx)(e.code,{children:"Closure"})," + ",(0,i.jsx)(e.code,{children:"Callback"})," (",(0,i.jsx)(e.code,{children:"Higher Order Function"}),") \u53ef\u4ee5\u5b9e\u73b0\u9690\u5f0f\u7684\u547d\u4ee4\u6a21\u5f0f:"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"Closure"})," \u6355\u83b7 ",(0,i.jsx)(e.code,{children:"Receiver"})," (\u9762\u5411\u5bf9\u8c61\u8bed\u8a00\u4e2d, ",(0,i.jsx)(e.code,{children:"Command"})," \u5bf9\u8c61\u9700\u8981\u6301\u6709 ",(0,i.jsx)(e.code,{children:"Receiver"})," \u5bf9\u8c61)."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"Callback"})," \u51fd\u6570\u5b9e\u73b0\u5177\u4f53\u903b\u8f91 (\u9762\u5411\u5bf9\u8c61\u8bed\u8a00\u4e2d, \u9700\u8981\u5c06\u5176\u5c01\u88c5\u8fdb ",(0,i.jsx)(e.code,{children:"Command.execute()"})," \u5bf9\u8c61\u65b9\u6cd5)."]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-ts",children:"// Higher order function\nconst Command = receiver => () => receiver.action()\n"})}),"\n",(0,i.jsxs)(e.p,{children:["Bind ",(0,i.jsx)(e.code,{children:"Command"})," to UI components:"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"Executor"}),": UI components."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"Client"})," and ",(0,i.jsx)(e.code,{children:"Receiver"}),": background tasks or other UI components."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"Executor"})," -> ",(0,i.jsx)(e.code,{children:"Client"})," ",(0,i.jsx)(e.code,{children:"Command.execute()"})," -> ",(0,i.jsx)(e.code,{children:"Receiver.action()"}),":\ne.g. click ",(0,i.jsx)(e.code,{children:"button"})," -> refresh ",(0,i.jsx)(e.code,{children:"menu"}),"."]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-ts",children:"// Executor\nclass Button {\n  commands = new Set()\n\n  add(command) {\n    this.commands.set(command)\n  }\n\n  click() {\n    for (const command of this.commands) command.execute()\n  }\n}\n\n// Client: command object, `action` implemented\nclass Command {\n  constructor(receiver) {\n    this.receiver = receiver\n  }\n\n  execute() {\n    this.receiver.action()\n  }\n}\n\n// Receiver\nclass MenuBar {\n  action() {\n    this.refresh()\n  }\n\n  refresh() {\n    console.log('refresh menu pages')\n  }\n}\n\nconst button = new Button()\nconst menuBar = new MenuBar()\nconst refreshMenuBarCommand = new Command(menuBar)\n\nbutton.add(refreshMenuBarCommand)\nbutton.click()\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-ts",children:"class MenuCommand {\n  constructor(action) {\n    this.action = action\n  }\n\n  execute() {\n    this.action()\n  }\n}\n\n// --------------\nconst appMenuBar = new MenuBar()\n\n// --------------\nconst fileActions = new FileActions()\nconst EditActions = new EditActions()\nconst InsertActions = new InsertActions()\nconst HelpActions = new HelpActions()\n\n// --------------\nconst openCommand = new MenuCommand(fileActions.open)\nconst closeCommand = new MenuCommand(fileActions.close)\nconst saveCommand = new MenuCommand(fileActions.save)\nconst saveAsCommand = new MenuCommand(fileActions.saveAs)\nconst fileMenu = new Menu('File')\nfileMenu.add(new MenuItem('open', openCommand))\nfileMenu.add(new MenuItem('Close', closeCommand))\nfileMenu.add(new MenuItem('Save', saveCommand))\nfileMenu.add(new MenuItem('Close', saveAsCommand))\nappMenuBar.add(fileMenu)\n\n// --------------\nconst cutCommand = new MenuCommand(EditActions.cut)\nconst copyCommand = new MenuCommand(EditActions.copy)\nconst pasteCommand = new MenuCommand(EditActions.paste)\nconst deleteCommand = new MenuCommand(EditActions.delete)\nconst editMenu = new Menu('Edit')\neditMenu.add(new MenuItem('Cut', cutCommand))\neditMenu.add(new MenuItem('Copy', copyCommand))\neditMenu.add(new MenuItem('Paste', pasteCommand))\neditMenu.add(new MenuItem('Delete', deleteCommand))\nappMenuBar.add(editMenu)\n\n// --------------\nconst textBlockCommand = new MenuCommand(InsertActions.textBlock)\nconst insertMenu = new Menu('Insert')\ninsertMenu.add(new MenuItem('Text  Block', textBlockCommand))\nappMenuBar.add(insertMenu)\n\n// --------------\nconst showHelpCommand = new MenuCommand(HelpActions.showHelp())\nconst helpMenu = new Menu('Help')\nhelpMenu.add(new MenuItem('Show Help', showHelpCommand))\nappMenuBar.add(helpMenu)\n\n// --------------\ndocument.getElementsByTagName('body')[0].appendChild(appMenuBar.getElement())\nappMenuBar.show()\n"})}),"\n",(0,i.jsxs)(e.p,{children:["Command sequences to implement ",(0,i.jsx)(e.code,{children:"Macro"}),"/",(0,i.jsx)(e.code,{children:"Batch"}),"/",(0,i.jsx)(e.code,{children:"Undo"}),"/",(0,i.jsx)(e.code,{children:"Redo"})," feature:"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-ts",children:"class Cursor {\n  constructor(width, height, parent) {\n    this.commandStack = []\n    this.width = width\n    this.height = height\n\n    this.canvas = document.createElement('canvas')\n    this.canvas.width = this.width\n    this.canvas.height = this.height\n    parent.appendChild(this.canvas)\n\n    this.ctx = this.canvas.getContext('2d')\n    this.ctx.fillStyle = '#CCC000'\n    this.move(0, 0)\n  }\n\n  move(x, y) {\n    this.commandStack.push(() => {\n      // `this` point to `Cursor`.\n      this.lineTo(x, y)\n    })\n  }\n\n  lineTo(x, y) {\n    this.position.x += x\n    this.position.y += y\n    this.ctx.lineTo(this.position.x, this.position.y)\n  }\n\n  executeCommands() {\n    this.position = { x: this.width / 2, y: this.height / 2 }\n    this.ctx.clearRect(0, 0, this.width, this.height)\n    this.ctx.beginPath()\n    this.ctx.moveTo(this.position.x, this.position.y)\n\n    for (let i = 0; i < this.commandStack.length; i++) this.commandStack[i]()\n\n    this.ctx.stroke()\n  }\n\n  undo() {\n    this.commandStack.pop()\n    this.executeCommands()\n  }\n}\n"})})]})}function m(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(l,{...n})}):l(n)}},86145:(n,e,t)=>{t.d(e,{R:()=>c,x:()=>d});var s=t(57140);const i={},o=s.createContext(i);function c(n){const e=s.useContext(o);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:c(n.components),s.createElement(o.Provider,{value:e},n.children)}}}]);