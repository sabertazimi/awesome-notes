"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[35883],{66206:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"web/javascript/iterator","title":"Iterator","description":"Protocol","source":"@site/content/web/javascript/iterator.md","sourceDirName":"web/javascript","slug":"/web/javascript/iterator","permalink":"/notes/web/javascript/iterator","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/javascript/iterator.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"JavaScript","permalink":"/notes/tags/java-script"},{"inline":true,"label":"ECMAScript","permalink":"/notes/tags/ecma-script"},{"inline":true,"label":"Iterator","permalink":"/notes/tags/iterator"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":18,"frontMatter":{"sidebar_position":18,"tags":["Web","JavaScript","ECMAScript","Iterator"]},"sidebar":"tutorialSidebar","previous":{"title":"Function","permalink":"/notes/web/javascript/function"},"next":{"title":"Generator","permalink":"/notes/web/javascript/generator"}}');var o=t(35656),s=t(86145);const i={sidebar_position:18,tags:["Web","JavaScript","ECMAScript","Iterator"]},a="Iterator",l={},c=[{value:"Protocol",id:"protocol",level:2},{value:"Synchronous",id:"synchronous",level:2},{value:"Object",id:"object",level:3},{value:"Class",id:"class",level:3},{value:"Asynchronous",id:"asynchronous",level:2},{value:"Closable",id:"closable",level:2}];function d(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.header,{children:(0,o.jsx)(e.h1,{id:"iterator",children:"Iterator"})}),"\n",(0,o.jsx)(e.h2,{id:"protocol",children:"Protocol"}),"\n",(0,o.jsxs)(e.p,{children:["Iteration ",(0,o.jsx)(e.a,{href:"https://developer.mozilla.org/docs/Web/JavaScript/Reference/Iteration_protocols",children:"protocol"}),":"]}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:["\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u53ea\u8981\u5b9e\u73b0\u4e86 ",(0,o.jsx)(e.code,{children:"[Symbol.iterator]()"})," \u63a5\u53e3, \u4fbf\u53ef\u6210\u4e3a\u53ef\u8fed\u4ee3\u6570\u636e\u7ed3\u6784 (",(0,o.jsx)(e.code,{children:"Iterable"}),"):","\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:["String: ",(0,o.jsx)(e.code,{children:"StringIterator"}),"."]}),"\n",(0,o.jsxs)(e.li,{children:["Array: ",(0,o.jsx)(e.code,{children:"ArrayIterator"}),"."]}),"\n",(0,o.jsxs)(e.li,{children:["Map: ",(0,o.jsx)(e.code,{children:"MapIterator"}),"."]}),"\n",(0,o.jsxs)(e.li,{children:["Set: ",(0,o.jsx)(e.code,{children:"SetIterator"}),"."]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.code,{children:"arguments"})," \u5bf9\u8c61."]}),"\n",(0,o.jsxs)(e.li,{children:["DOM collection (",(0,o.jsx)(e.code,{children:"NodeList"}),"): ",(0,o.jsx)(e.code,{children:"ArrayIterator"}),"."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(e.li,{children:["\u63a5\u6536\u53ef\u8fed\u4ee3\u5bf9\u8c61\u7684\u539f\u751f\u8bed\u8a00\u7279\u6027:","\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.code,{children:"for...in"}),"/",(0,o.jsx)(e.code,{children:"for...of"}),"."]}),"\n",(0,o.jsx)(e.li,{children:"Destructing: \u6570\u7ec4\u89e3\u6784."}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.code,{children:"..."}),": \u6269\u5c55\u64cd\u4f5c\u7b26 (",(0,o.jsx)(e.code,{children:"Spread Operator"}),")."]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.code,{children:"Array.from()"}),"."]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.code,{children:"new Map()"}),"."]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.code,{children:"new Set()"}),"."]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.code,{children:"Promise.all()"}),"."]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.code,{children:"Promise.race()"}),"."]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.code,{children:"yield*"})," \u64cd\u4f5c\u7b26."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.code,{children:"for...in"}),"/",(0,o.jsx)(e.code,{children:"for...of"})," \u9690\u5f62\u8c03\u7528\u8fed\u4ee3\u5668\u7684\u65b9\u5f0f, \u79f0\u4e3a\u5185\u90e8\u8fed\u4ee3\u5668, \u4f7f\u7528\u65b9\u4fbf, \u4e0d\u53ef\u81ea\u5b9a\u4e49\u8fed\u4ee3\u8fc7\u7a0b."]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.code,{children:"{ next, done, value }"})," \u663e\u5f0f\u8c03\u7528\u8fed\u4ee3\u5668\u7684\u65b9\u5f0f, \u79f0\u4e3a\u5916\u90e8\u8fed\u4ee3\u5668, \u4f7f\u7528\u590d\u6742, \u53ef\u4ee5\u81ea\u5b9a\u4e49\u8fed\u4ee3\u8fc7\u7a0b."]}),"\n",(0,o.jsxs)(e.li,{children:["All built-in ES6 iterators are ",(0,o.jsx)(e.code,{children:"Self Iterable Iterator"}),"."]}),"\n"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"interface Iterable<T> {\n  [Symbol.iterator]: () => Iterator<T>\n}\n\ninterface Iterator<T> {\n  next: (...args: []) => IteratorResult<T>\n  return?: (value?: T) => IteratorResult<T> // Closable iterator\n  throw?: (e?: any) => IteratorResult<T>\n}\n\ninterface IterableIterator<T> extends Iterator<T> {\n  [Symbol.iterator]: () => IterableIterator<T>\n}\n\ninterface AsyncIterable<T> {\n  [Symbol.asyncIterator]: () => AsyncIterator<T>\n}\n\ninterface AsyncIterator<T> {\n  next: (...args: []) => Promise<IteratorResult<T>>\n  throw?: (e?: any) => Promise<IteratorResult<T>>\n  // Closable iterator\n  return?: (value?: T | PromiseLike<T>) => Promise<IteratorResult<T>>\n}\n\ninterface AsyncIterableIterator<T> extends AsyncIterator<T> {\n  [Symbol.asyncIterator]: () => AsyncIterableIterator<T>\n}\n\ninterface IteratorResult<T> {\n  done: boolean\n  value: T\n}\n"})}),"\n",(0,o.jsx)(e.h2,{id:"synchronous",children:"Synchronous"}),"\n",(0,o.jsx)(e.h3,{id:"object",children:"Object"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"function methodsIterator() {\n  let index = 0\n  const methods = Object.keys(this)\n    .filter((key) => {\n      return typeof this[key] === 'function'\n    })\n    .map(key => this[key])\n\n  // iterator object\n  return {\n    next: () => ({\n      // Conform to Iterator protocol\n      done: index >= methods.length,\n      value: methods[index++],\n    }),\n  }\n}\n\nconst myMethods = {\n  toString() {\n    return '[object myMethods]'\n  },\n  sumNumbers(a, b) {\n    return a + b\n  },\n  numbers: [1, 5, 6],\n  [Symbol.iterator]: methodsIterator, // Conform to Iterable Protocol\n}\n\nfor (const method of myMethods)\n  console.log(method) // logs methods `toString` and `sumNumbers`\n"})}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"function zip(...iterables) {\n  const iterators = iterables.map(i => i[Symbol.iterator]())\n  let done = false\n\n  return {\n    [Symbol.iterator]() {\n      return this\n    },\n    next() {\n      if (!done) {\n        const items = iterators.map(i => i.next())\n        done = items.some(item => item.done)\n\n        if (!done)\n          return { value: items.map(i => i.value) }\n\n        // Done for the first time: close all iterators\n        for (const iterator of iterators) {\n          if (typeof iterator.return === 'function')\n            iterator.return()\n        }\n      }\n\n      // We are done\n      return { done: true }\n    },\n  }\n}\n\nconst zipped = zip(['a', 'b', 'c'], ['d', 'e', 'f', 'g'])\n\nfor (const x of zipped)\n  console.log(x)\n\n// Output:\n// ['a', 'd']\n// ['b', 'e']\n// ['c', 'f']\n"})}),"\n",(0,o.jsx)(e.h3,{id:"class",children:"Class"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"class Counter {\n  constructor(limit) {\n    this.limit = limit\n  }\n\n  [Symbol.iterator]() {\n    let count = 1\n    const limit = this.limit\n\n    return {\n      next() {\n        if (count <= limit)\n          return { done: false, value: count++ }\n        else\n          return { done: true }\n      },\n      return() {\n        console.log('Exiting early')\n        return { done: true }\n      },\n    }\n  }\n}\n\nconst counter1 = new Counter(5)\nfor (const i of counter1) {\n  if (i > 2)\n    break\n\n  console.log(i)\n}\n// 1\n// 2\n// Exiting early\n\nconst counter2 = new Counter(5)\ntry {\n  for (const i of counter2) {\n    if (i > 2)\n      throw new Error('err')\n\n    console.log(i)\n  }\n} catch (e) {}\n// 1\n// 2\n// Exiting early\n\nconst counter3 = new Counter(5)\nconst [a, b] = counter3\n// Exiting early\n"})}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"// Class Iterator:\nclass MatrixIterator {\n  constructor(matrix) {\n    this.x = 0\n    this.y = 0\n    this.matrix = matrix\n  }\n\n  next() {\n    if (this.y === this.matrix.height)\n      return { done: true }\n\n    const value = {\n      x: this.x,\n      y: this.y,\n      value: this.matrix.get(this.x, this.y),\n    }\n\n    this.x++\n\n    if (this.x === this.matrix.width) {\n      this.x = 0\n      this.y++\n    }\n\n    return { value, done: false }\n  }\n}\n\n// Iterable Class:\nclass Matrix {\n  constructor(width, height, element = (x, y) => undefined) {\n    this.width = width\n    this.height = height\n    this.content = []\n\n    for (let y = 0; y < height; y++) {\n      for (let x = 0; x < width; x++)\n        this.content[y * width + x] = element(x, y)\n    }\n  }\n\n  get(x, y) {\n    return this.content[y * this.width + x]\n  }\n\n  set(x, y, value) {\n    this.content[y * this.width + x] = value\n  }\n\n  [Symbol.iterator]() {\n    return new MatrixIterator(this)\n  }\n}\n\nconst matrix = new Matrix(2, 2, (x, y) => `value ${x},${y}`)\n\nfor (const { x, y, value } of matrix)\n  console.log(x, y, value)\n\n// \u2192 0 0 value 0, 0\n// \u2192 1 0 value 1, 0\n// \u2192 0 1 value 0, 1\n// \u2192 1 1 value 1, 1\n"})}),"\n",(0,o.jsx)(e.h2,{id:"asynchronous",children:"Asynchronous"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"const AsyncIterable = {\n  [Symbol.asyncIterator]() {\n    return AsyncIterator\n  },\n}\n\nconst AsyncIterator = {\n  next() {\n    return Promise.resolve(IteratorResult)\n  },\n  return() {\n    return Promise.resolve(IteratorResult)\n  },\n  throw(e) {\n    return Promise.reject(e)\n  },\n}\n\nconst IteratorResult = {\n  value: any,\n  done: boolean,\n}\n\n// Tasks will chained:\nait\n  .next()\n  .then(({ value, done }) => ait.next())\n  .then(({ value, done }) => ait.next())\n  .then(({ done }) => done)\n\n// Tasks will run in parallel:\nait.next().then()\nait.next().then()\nait.next().then()\n"})}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"function remotePostsAsyncIteratorsFactory() {\n  let i = 1\n  let done = false\n\n  const asyncIterableIterator = {\n    // the next method will always return a Promise\n    async next() {\n      // do nothing if we went out-of-bounds\n      if (done) {\n        return Promise.resolve({\n          done: true,\n          value: undefined,\n        })\n      }\n\n      const res = await fetch(\n        `https://jsonplaceholder.typicode.com/posts/${i++}`\n      ).then(r => r.json())\n\n      // the posts source is ended\n      if (Object.keys(res).length === 0) {\n        done = true\n        return Promise.resolve({\n          done: true,\n          value: undefined,\n        })\n      } else {\n        return Promise.resolve({\n          done: false,\n          value: res,\n        })\n      }\n    },\n    [Symbol.asyncIterator]() {\n      return this\n    },\n  }\n\n  return asyncIterableIterator\n}\n\n;(async () => {\n  const ait = remotePostsAsyncIteratorsFactory()\n\n  await ait.next() // { done:false, value:{id: 1, ...} }\n  await ait.next() // { done:false, value:{id: 2, ...} }\n  await ait.next() // { done:false, value:{id: 3, ...} }\n  // ...\n  await ait.next() // { done:false, value:{id: 100, ...} }\n  await ait.next() // { done:true, value:undefined }\n})()\n"})}),"\n",(0,o.jsx)(e.h2,{id:"closable",children:"Closable"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:["An iterator is closable if it has a method ",(0,o.jsx)(e.code,{children:"return()"}),"."]}),"\n"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"interface ClosableIterator {\n  next: () => IteratorResult\n  return: (value?: any) => IteratorResult\n}\n"})}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:["Not all iterators are closable: e.g. ",(0,o.jsx)(e.code,{children:"Array Iterator"}),"."]}),"\n"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"const iterable = ['a', 'b', 'c']\nconst iterator = iterable[Symbol.iterator]()\nconsole.log('return' in iterator)\n// => false\n"})}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"If an iterator is not closable,\nyou can continue iterating over it after an abrupt exit."}),"\n",(0,o.jsx)(e.li,{children:"If an iterator is closable,\nyou can't continue iterating over it after an abrupt exit."}),"\n"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"function* elements() {\n  yield 'a'\n  yield 'b'\n  yield 'c'\n}\n\nfunction twoLoops(iterator) {\n  // eslint-disable-next-line no-unreachable-loop -- break loop\n  for (const x of iterator) {\n    console.log(x)\n    break\n  }\n\n  for (const x of iterator) {\n    console.log(x)\n  }\n}\n\nclass PreventReturn {\n  constructor(iterator) {\n    this.iterator = iterator\n  }\n\n  [Symbol.iterator]() {\n    return this\n  }\n\n  next() {\n    return this.iterator.next()\n  }\n\n  return(value = undefined) {\n    return { done: false, value }\n  }\n}\n\ntwoLoops(elements())\n// Output:\n// a\n\ntwoLoops(new PreventReturn(elements()))\n// Output:\n// a\n// b\n// c\n\ntwoLoops(['a', 'b', 'c'][Symbol.iterator]())\n// Output:\n// a\n// b\n// c\n"})}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:["Manually call ",(0,o.jsx)(e.code,{children:"iterator.return()"}),":"]}),"\n"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"function take(n, iterable) {\n  const iter = iterable[Symbol.iterator]()\n\n  return {\n    [Symbol.iterator]() {\n      return this\n    },\n    next() {\n      if (n > 0) {\n        n--\n        return iter.next()\n      } else {\n        iter?.return()\n        return { done: true }\n      }\n    },\n    return() {\n      n = 0\n      iter?.return()\n    },\n  }\n}\n"})})]})}function u(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(d,{...n})}):d(n)}},86145:(n,e,t)=>{t.d(e,{R:()=>i,x:()=>a});var r=t(57140);const o={},s=r.createContext(o);function i(n){const e=r.useContext(s);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:i(n.components),r.createElement(s.Provider,{value:e},n.children)}}}]);