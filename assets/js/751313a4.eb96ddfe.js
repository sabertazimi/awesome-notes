"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[45564],{1093:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"web/javascript/collection","title":"Collection","description":"Map","source":"@site/content/web/javascript/collection.md","sourceDirName":"web/javascript","slug":"/web/javascript/collection","permalink":"/notes/web/javascript/collection","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/javascript/collection.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"JavaScript","permalink":"/notes/tags/java-script"},{"inline":true,"label":"ECMAScript","permalink":"/notes/tags/ecma-script"},{"inline":true,"label":"Collection","permalink":"/notes/tags/collection"},{"inline":true,"label":"Map","permalink":"/notes/tags/map"},{"inline":true,"label":"Set","permalink":"/notes/tags/set"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":7,"frontMatter":{"sidebar_position":7,"tags":["Web","JavaScript","ECMAScript","Collection","Map","Set"]},"sidebar":"tutorialSidebar","previous":{"title":"Array","permalink":"/notes/web/javascript/array"},"next":{"title":"Temporal","permalink":"/notes/web/javascript/temporal"}}');var a=t(35656),r=t(86145);const i={sidebar_position:7,tags:["Web","JavaScript","ECMAScript","Collection","Map","Set"]},c="Collection",o={},l=[{value:"Map",id:"map",level:2},{value:"Set",id:"set",level:2},{value:"WeakMap and WeakSet",id:"weakmap-and-weakset",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"collection",children:"Collection"})}),"\n",(0,a.jsx)(n.h2,{id:"map",children:"Map"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"size"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"has()"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"get()"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"set()"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"delete()"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"clear()"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"keys()"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"values()"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"entries()"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"const map = new Map([\n  // You define a map via an array of 2-element arrays. The first\n  // element of each nested array is the key, and the 2nd is the value\n  ['name', 'Jean-Luc Picard'],\n  ['age', 59],\n  ['rank', 'Captain'],\n])\n\n// To get the value associated with a given `key` in a map, you\n// need to call `map.get(key)`. Using `map.key` will **not** work.\nmap.get('name') // 'Jean-Luc Picard'\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"const map = new Map([])\nconst n1 = new Number(5)\nconst n2 = new Number(5)\n\nmap.set(n1, 'One')\nmap.set(n2, 'Two')\n\n// `n1` and `n2` are objects, so `n1 !== n2`. That means the map has\n// separate keys for `n1` and `n2`.\nmap.get(n1) // 'One'\nmap.get(n2) // 'Two'\nmap.get(5) // undefined\n\n// If you were to do this with an object, `n2` would overwrite `n1`\nconst obj = {}\nobj[n1] = 'One'\nobj[n2] = 'Two'\n\nconst two1 = obj[n1] // 'Two'\nconst two2 = obj[5] // 'Two'\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"const objectClone = new Map(Object.entries(object))\nconst arrayClone = new Map(Array.from(map.entries))\nconst map = new Map([\n  ['name', 'Jean-Luc Picard'],\n  ['age', 59],\n  ['rank', 'Captain'],\n])\n\n// The `for/of` loop can loop through iterators\nfor (const key of map.keys())\n  console.log(key) // 'name', 'age', 'rank'\n\nfor (const value of map.values())\n  console.log(value) // 'Jean-Luc Picard', 59, 'Captain'\n\nfor (const [key, value] of map.entries()) {\n  console.log(key) // 'name', 'age', 'rank'\n  console.log(value) // 'Jean-Luc Picard', 59, 'Captain'\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"set",children:"Set"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"size"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"has()"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"add()"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"delete()"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"clear()"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"keys()"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"values()"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"entries()"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"class XSet extends Set {\n  union(...sets) {\n    return XSet.union(this, ...sets)\n  }\n\n  intersection(...sets) {\n    return XSet.intersection(this, ...sets)\n  }\n\n  difference(set) {\n    return XSet.difference(this, set)\n  }\n\n  symmetricDifference(set) {\n    return XSet.symmetricDifference(this, set)\n  }\n\n  cartesianProduct(set) {\n    return XSet.cartesianProduct(this, set)\n  }\n\n  powerSet() {\n    return XSet.powerSet(this)\n  }\n\n  // \u8fd4\u56de\u4e24\u4e2a\u6216\u66f4\u591a\u96c6\u5408\u7684\u5e76\u96c6\n  // new Set([...setA, ...setB]);\n  static union(a, ...bSets) {\n    const unionSet = new XSet(a)\n\n    for (const b of bSets) {\n      for (const bValue of b)\n        unionSet.add(bValue)\n    }\n\n    return unionSet\n  }\n\n  // \u8fd4\u56de\u4e24\u4e2a\u6216\u66f4\u591a\u96c6\u5408\u7684\u4ea4\u96c6\n  // new Set([...setA].filter(x => setB.has(x)))\n  static intersection(a, ...bSets) {\n    const intersectionSet = new XSet(a)\n\n    for (const aValue of intersectionSet) {\n      for (const b of bSets) {\n        if (!b.has(aValue))\n          intersectionSet.delete(aValue)\n      }\n    }\n\n    return intersectionSet\n  }\n\n  // \u8fd4\u56de\u4e24\u4e2a\u96c6\u5408\u7684\u5dee\u96c6\n  // new Set([...setA].filter(x => !setB.has(x)))\n  static difference(a, b) {\n    const differenceSet = new XSet(a)\n\n    for (const bValue of b) {\n      if (a.has(bValue))\n        differenceSet.delete(bValue)\n    }\n\n    return differenceSet\n  }\n\n  // \u8fd4\u56de\u4e24\u4e2a\u96c6\u5408\u7684\u5bf9\u79f0\u5dee\u96c6\n  static symmetricDifference(a, b) {\n    // \u6309\u7167\u5b9a\u4e49, \u5bf9\u79f0\u5dee\u96c6\u53ef\u4ee5\u8868\u8fbe\u4e3a:\n    return a.union(b).difference(a.intersection(b))\n  }\n\n  // \u8fd4\u56de\u4e24\u4e2a\u96c6\u5408 (\u6570\u7ec4\u5bf9\u5f62\u5f0f) \u7684\u7b1b\u5361\u513f\u79ef\n  // \u5fc5\u987b\u8fd4\u56de\u6570\u7ec4\u96c6\u5408, \u56e0\u4e3a\u7b1b\u5361\u513f\u79ef\u53ef\u80fd\u5305\u542b\u76f8\u540c\u503c\u7684\u5bf9\n  static cartesianProduct(a, b) {\n    const cartesianProductSet = new XSet()\n\n    for (const aValue of a) {\n      for (const bValue of b)\n        cartesianProductSet.add([aValue, bValue])\n    }\n\n    return cartesianProductSet\n  }\n\n  // \u8fd4\u56de\u4e00\u4e2a\u96c6\u5408\u7684\u5e42\u96c6\n  static powerSet(a) {\n    const powerSet = new XSet().add(new XSet())\n\n    for (const aValue of a) {\n      for (const set of new XSet(powerSet))\n        powerSet.add(new XSet(set).add(aValue))\n    }\n\n    return powerSet\n  }\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"weakmap-and-weakset",children:"WeakMap and WeakSet"}),"\n",(0,a.jsxs)(n.p,{children:["WeakMap \u7ed3\u6784\u4e0e Map \u7ed3\u6784\u57fa\u672c\u7c7b\u4f3c,\n\u552f\u4e00\u7684\u533a\u522b\u5c31\u662f WeakMap \u53ea\u63a5\u53d7",(0,a.jsx)(n.strong,{children:"\u975e null \u5bf9\u8c61"}),"\u4f5c\u4e3a\u952e\u540d:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\u5f31\u952e: \u952e\u540d\u6784\u5efa\u7684\u5f15\u7528",(0,a.jsx)(n.strong,{children:"\u65e0\u6cd5\u963b\u6b62\u5bf9\u8c61\u6267\u884c\u5783\u573e\u56de\u6536"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:["\u4e0d\u53ef\u8fed\u4ee3\u952e: \u952e/\u503c\u968f\u65f6\u53ef\u80fd\u88ab\u5783\u573e\u56de\u6536, \u65e0\u9700\u63d0\u4f9b\u8fed\u4ee3\u80fd\u529b, \u65e0 ",(0,a.jsx)(n.code,{children:"clear()"})," \u65b9\u6cd5."]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"\u5b83\u7684\u952e\u6240\u5bf9\u5e94\u7684\u5bf9\u8c61\u53ef\u80fd\u4f1a\u5728\u5c06\u6765\u6d88\u5931.\n\u4e00\u4e2a\u5bf9\u5e94 DOM \u5143\u7d20\u7684 WeakMap \u7ed3\u6784,\n\u5f53\u67d0\u4e2a DOM \u5143\u7d20\u88ab\u6e05\u9664,\n\u5176\u6240\u5bf9\u5e94\u7684 WeakMap \u8bb0\u5f55\u5c31\u4f1a\u81ea\u52a8\u88ab\u79fb\u9664."}),"\n",(0,a.jsxs)(n.p,{children:["\u6709\u65f6\u5019\u6211\u4eec\u4f1a\u628a\u5bf9\u8c61\u4f5c\u4e3a\u4e00\u4e2a\u5bf9\u8c61\u7684\u952e\u7528\u6765\u5b58\u653e\u5c5e\u6027\u503c,\n\u666e\u901a\u96c6\u5408\u7c7b\u578b\u6bd4\u5982\u7b80\u5355\u5bf9\u8c61 (Object/Map/Set) \u4f1a\u963b\u6b62\u5783\u573e\u56de\u6536\u5668\u5bf9\u8fd9\u4e9b\u4f5c\u4e3a\u5c5e\u6027\u952e\u5b58\u5728\u7684\u5bf9\u8c61\u7684\u56de\u6536,\n\u6709\u9020\u6210\u5185\u5b58\u6cc4\u6f0f\u7684\u5371\u9669,\nWeakMap/WeakSet \u5219\u66f4\u52a0",(0,a.jsx)(n.strong,{children:"\u5185\u5b58\u5b89\u5168"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Caching computed results."}),"\n",(0,a.jsx)(n.li,{children:"Managing listeners."}),"\n",(0,a.jsx)(n.li,{children:"Keeping private data."}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"\u5f31\u5f15\u7528\u53ef\u4ee5\u7f13\u5b58\u8ba1\u7b97\u7ed3\u679c (\u65e0\u9700\u4fee\u6539\u7f51\u7edc\u5c42):"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"const CACHE = new WeakMap()\n\nasync function describe(transaction) {\n  const cached = CACHE.get(transaction)\n\n  if (cached) {\n    return cached\n  }\n\n  // Not cached, do all the work...\n\n  CACHE.set(transaction, description)\n  return description\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u5f31\u5f15\u7528\u53ef\u4ee5",(0,a.jsx)(n.a,{href:"https://jlongster.com/subverting-control-weak-refs",children:"\u5b9e\u73b0\u63a7\u5236\u53cd\u8f6c"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"const CONVERTERS = new WeakMap()\n\nfunction getConverter(transaction) {\n  const converter\n    = CONVERTERS.get(transaction) || new CurrencyConversion(transaction, { options })\n  CONVERTERS.set(transaction, converter)\n  return converter\n}\n\nfunction describe(transaction) {\n  if (!getConverter(transaction).isReady()) {\n    // do something..\n  }\n\n  // Here converter only exists for the lifetime to the describe function call.\n  // When we store it in a weak map, it exists for the entire lifetime of the transaction class.\n  // That allows us to write code the assumes the same lifetime\n  // e.g. caching things, using instance equality.\n  const amount = getConverter(transaction).convert()\n}\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},86145:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>c});var s=t(57140);const a={},r=s.createContext(a);function i(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);