"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[2655],{30694:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>r,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"ai/gen/recipes/code/review","title":"Code Review","description":"Code review agent:","source":"@site/content/ai/gen/recipes/code/review.md","sourceDirName":"ai/gen/recipes/code","slug":"/ai/gen/recipes/code/review","permalink":"/notes/ai/gen/recipes/code/review","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/ai/gen/recipes/code/review.md","tags":[],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"NanoCode","permalink":"/notes/ai/gen/recipes/code/nanocode"},"next":{"title":"AGENTS.md","permalink":"/notes/ai/gen/recipes/prompts/agents"}}');var i=s(35656),o=s(86145);const r={},a="Code Review",c={},l=[];function u(e){const n={a:"a",code:"code",h1:"h1",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"code-review",children:"Code Review"})}),"\n",(0,i.jsxs)(n.p,{children:["Code review ",(0,i.jsx)(n.a,{href:"https://nader.substack.com/p/the-complete-guide-to-building-agents",children:"agent"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import { query, AgentDefinition } from "@anthropic-ai/claude-agent-sdk";\n\ninterface ReviewResult {\n  issues: Array<{\n    severity: "low" | "medium" | "high" | "critical";\n    category: "bug" | "security" | "performance" | "style";\n    file: string;\n    line?: number;\n    description: string;\n    suggestion?: string;\n  }>;\n  summary: string;\n  overallScore: number;\n}\n\nconst reviewSchema = {\n  type: "object",\n  properties: {\n    issues: {\n      type: "array",\n      items: {\n        type: "object",\n        properties: {\n          severity: { type: "string", enum: ["low", "medium", "high", "critical"] },\n          category: { type: "string", enum: ["bug", "security", "performance", "style"] },\n          file: { type: "string" },\n          line: { type: "number" },\n          description: { type: "string" },\n          suggestion: { type: "string" }\n        },\n        required: ["severity", "category", "file", "description"]\n      }\n    },\n    summary: { type: "string" },\n    overallScore: { type: "number" }\n  },\n  required: ["issues", "summary", "overallScore"]\n};\n\nasync function runCodeReview(directory: string): Promise<ReviewResult | null> {\n  console.log(`\\n${"=".repeat(50)}`);\n  console.log(`\ud83d\udd0d Code Review Agent`);\n  console.log(`\ud83d\udcc1 Directory: ${directory}`);\n  console.log(`${"=".repeat(50)}\\n`);\n\n  let result: ReviewResult | null = null;\n\n  for await (const message of query({\n    prompt: `Perform a thorough code review of ${directory}.\n\nAnalyze all source files for:\n1. Bugs and potential runtime errors\n2. Security vulnerabilities\n3. Performance issues\n4. Code quality and maintainability\n\nBe specific with file paths and line numbers where possible.`,\n    options: {\n      model: "opus",\n      allowedTools: ["Read", "Glob", "Grep", "Task"],\n      permissionMode: "bypassPermissions",\n      maxTurns: 250,\n      outputFormat: {\n        type: "json_schema",\n        schema: reviewSchema\n      },\n      agents: {\n        "security-scanner": {\n          description: "Deep security analysis for vulnerabilities",\n          prompt: `You are a security expert. Scan for:\n- Injection vulnerabilities (SQL, XSS, command injection)\n- Authentication and authorization flaws\n- Sensitive data exposure\n- Insecure dependencies`,\n          tools: ["Read", "Grep", "Glob"],\n          model: "sonnet"\n        } as AgentDefinition\n      }\n    }\n  })) {\n    // Progress updates\n    if (message.type === "assistant") {\n      for (const block of message.message.content) {\n        if ("name" in block) {\n          if (block.name === "Task") {\n            console.log(`\ud83e\udd16 Delegating to: ${(block.input as any).subagent_type}`);\n          } else {\n            console.log(`\ud83d\udcc2 ${block.name}: ${getToolSummary(block)}`);\n          }\n        }\n      }\n    }\n\n    // Final result\n    if (message.type === "result") {\n      if (message.subtype === "success" && message.structured_output) {\n        result = message.structured_output as ReviewResult;\n        console.log(`\\n\u2705 Review complete! Cost: $${message.total_cost_usd.toFixed(4)}`);\n      } else {\n        console.log(`\\n\u274c Review failed: ${message.subtype}`);\n      }\n    }\n  }\n\n  return result;\n}\n\nfunction getToolSummary(block: any): string {\n  const input = block.input || {};\n  switch (block.name) {\n    case "Read": return input.file_path || "file";\n    case "Glob": return input.pattern || "pattern";\n    case "Grep": return `"${input.pattern}" in ${input.path || "."}`;\n    default: return "";\n  }\n}\n\nfunction printResults(result: ReviewResult) {\n  console.log(`\\n${"=".repeat(50)}`);\n  console.log(`\ud83d\udcca REVIEW RESULTS`);\n  console.log(`${"=".repeat(50)}\\n`);\n\n  console.log(`Score: ${result.overallScore}/100`);\n  console.log(`Issues Found: ${result.issues.length}\\n`);\n  console.log(`Summary: ${result.summary}\\n`);\n\n  const byCategory = {\n    critical: result.issues.filter(i => i.severity === "critical"),\n    high: result.issues.filter(i => i.severity === "high"),\n    medium: result.issues.filter(i => i.severity === "medium"),\n    low: result.issues.filter(i => i.severity === "low")\n  };\n\n  for (const [severity, issues] of Object.entries(byCategory)) {\n    if (issues.length === 0) continue;\n\n    const icon = severity === "critical" ? "\ud83d\udd34" :\n                 severity === "high" ? "\ud83d\udfe0" :\n                 severity === "medium" ? "\ud83d\udfe1" : "\ud83d\udfe2";\n\n    console.log(`\\n${icon} ${severity.toUpperCase()} (${issues.length})`);\n    console.log("-".repeat(30));\n\n    for (const issue of issues) {\n      const location = issue.line ? `${issue.file}:${issue.line}` : issue.file;\n      console.log(`\\n[${issue.category}] ${location}`);\n      console.log(`  ${issue.description}`);\n      if (issue.suggestion) {\n        console.log(`  \ud83d\udca1 ${issue.suggestion}`);\n      }\n    }\n  }\n}\n\n# Run the review\nasync function main() {\n  const directory = process.argv[2] || ".";\n  const result = await runCodeReview(directory);\n\n  if (result) {\n    printResults(result);\n  }\n}\n\nmain().catch(console.error);\n'})})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},86145:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>a});var t=s(57140);const i={},o=t.createContext(i);function r(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);