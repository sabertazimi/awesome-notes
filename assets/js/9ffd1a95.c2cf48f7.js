"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[13988],{1444:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>c,metadata:()=>i,toc:()=>t});const i=JSON.parse('{"id":"web/node/npm","title":"NPM","description":"Mirrors","source":"@site/content/web/node/npm.md","sourceDirName":"web/node","slug":"/web/node/npm","permalink":"/notes/web/node/npm","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/node/npm.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"Node.js","permalink":"/notes/tags/node-js"},{"inline":true,"label":"Package Manager","permalink":"/notes/tags/package-manager"},{"inline":true,"label":"NPM","permalink":"/notes/tags/npm"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":2,"frontMatter":{"sidebar_position":2,"tags":["Web","Node.js","Package Manager","NPM"]},"sidebar":"tutorialSidebar","previous":{"title":"Modern Node.js","permalink":"/notes/web/node/modern"},"next":{"title":"Yarn","permalink":"/notes/web/node/yarn"}}');var r=s(35656),o=s(86145);const c={sidebar_position:2,tags:["Web","Node.js","Package Manager","NPM"]},a="NPM",l={},t=[{value:"Mirrors",id:"mirrors",level:2},{value:"Node Version Manager",id:"node-version-manager",level:2},{value:"NVM",id:"nvm",level:3},{value:"FNM",id:"fnm",level:3},{value:"Tab Completion",id:"tab-completion",level:2},{value:"Commands",id:"commands",level:2},{value:"Testing",id:"testing",level:2},{value:"Publish",id:"publish",level:2},{value:"Link",id:"link",level:2},{value:"Security",id:"security",level:2},{value:"NPX",id:"npx",level:2},{value:"Dependencies",id:"dependencies",level:2},{value:"Doppelgangers",id:"doppelgangers",level:3},{value:"Ghost",id:"ghost",level:3},{value:"Invalid",id:"invalid",level:3},{value:"<code>package.json</code>",id:"packagejson",level:2},{value:"Bin",id:"bin",level:3},{value:"Version",id:"version",level:3},{value:"Workspaces",id:"workspaces",level:3},{value:"Exports",id:"exports",level:3},{value:"Resolutions",id:"resolutions",level:3},{value:"Lockfile",id:"lockfile",level:2},{value:"Environment",id:"environment",level:2}];function d(n){const e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"npm",children:"NPM"})}),"\n",(0,r.jsx)(e.h2,{id:"mirrors",children:"Mirrors"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.a,{href:"https://github.com/cnpm/binary-mirror-config",children:"NPM mirror list"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"npm config set disturl https://npmmirror.com/mirrors/node/\nnpm config set chromedriver_cdnurl https://npmmirror.com/mirrors/chromedriver/\nnpm config set electron_mirror https://npmmirror.com/mirrors/electron/\nnpm config set electron_builder_binaries_mirror https://npmmirror.com/mirrors/electron-builder-binaries/\nnpm config set operadriver_cdnurl https://npmmirror.com/mirrors/operadriver/\nnpm config set phantomjs_cdnurl https://npmmirror.com/mirrors/phantomjs/\nnpm config set profiler_binary_host_mirror https://npmmirror.com/mirrors/node-inspector/\nnpm config set puppeteer_download_host https://npmmirror.com/mirrors/\nnpm config set python_mirror https://npmmirror.com/mirrors/python/\nnpm config set robotjs_binary_host https://npmmirror.com/mirrors/robotjs/\nnpm config set sass_binary_site https://npmmirror.com/mirrors/node-sass/\nnpm config set saucectl_install_binary_mirror https://npmmirror.com/mirrors/saucectl/\nnpm config set sentrycli_cdnurl https://npmmirror.com/mirrors/sentry-cli/\nnpm config set sharp_binary_host https://npmmirror.com/mirrors/sharp/\nnpm config set sharp_libvips_binary_host https://npmmirror.com/mirrors/sharp-libvips/\nnpm config set sqlite3_binary_site https://npmmirror.com/mirrors/sqlite3/\nnpm config set swc_binary_site https://npmmirror.com/mirrors/node-swc/\n"})}),"\n",(0,r.jsx)(e.h2,{id:"node-version-manager",children:"Node Version Manager"}),"\n",(0,r.jsx)(e.h3,{id:"nvm",children:"NVM"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.a,{href:"https://github.com/coreybutler/nvm-windows",children:"NVM"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"scoop install nvm\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"nvm i lts\nnvm use lts\nnode -v\n"})}),"\n",(0,r.jsx)(e.h3,{id:"fnm",children:"FNM"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.a,{href:"https://github.com/Schniz/fnm",children:"FNM"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"brew install fnm\nscoop install fnm\nwinget install Schniz.fnm\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"echo 'eval \"$(fnm env --use-on-cd --shell bash)\"' >> ~/.bashrc\nfnm i --lts\nnode -v\n"})}),"\n",(0,r.jsx)(e.h2,{id:"tab-completion",children:"Tab Completion"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"npm completion >> ~/.bashrc (or ~/.zshrc)\nsource ~/.zshrc\n"})}),"\n",(0,r.jsx)(e.h2,{id:"commands",children:"Commands"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"npm adduser\nmkdir proj/\n# \u4fee\u6539 package.json \u53ef\u518d\u6b21\u8fd0\u884c\u6b64\u547d\u4ee4\n# scope for everyone\nnpm init --scope=<username>\n\n# \u4fee\u6539 package.json \u53ef\u518d\u6b21\u8fd0\u884c\u6b64\u547d\u4ee4(\u4e0d\u63a5\u6a21\u5757\u540d\u4e3a\u81ea\u52a8\u66f4\u65b0)\nnpm install -S <package>\nnpm install -D <package>\nnpm prune      # \u6e05\u9664\u65e0\u7528\u5305\nnpm rm --save  # --save \u5220\u9664\u6587\u4ef6\u7684\u540c\u65f6\u66f4\u65b0 package.json \u6587\u4ef6\n\nnpm ls\nnpm outdated   # \u53bb\u9664\u8fc7\u671f\u5305\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"npm ci"})," for cache install (speed up installation):"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# With package-lock.json exists:\nnpm ci\n"})}),"\n",(0,r.jsx)(e.p,{children:"Remove useless package:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# Uninstall node_modules not in package.json\nnpm prune\nnpm outdated\n"})}),"\n",(0,r.jsx)(e.h2,{id:"testing",children:"Testing"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'{\n  "scripts": {\n    "test": "node test.js"\n  }\n}\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"npm test\n"})}),"\n",(0,r.jsx)(e.h2,{id:"publish",children:"Publish"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"latest"})," or ",(0,r.jsx)(e.code,{children:"alpha"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"npm publish\nnpm publish --tag [<tag>]\nnpm dist-tag add <pkg>@<version> [<tag>]\nnpm dist-tag rm <pkg> <tag>\nnpm dist-tag ls [<pkg>]\n"})}),"\n",(0,r.jsx)(e.p,{children:"NPM registry token configuration:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"npm config set @orgName:registry https://registry.example.com\nnpm config set //registry.example.com/:_authToken XXXXXTokenXXXXX\n"})}),"\n",(0,r.jsx)(e.p,{children:"Release script from VitePress:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ts",children:"const fs = require('node:fs')\nconst path = require('node:path')\nconst chalk = require('chalk')\nconst { prompt } = require('enquirer')\nconst execa = require('execa')\nconst semver = require('semver')\nconst currentVersion = require('../package.json').version\n\nconst versionIncrements = ['patch', 'minor', 'major']\n\nconst inc = i => semver.inc(currentVersion, i)\nconst bin = name => path.resolve(__dirname, `../node_modules/.bin/${name}`)\nfunction run(bin, args, opts = {}) {\n  return execa(bin, args, { stdio: 'inherit', ...opts })\n}\nconst step = msg => console.log(chalk.cyan(msg))\n\nasync function main() {\n  let targetVersion\n\n  const { release } = await prompt({\n    type: 'select',\n    name: 'release',\n    message: 'Select release type',\n    choices: versionIncrements.map(i => `${i} (${inc(i)})`).concat(['custom']),\n  })\n\n  if (release === 'custom') {\n    targetVersion = (\n      await prompt({\n        type: 'input',\n        name: 'version',\n        message: 'Input custom version',\n        initial: currentVersion,\n      })\n    ).version\n  } else {\n    targetVersion = release.match(/\\((.*)\\)/)[1]\n  }\n\n  if (!semver.valid(targetVersion))\n    throw new Error(`Invalid target version: ${targetVersion}`)\n\n  const { yes: tagOk } = await prompt({\n    type: 'confirm',\n    name: 'yes',\n    message: `Releasing v${targetVersion}. Confirm?`,\n  })\n\n  if (!tagOk)\n    return\n\n  // Update the package version.\n  step('\\nUpdating the package version...')\n  updatePackage(targetVersion)\n\n  // Build the package.\n  step('\\nBuilding the package...')\n  await run('yarn', ['build'])\n\n  // Generate the changelog.\n  step('\\nGenerating the changelog...')\n  await run('yarn', ['changelog'])\n  await run('yarn', ['prettier', '--write', 'CHANGELOG.md'])\n\n  const { yes: changelogOk } = await prompt({\n    type: 'confirm',\n    name: 'yes',\n    message: `Changelog generated. Does it look good?`,\n  })\n\n  if (!changelogOk)\n    return\n\n  // Commit changes to the Git and create a tag.\n  step('\\nCommitting changes...')\n  await run('git', ['add', 'CHANGELOG.md', 'package.json'])\n  await run('git', ['commit', '-m', `release: v${targetVersion}`])\n  await run('git', ['tag', `v${targetVersion}`])\n\n  // Publish the package.\n  step('\\nPublishing the package...')\n  await run('yarn', [\n    'publish',\n    '--new-version',\n    targetVersion,\n    '--no-commit-hooks',\n    '--no-git-tag-version',\n  ])\n  await run('npm', [\n    'publish',\n    '--registry',\n    'https://registry.npmjs.org',\n    '--access',\n    'public',\n  ])\n\n  // Push to GitHub.\n  step('\\nPushing to GitHub...')\n  await run('git', ['push', 'origin', `refs/tags/v${targetVersion}`])\n  await run('git', ['push'])\n}\n\nfunction updatePackage(version) {\n  const pkgPath = path.resolve(path.resolve(__dirname, '..'), 'package.json')\n  const pkg = JSON.parse(fs.readFileSync(pkgPath, 'utf-8'))\n\n  pkg.version = version\n\n  fs.writeFileSync(pkgPath, `${JSON.stringify(pkg, null, 2)}\\n`)\n}\n\nmain().catch(err => console.error(err))\n"})}),"\n",(0,r.jsxs)(e.admonition,{title:"Semantic Version",type:"tip",children:[(0,r.jsx)(e.p,{children:"Semver:"}),(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Patch release: bugfix and other minor changes."}),"\n",(0,r.jsx)(e.li,{children:"Minor release: new features not breaking API (backward compatible)."}),"\n",(0,r.jsx)(e.li,{children:"Major release: new features breaking API (not backward compatible)."}),"\n",(0,r.jsx)(e.li,{children:"Alpha (\u03b1): \u9884\u89c8\u7248 (\u5185\u90e8\u6d4b\u8bd5\u7248), \u4f1a\u6709\u5f88\u591a Bug, \u4e00\u822c\u53ea\u6709\u6d4b\u8bd5\u4eba\u5458\u4f7f\u7528."}),"\n",(0,r.jsx)(e.li,{children:"Beta (\u03b2): \u6d4b\u8bd5\u7248 (\u6216\u8005\u53eb\u516c\u5f00\u6d4b\u8bd5\u7248), \u4f1a\u4e00\u76f4\u52a0\u5165\u65b0\u7684\u529f\u80fd."}),"\n",(0,r.jsx)(e.li,{children:"RC (Release Candidate): \u6700\u7ec8\u6d4b\u8bd5\u7248\u672c, \u53ef\u80fd\u6210\u4e3a\u6700\u7ec8\u4ea7\u54c1\u7684\u5019\u9009\u7248\u672c."}),"\n",(0,r.jsx)(e.li,{children:"\u591a\u6570\u5f00\u6e90\u8f6f\u4ef6\u4f1a\u63a8\u51fa\u4e24\u4e2a RC \u7248\u672c, \u6700\u540e\u7684 RC2 \u5219\u6210\u4e3a\u6b63\u5f0f\u7248\u672c."}),"\n"]}),(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"npm version patch\nnpm publish\n\nnpm version minor\nnpm publish\n\nnpm version major\nnpm publish\n"})})]}),"\n",(0,r.jsx)(e.h2,{id:"link",children:"Link"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"cd path/to/my-project\nnpm link path/to/my-utils\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# in local B package, build local B binary (npm install -g B)\nnpm link\n# in local A package, set `B` link in package.json to local B binary\nnpm link B\n"})}),"\n",(0,r.jsx)(e.h2,{id:"security",children:"Security"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"npm audit fix\nnpm audit fix --force\n"})}),"\n",(0,r.jsx)(e.h2,{id:"npx",children:"NPX"}),"\n",(0,r.jsx)(e.p,{children:"Run local node_modules:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"npm install eslint -D\nnpx eslint .\n"})}),"\n",(0,r.jsx)(e.p,{children:"Run global package (not installed):"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"npx create-react-app react-app\n"})}),"\n",(0,r.jsx)(e.p,{children:"Run specific version:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'npx -p package1@next -p package2@next -c "command"\n'})}),"\n",(0,r.jsx)(e.p,{children:"Run scripts with different node version:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"npx -p node@version -- node index.js\n"})}),"\n",(0,r.jsx)(e.p,{children:"Run remote repo/gist code:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"npx user/repo#branch\nnpx gistUrl\n"})}),"\n",(0,r.jsx)(e.admonition,{title:"NPX Cache",type:"tip",children:(0,r.jsxs)(e.p,{children:["NPX cache packages in ",(0,r.jsx)(e.code,{children:"~/.npm/_npx"}),"."]})}),"\n",(0,r.jsx)(e.p,{children:"To get latest version package:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# https://github.com/return-0x0/node-clear-npx-cache.\n# https://github.com/npm/cli/issues/2329.\n# https://github.com/npm/cli/issues/2395.\n# https://github.com/npm/cli/pull/2592.\n# https://github.com/facebook/create-react-app/issues/10601.\n# https://github.com/facebook/create-react-app/issues/12022.\nnpx clear-npx-cache\nnpx create-react-app app\n"})}),"\n",(0,r.jsx)(e.h2,{id:"dependencies",children:"Dependencies"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Dependency Nesting/Hell (NPM v1)."}),"\n",(0,r.jsx)(e.li,{children:"Dependency Flatten/Hoist (NPM v3)."}),"\n",(0,r.jsx)(e.li,{children:"Dependency Consistent Lockfile (NPM v5 and Yarn)."}),"\n",(0,r.jsxs)(e.li,{children:["Dependency Hard/Symbol Links (PNPM):","\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Hard links for global ",(0,r.jsx)(e.code,{children:".pnpm"})," store to save disk storage."]}),"\n",(0,r.jsxs)(e.li,{children:["Symbol links for local require short path with non-flat ",(0,r.jsx)(e.code,{children:"node_modules"}),"\nto rectify ",(0,r.jsx)(e.strong,{children:"doppelgangers"})," and ",(0,r.jsx)(e.strong,{children:"ghost/phantom dependencies"})," problem."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"peerDependencies"}),":\n\u63d0\u793a\u5bbf\u4e3b\u73af\u5883\u53bb\u5b89\u88c5\u6ee1\u8db3\u63d2\u4ef6 ",(0,r.jsx)(e.code,{children:"peerDependencies"})," \u6240\u6307\u5b9a\u4f9d\u8d56\u7684\u5305,\n\u7136\u540e\u5728\u63d2\u4ef6 ",(0,r.jsx)(e.code,{children:"import"})," \u6216\u8005 ",(0,r.jsx)(e.code,{children:"require"})," \u6240\u4f9d\u8d56\u7684\u5305\u7684\u65f6\u5019,\n\u6c38\u8fdc\u90fd\u662f\u5f15\u7528\u5bbf\u4e3b\u73af\u5883\u7edf\u4e00\u5b89\u88c5\u7684 NPM \u5305,\n\u6700\u7ec8\u89e3\u51b3\u63d2\u4ef6\u4e0e\u6240\u4f9d\u8d56\u5305\u4e0d\u4e00\u81f4\u7684\u95ee\u9898."]}),"\n",(0,r.jsxs)(e.li,{children:["\u6784\u5efa\u4f9d\u8d56\u6811\u7684\u8fc7\u7a0b\u4e2d, \u7248\u672c\u786e\u8ba4\u9700\u8981\u7ed3\u5408 ",(0,r.jsx)(e.code,{children:"package.json"})," \u548c ",(0,r.jsx)(e.code,{children:"package-lock.json"}),":","\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\u5148\u786e\u8ba4 ",(0,r.jsx)(e.code,{children:"package-lock.json"})," \u5b89\u88c5\u7248\u672c,\n\u7b26\u5408\u89c4\u5219\u5c31\u4ee5\u6b64\u4e3a\u51c6,\n\u5426\u5219\u7531 ",(0,r.jsx)(e.code,{children:"package.json"})," \u58f0\u660e\u7684\u7248\u672c\u8303\u56f4\u91cd\u65b0\u786e\u8ba4."]}),"\n",(0,r.jsxs)(e.li,{children:["\u82e5\u662f\u5728\u5f00\u53d1\u4e2d\u624b\u52a8\u66f4\u6539\u5305\u4fe1\u606f,\n\u4f1a\u5bfc\u81f4 ",(0,r.jsx)(e.strong,{children:"lockfile"})," \u7248\u672c\u4fe1\u606f\u5f02\u5e38,\n\u4e5f\u7531 ",(0,r.jsx)(e.code,{children:"package.json"})," \u91cd\u65b0\u786e\u8ba4."]}),"\n",(0,r.jsxs)(e.li,{children:["\u786e\u8ba4\u597d\u7684\u4f9d\u8d56\u6811\u4f1a\u5b58\u5230 ",(0,r.jsx)(e.code,{children:"package-lock.json"})," \u6587\u4ef6\u4e2d."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\u540c\u4e00\u4e2a\u4f9d\u8d56, \u66f4\u9ad8\u7248\u672c\u7684\u5305\u4f1a\u5b89\u88c5\u5230\u9876\u5c42 ",(0,r.jsx)(e.code,{children:"node_modules"})," \u76ee\u5f55,\n\u4f4e\u7248\u672c\u7684\u5305\u4f1a\u5206\u6563\u5728\u67d0\u4e9b\u4f9d\u8d56\u7684 ",(0,r.jsx)(e.code,{children:"node_modules"})," \u76ee\u5f55."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Lockfile"})," \u4fdd\u8bc1\u9879\u76ee\u4f9d\u8d56\u7ed3\u6784\u7684\u786e\u5b9a\u6027, \u4fdd\u969c\u9879\u76ee\u5728\u591a\u73af\u5883\u8fd0\u884c\u7684\u7a33\u5b9a\u6027."]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"doppelgangers",children:"Doppelgangers"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Singleton conflict: multiple version of same package in ",(0,r.jsx)(e.code,{children:"node_modules"}),"."]}),"\n",(0,r.jsxs)(e.li,{children:["Types conflict: global ",(0,r.jsx)(e.code,{children:"types"})," naming conflict."]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"ghost",children:"Ghost"}),"\n",(0,r.jsx)(e.p,{children:"NPM ghost (phantom) dependency:"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Imported packages from ",(0,r.jsx)(e.code,{children:"dependencies of dependencies"}),":\nWhen update ",(0,r.jsx)(e.code,{children:"dependencies"})," to minor version,\n",(0,r.jsx)(e.code,{children:"dependencies of dependencies"})," may get major BREAKING version\n(It's legal for ",(0,r.jsx)(e.code,{children:"semver"}),", when ",(0,r.jsx)(e.code,{children:"dependencies"})," API don't change)."]}),"\n",(0,r.jsxs)(e.li,{children:["Imported packages from ",(0,r.jsx)(e.code,{children:"devDependencies"}),":\nWhen others install your library,\nsuch imported packages will missing,\ncause they aren't located in library ",(0,r.jsx)(e.code,{children:"package.json"}),"."]}),"\n",(0,r.jsxs)(e.li,{children:["Imported packages from root ",(0,r.jsx)(e.code,{children:"node_modules"})," in monorepo.\nWhen others install your library,\nsuch imported packages will missing,\ncause they aren't located in library ",(0,r.jsx)(e.code,{children:"package.json"}),"."]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"invalid",children:"Invalid"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"$ npm ls\npackage@version invalid\n"})}),"\n",(0,r.jsxs)(e.p,{children:["Modify ",(0,r.jsx)(e.code,{children:"package-lock.json"}),"\nto remove locked invalid package version."]}),"\n",(0,r.jsx)(e.h2,{id:"packagejson",children:(0,r.jsx)(e.code,{children:"package.json"})}),"\n",(0,r.jsx)(e.h3,{id:"bin",children:"Bin"}),"\n",(0,r.jsxs)(e.p,{children:["\u5f53\u8bbe\u7f6e\u4e86 ",(0,r.jsx)(e.code,{children:"bin"})," \u5b57\u6bb5\u540e,\n\u5728 ",(0,r.jsx)(e.code,{children:"package.json"})," ",(0,r.jsx)(e.code,{children:"script"})," \u5b57\u6bb5\u4e2d,\n\u53ef\u4ee5\u4f7f\u7528\u7b80\u5199\u7f16\u5199\u547d\u4ee4\n(\u4f46\u662f\u5c40\u90e8\u5b89\u88c5\u65e0\u6cd5\u5728 shell \u4e0b\u4f7f\u7528, \u9700 ",(0,r.jsx)(e.code,{children:"npx <bin-name>"}),")."]}),"\n",(0,r.jsx)(e.h3,{id:"version",children:"Version"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"npm version major\nnpm version minor\nnpm version patch\n"})}),"\n",(0,r.jsx)(e.h3,{id:"workspaces",children:"Workspaces"}),"\n",(0,r.jsxs)(e.p,{children:["In root ",(0,r.jsx)(e.code,{children:"package.json"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'{\n  "workspaces": [\n    "./packages/*",\n    "./css/*",\n    "./angular/*",\n    "./react/*",\n    "./vue/*"\n  ]\n}\n'})}),"\n",(0,r.jsxs)(e.p,{children:["In root ",(0,r.jsx)(e.code,{children:"cwd"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"npm i\nnpm run lint -ws\nnpm run test -w package-a\nnpm i lodash -w package-b\nnpm i -D eslint -w package-c\n"})}),"\n",(0,r.jsx)(e.h3,{id:"exports",children:"Exports"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"exports"})," can define ",(0,r.jsx)(e.a,{href:"https://zellwk.com/blog/npm-exports",children:"public API"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'{\n  "exports": {\n    ".": {\n      "types": "./dist/index.d.ts",\n      "module": "./dist/index.mjs",\n      "import": "./dist/index.mjs",\n      "require": "./dist/index.cjs",\n      "default": "./dist/index.mjs"\n    },\n    "./package.json": "./package.json"\n  },\n  "types": "./dist/index.d.ts",\n  "browser": "./dist/index.mjs",\n  "module": "./dist/index.mjs",\n  "main": "./dist/index.cjs"\n}\n'})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"exports"})," configures JavaScript level,\nfile ",(0,r.jsx)(e.code,{children:"packages/rest/build/gen/util/regexp-tools.js"}),"\ncan be imported via ",(0,r.jsx)(e.code,{children:"@github/rest/gen/util/regexp-tools"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Don't need to mention directory ",(0,r.jsx)(e.code,{children:"build"}),"/",(0,r.jsx)(e.code,{children:"dist"})," in module specifiers."]}),"\n",(0,r.jsxs)(e.li,{children:["Don't need to mention ",(0,r.jsx)(e.code,{children:".js"}),"/",(0,r.jsx)(e.code,{children:".ts"})," in module specifiers."]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'{\n  "name": "@github/rest",\n  "private": true,\n  "exports": {\n    "./": "./dist/index.js",\n    "./gen/*": "./dist/gen/*.js",\n    "./client/*": "./dist/client/*.js",\n    "./contract": "./dist/contract.js",\n    "./state": "./dist/state.js",\n    "./package.json": "./package.json"\n  }\n}\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-js",children:"import octokit from '@github/rest'\nimport { Contract } from '@github/rest/contract'\nimport utils from '@github/rest/gen/utils'\nimport state from '@github/rest/state'\n"})}),"\n",(0,r.jsx)(e.h3,{id:"resolutions",children:"Resolutions"}),"\n",(0,r.jsxs)(e.p,{children:["Besides ",(0,r.jsx)(e.code,{children:"git bisect"})," for debugging broken version,\nrevert to last working version with ",(0,r.jsx)(e.code,{children:"resolutions"})," field\nwill help to ",(0,r.jsx)(e.a,{href:"https://github.com/ant-design/ant-design/pull/48829",children:"fix broken version too"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'{\n  "resolutions": {\n    "rc-field-form": "1.44.0"\n  }\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"lockfile",children:"Lockfile"}),"\n",(0,r.jsxs)(e.p,{children:["Dependency ",(0,r.jsx)(e.a,{href:"https://docs.renovatebot.com/dependency-pinning",children:"pinning"}),":"]}),"\n",(0,r.jsxs)(e.p,{children:["When kept in sync with its associated ",(0,r.jsx)(e.code,{children:"package.json"}),",\na lockfile will further lock down the exact dependencies and sub-dependencies,\nso that everyone running ",(0,r.jsx)(e.code,{children:"npm i"})," or ",(0,r.jsx)(e.code,{children:"yarn"})," will install the exact same dependencies."]}),"\n",(0,r.jsxs)(e.p,{children:["If the ",(0,r.jsx)(e.code,{children:"package.json"})," contains a range,\nand a new in-range version is released that would break the build,\nthen essentially ",(0,r.jsx)(e.code,{children:"package.json"})," is in a state of ",(0,r.jsx)(e.strong,{children:"broken"}),",\neven if the lockfile is still holding things together."]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Apps (web or Node.js) that aren't ",(0,r.jsx)(e.code,{children:"require()"})," by other packages\nshould pin all types of dependencies for greatest reliability/predictability."]}),"\n",(0,r.jsxs)(e.li,{children:["Libraries that are ",(0,r.jsx)(e.code,{children:"consumed"}),"/",(0,r.jsx)(e.code,{children:"required()"})," by others\nshould keep using SemVer ranges for ",(0,r.jsx)(e.strong,{children:"dependencies"})," (purge multiple version ",(0,r.jsx)(e.code,{children:"node_modules"}),")\nbut can use pinned devDependencies."]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"environment",children:"Environment"}),"\n",(0,r.jsxs)(e.p,{children:["\u914d\u7f6e\u6587\u4ef6\u4ee5 ",(0,r.jsx)(e.code,{children:".env"}),"/",(0,r.jsx)(e.code,{children:"JS(Object)"}),"/",(0,r.jsx)(e.code,{children:"JSON"}),"/",(0,r.jsx)(e.code,{children:"JSONP"}),"/",(0,r.jsx)(e.code,{children:"XML"}),"/",(0,r.jsx)(e.code,{children:"YML"})," \u683c\u5f0f\u5355\u72ec\u5b58\u653e,\n\u65b9\u4fbf\u8bfb\u53d6."]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# .env file (added to .gitignore)\nNODE_ENV=development\nPORT=8626\n# Set your database/API connection information here\nAPI_KEY=**************************\nAPI_URL=**************************\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ts",children:"// config.js\nconst dotenv = require('dotenv')\n\ndotenv.config()\n\nmodule.exports = {\n  endpoint: process.env.API_URL,\n  masterKey: process.env.API_KEY,\n  port: process.env.PORT,\n}\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ts",children:"// server.js\nconst { port } = require('./config')\n\nconsole.log(`Your port is ${port}`) // 8626\n"})})]})}function p(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}},86145:(n,e,s)=>{s.d(e,{R:()=>c,x:()=>a});var i=s(57140);const r={},o=i.createContext(r);function c(n){const e=i.useContext(o);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:c(n.components),i.createElement(o.Provider,{value:e},n.children)}}}]);