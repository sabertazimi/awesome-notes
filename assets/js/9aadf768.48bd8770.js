"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[1837],{61028:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>u,frontMatter:()=>t,metadata:()=>l,toc:()=>c});const l=JSON.parse('{"id":"language/verilog/xilinx","title":"Xilinx U280","description":"Host Application","source":"@site/content/language/verilog/xilinx.md","sourceDirName":"language/verilog","slug":"/language/verilog/xilinx","permalink":"/notes/language/verilog/xilinx","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/language/verilog/xilinx.md","tags":[{"inline":true,"label":"Language","permalink":"/notes/tags/language"},{"inline":true,"label":"Verilog","permalink":"/notes/tags/verilog"},{"inline":true,"label":"FPGA","permalink":"/notes/tags/fpga"},{"inline":true,"label":"Xilinx","permalink":"/notes/tags/xilinx"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":30,"frontMatter":{"sidebar_position":30,"tags":["Language","Verilog","FPGA","Xilinx"]},"sidebar":"tutorialSidebar","previous":{"title":"SystemVerilog","permalink":"/notes/language/verilog/systemverilog"},"next":{"title":"AXI Protocol","permalink":"/notes/language/verilog/axi"}}');var r=i(35656),s=i(86145);const t={sidebar_position:30,tags:["Language","Verilog","FPGA","Xilinx"]},a="Xilinx U280",o={},c=[{value:"Host Application",id:"host-application",level:2},{value:"Workflow",id:"workflow",level:3},{value:"TLP",id:"tlp",level:3},{value:"Toolchain",id:"toolchain",level:2},{value:"GDB",id:"gdb",level:3},{value:"XCL",id:"xcl",level:3},{value:"XOCC",id:"xocc",level:3},{value:"XBUtil",id:"xbutil",level:3},{value:"Dmesg",id:"dmesg",level:3},{value:"ILA",id:"ila",level:3}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"xilinx-u280",children:"Xilinx U280"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"-xp param (clock frequency etc.)\n-R report level\n-slr SLR region setting\n-sp memory resources mapping\n"})}),"\n",(0,r.jsx)(n.h2,{id:"host-application",children:"Host Application"}),"\n",(0,r.jsx)(n.h3,{id:"workflow",children:"Workflow"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"set the kernel arguments before performing any enqueue operation"}),"\n",(0,r.jsxs)(n.li,{children:["keeping the buffer size ",(0,r.jsx)(n.strong,{children:"2 MB ~ 4 GB"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"posix_memalign"})," is used instead of malloc for the host memory space pointer"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"uint32_t *a, *b, *c, *d = NULL;\nposix_memalign((void **)&a, 4096, BUF_SIZE * sizeof(uint32_t));\nposix_memalign((void **)&b, 4096, BUF_SIZE * sizeof(uint32_t));\nposix_memalign((void **)&c, 4096, BUF_SIZE * sizeof(uint32_t));\nposix_memalign((void **)&d, 4096, BUF_SIZE * sizeof(uint32_t));\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"release resources for proper performance profile report"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"clReleaseCommandQueue(Command_Queue);\nclReleaseContext(Context);\nclReleaseDevice(Target_Device_ID);\nclReleaseKernel(Kernel);\nclReleaseProgram(Program);\nfree(Platform_IDs);\nfree(Device_IDs);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"tlp",children:"TLP"}),"\n",(0,r.jsxs)(n.p,{children:["It is advisable to use the ",(0,r.jsx)(n.code,{children:"posix_spawn()"})," system call\nto launch another process from the SDAccel environment application."]}),"\n",(0,r.jsx)(n.h2,{id:"toolchain",children:"Toolchain"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"xbutil query"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"platforminfo"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"kernelinfo"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"xclbinutil"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"dmesg"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"gdb",children:"GDB"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"xprint queue [<cl_command_queue>]\nxprint event <cl_event>\nxprint mem [<cl_mem>]\nxprint kernel\nxprint all\nxstatus all\nxstatus --<ipName>\n"})}),"\n",(0,r.jsx)(n.h3,{id:"xcl",children:"XCL"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"xclbinutil -i binary_container_1.xclbin --info\n"})}),"\n",(0,r.jsx)(n.h3,{id:"xocc",children:"XOCC"}),"\n",(0,r.jsx)(n.p,{children:"Checking out-of-bound access made by kernel interface buffers (option: address)\nand uninitialized memory access initiated by kernel local to kernel (option: memory)."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"xocc -l -t sw_emu --xp param:compiler.fsanitize=address -o bin_kernel.xclbin\nxocc -l -t sw_emu --xp param:compiler.fsanitize=memory -o bin_kernel.xclbin\nxocc -l -t sw_emu --xp param:compiler.fsanitize=address,memory -o bin_kernel.xclbin\n"})}),"\n",(0,r.jsx)(n.h3,{id:"xbutil",children:"XBUtil"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo /opt/xilinx/xrt/bin/xbutil flash -a <shell_name> # flash the firmware\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo lspci -vd 10ee:\nsudo /opt/xilinx/xrt/bin/xbutil flash scan\nsudo /opt/xilinx/xrt/bin/xbutil validate -d <card_id>\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"xbutil program -p <xclbin>\nxbutil query         # check memory banks usage\nxbutil status --lapc # check AXI violations\n"})}),"\n",(0,r.jsx)(n.h3,{id:"dmesg",children:"Dmesg"}),"\n",(0,r.jsx)(n.h3,{id:"ila",children:"ILA"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"debug protocol hangs"}),"\n",(0,r.jsx)(n.li,{children:"examine the burst size, pipelining and data width to locate the bottleneck"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:'....\nstd::string binaryFile = xcl::find_binary_file(device_name,"vAdd");\ncl::Program::Binaries bins = xcl::import_binary_file(binaryFile);\ndevices.resize(1);\ncl::Program program(context, devices, bins);\ncl::Kernel kernel_vAdd(program,"kernel_vAdd_rtl");\n\n// wait_for_enter("\\nPress ENTER to continue after setting up ILA trigger...");\nstd::cout << "Pausing to arm ILA trigger. Hit enter here to resume host program..."\n          << std::endl;\nstd::cin.get();\n\n//Allocate Buffer in Global Memory\nstd::vector<cl::Memory> inBufVec, outBufVec;\ncl::Buffer buffer_r1(context,CL_MEM_USE_HOST_PTR | CL_MEM_READ_ONLY,\nvector_size_bytes, source_input1.data());\n// ...\n// ...\n// ...\n\n//Copy input data to device global memory\nq.enqueueMigrateMemObjects(inBufVec,0/* 0 means from host*/);\n\n//Set the Kernel Arguments\n// ...\n// ...\n// ...\n\n//Launch the Kernel\nq.enqueueTask(kernel_vAdd);\n'})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},86145:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>a});var l=i(57140);const r={},s=l.createContext(r);function t(e){const n=l.useContext(s);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),l.createElement(s.Provider,{value:n},e.children)}}}]);