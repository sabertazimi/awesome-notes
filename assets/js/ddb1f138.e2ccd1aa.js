"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[37202],{94241:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>o,frontMatter:()=>s,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"programming/design/architecture","title":"Architecture","description":"Clean Architecture","source":"@site/content/programming/design/architecture.md","sourceDirName":"programming/design","slug":"/programming/design/architecture","permalink":"/notes/programming/design/architecture","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/programming/design/architecture.md","tags":[{"inline":true,"label":"Programming","permalink":"/notes/tags/programming"},{"inline":true,"label":"DevOps","permalink":"/notes/tags/dev-ops"},{"inline":true,"label":"Design Pattern","permalink":"/notes/tags/design-pattern"},{"inline":true,"label":"Architecture","permalink":"/notes/tags/architecture"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"frontMatter":{"tags":["Programming","DevOps","Design Pattern","Architecture"]},"sidebar":"tutorialSidebar","previous":{"title":"Design","permalink":"/notes/programming/design/"},"next":{"title":"Paradigms","permalink":"/notes/programming/design/paradigms"}}');var l=i(35656),t=i(86145);const s={tags:["Programming","DevOps","Design Pattern","Architecture"]},a="Architecture",c={},d=[{value:"Domain Driven Design",id:"domain-driven-design",level:2},{value:"Interface Layer",id:"interface-layer",level:3},{value:"Application Layer",id:"application-layer",level:3},{value:"Domain Layer",id:"domain-layer",level:3},{value:"Infrastructure Layer",id:"infrastructure-layer",level:3},{value:"Scalability",id:"scalability",level:2},{value:"High Concurrency",id:"high-concurrency",level:2},{value:"Code Layer",id:"code-layer",level:3},{value:"DataBase Layer",id:"database-layer",level:3},{value:"Architecture Layer",id:"architecture-layer",level:3},{value:"High Availability",id:"high-availability",level:2},{value:"Resource Isolation",id:"resource-isolation",level:3},{value:"Load Balance",id:"load-balance",level:3},{value:"Idempotence",id:"idempotence",level:3},{value:"CAP",id:"cap",level:3},{value:"\u670d\u52a1\u7194\u65ad",id:"\u670d\u52a1\u7194\u65ad",level:3},{value:"\u670d\u52a1\u9650\u6d41",id:"\u670d\u52a1\u9650\u6d41",level:3},{value:"\u7b97\u6cd5",id:"\u7b97\u6cd5",level:4},{value:"\u7b56\u7565",id:"\u7b56\u7565",level:4},{value:"\u4f4d\u7f6e",id:"\u4f4d\u7f6e",level:4},{value:"\u670d\u52a1\u964d\u7ea7",id:"\u670d\u52a1\u964d\u7ea7",level:3},{value:"References",id:"references",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",p:"p",ul:"ul",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"architecture",children:"Architecture"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"Clean Architecture",src:i(336).A+"",title:"Clean Architecture",width:"1274",height:"919"})}),"\n",(0,l.jsx)(n.h2,{id:"domain-driven-design",children:"Domain Driven Design"}),"\n",(0,l.jsx)(n.h3,{id:"interface-layer",children:"Interface Layer"}),"\n",(0,l.jsx)(n.p,{children:"\u4e3b\u8981\u8d1f\u8d23\u4e0e\u5916\u90e8\u7cfb\u7edf\u8fdb\u884c\u4ea4\u4e92\u4e0e\u901a\u4fe1:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u505a\u53c2\u6570\u7684\u57fa\u672c\u5904\u7406, \u6bd4\u5982\u5165\u53c2\u6821\u9a8c, \u56de\u53c2 DTO \u8f6c\u6362 (\u62c6\u5305, \u7ec4\u5305)"}),"\n",(0,l.jsx)(n.li,{children:"Dubbo Services"}),"\n",(0,l.jsx)(n.li,{children:"RESTful API"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"application-layer",children:"Application Layer"}),"\n",(0,l.jsx)(n.p,{children:"Application Service \u5c42\u53ea\u662f\u5f88\u8584\u7684\u4e00\u5c42,\n\u5b83\u5185\u90e8\u5e76\u4e0d\u5b9e\u73b0\u4efb\u4f55\u903b\u8f91,\n\u53ea\u662f\u8d1f\u8d23\u534f\u8c03\u548c\u8f6c\u53d1 (\u6d41\u7a0b\u7f16\u6392),\n\u59d4\u6d3e\u4e1a\u52a1\u52a8\u4f5c\u7ed9\u66f4\u4e0b\u5c42\u7684\u9886\u57df\u5c42."}),"\n",(0,l.jsx)(n.h3,{id:"domain-layer",children:"Domain Layer"}),"\n",(0,l.jsx)(n.p,{children:"Domain \u5c42\u662f\u9886\u57df\u6a21\u578b\u7cfb\u7edf\u7684\u6838\u5fc3,\n\u8d1f\u8d23\u7ef4\u62a4\u9762\u5411\u5bf9\u8c61\u7684\u9886\u57df\u6a21\u578b,\n\u51e0\u4e4e\u5168\u90e8\u7684\u4e1a\u52a1\u903b\u8f91\u90fd\u4f1a\u5728\u8fd9\u4e00\u5c42\u5b9e\u73b0.\n\u5185\u90e8\u4e3b\u8981\u5305\u542b Entity, ValueObject, Domain Event, Repository."}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Controller"})," will receive the user\u2019s requests and reply with a structured response."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Service"})," will process the user\u2019s request,\nincluding validations and third-party reporting,\nand will receive data using the repository layer as a source of truth."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Repository"})," will function as the application\u2019s source of truth,\nwill include the DB and external services queries."]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"infrastructure-layer",children:"Infrastructure Layer"}),"\n",(0,l.jsx)(n.p,{children:"\u4e3b\u8981\u4e3a Interface, Application \u548c Domain \u4e09\u5c42\u63d0\u4f9b\u652f\u6491:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5c01\u88c5\u57fa\u7840\u8d44\u6e90\u670d\u52a1, \u901a\u8fc7\u4f9d\u8d56\u6ce8\u5165\u65b9\u5f0f\u89e3\u8026."}),"\n",(0,l.jsx)(n.li,{children:"Third-party tools, Message Queue, File, Cache, Database, Search etc."}),"\n",(0,l.jsx)(n.li,{children:"\u5b9e\u73b0\u4ed3\u50a8\u63a5\u53e3 DB, \u901a\u5e38\u771f\u6b63\u8bfb\u5199 DB."}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"scalability",children:"Scalability"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Prefer composites over mixins."}),"\n",(0,l.jsx)(n.li,{children:"Always clone objects between components."}),"\n",(0,l.jsx)(n.li,{children:"Use namespaced state store modules."}),"\n",(0,l.jsx)(n.li,{children:"Write robust tests."}),"\n",(0,l.jsx)(n.li,{children:"Interact with REST API via services/SDK."}),"\n",(0,l.jsxs)(n.li,{children:["Wrap third-party libraries other using them directly:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Abstract: changing dependencies without changing interface."}),"\n",(0,l.jsx)(n.li,{children:"Extendability: More obvious route to extending functionality."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Stability:\n\u7ec4\u4ef6\u7ed3\u6784\u4f9d\u8d56\u56fe\u4e2d\u5404\u7ec4\u4ef6\u7684\u7a33\u5b9a\u6027\u6307\u6807 I \u5fc5\u987b\u8981\u6309\u5176\u4f9d\u8d56\u5173\u7cfb\u65b9\u5411\u9012\u51cf,\n\u8ba9\u6bcf\u4e2a\u7ec4\u4ef6\u7684 I \u6307\u6807\u90fd\u5fc5\u987b\u5927\u4e8e\u5176\u6240\u4f9d\u8d56\u7ec4\u4ef6\u7684 I \u6307\u6807,\n",(0,l.jsx)(n.code,{children:"I = FanOut / (FanOut + FanIn)"}),",\n",(0,l.jsx)(n.code,{children:"I = 0"})," \u8868\u793a\u4e0d\u4f9d\u8d56\u4efb\u4f55\u6a21\u5757 (\u6700\u7a33\u5b9a),\n",(0,l.jsx)(n.code,{children:"I = 1"})," \u8868\u793a\u4e0d\u88ab\u4efb\u4f55\u6a21\u5757\u4f9d\u8d56 (\u6700\u4e0d\u7a33\u5b9a)."]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"high-concurrency",children:"High Concurrency"}),"\n",(0,l.jsx)(n.h3,{id:"code-layer",children:"Code Layer"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Mutex Performance"}),"\n",(0,l.jsx)(n.li,{children:"Database Caches"}),"\n",(0,l.jsx)(n.li,{children:"Update Merge"}),"\n",(0,l.jsx)(n.li,{children:"BloomFilter"}),"\n",(0,l.jsx)(n.li,{children:"Asynchronous"}),"\n",(0,l.jsx)(n.li,{children:"Multi-Thread"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"database-layer",children:"DataBase Layer"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Table structure design."}),"\n",(0,l.jsx)(n.li,{children:"Index design."}),"\n",(0,l.jsx)(n.li,{children:"Query optimization: \u907f\u514d\u590d\u6742\u7684\u591a\u8868\u8fde\u63a5."}),"\n",(0,l.jsx)(n.li,{children:"Read and write separation: \u4e3b\u4ece\u590d\u5236, Write-Ahead Logging (WAL)."}),"\n",(0,l.jsx)(n.li,{children:"Data sharding and data partition: split table."}),"\n",(0,l.jsx)(n.li,{children:"Hot data cache."}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://openai.com/index/scaling-postgresql",children:(0,l.jsx)(n.img,{alt:"Cascading Replication",src:i(86020).A+"",width:"596",height:"345"})})}),"\n",(0,l.jsx)(n.h3,{id:"architecture-layer",children:"Architecture Layer"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Microservices"}),"\n",(0,l.jsx)(n.li,{children:"Scale Friendly"}),"\n",(0,l.jsx)(n.li,{children:"FailFast"}),"\n",(0,l.jsx)(n.li,{children:"Data PreFetch"}),"\n",(0,l.jsx)(n.li,{children:"Multi-Level Caches"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"high-availability",children:"High Availability"}),"\n",(0,l.jsx)(n.h3,{id:"resource-isolation",children:"Resource Isolation"}),"\n",(0,l.jsx)(n.h3,{id:"load-balance",children:"Load Balance"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Hardware Load Balance"}),"\n",(0,l.jsx)(n.li,{children:"Software Load Balance"}),"\n",(0,l.jsx)(n.li,{children:"Load Balance Algorithms:\nRandom, RoundRobin, WeightRoundRobin, ConsistentHash"}),"\n",(0,l.jsx)(n.li,{children:"Error Machines Auto Detection"}),"\n",(0,l.jsx)(n.li,{children:"Error Services Auto Retirement"}),"\n",(0,l.jsx)(n.li,{children:"Services Retry Automation"}),"\n",(0,l.jsx)(n.li,{children:"Recovery Services Auto Detection"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"idempotence",children:"Idempotence"}),"\n",(0,l.jsx)(n.p,{children:"\u5728\u7f16\u7a0b\u4e2d\u4e00\u4e2a\u5e42\u7b49\u64cd\u4f5c\u7684\u7279\u70b9\u662f\u5176\u4efb\u610f\u591a\u6b21\u6267\u884c\u6240\u4ea7\u751f\u7684\u5f71\u54cd\u5747\u4e0e\u4e00\u6b21\u6267\u884c\u7684\u5f71\u54cd\u76f8\u540c."}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Mutex"}),"\n",(0,l.jsx)(n.li,{children:"Key Index"}),"\n",(0,l.jsx)(n.li,{children:"Token"}),"\n",(0,l.jsx)(n.li,{children:"Data Version"}),"\n",(0,l.jsx)(n.li,{children:"State Machine"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"cap",children:"CAP"}),"\n",(0,l.jsx)(n.p,{children:"A distributed system to simultaneously provide\nmore than two out of the following three guarantees:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Consistency:\nEvery read receives the most recent write or an error."}),"\n",(0,l.jsx)(n.li,{children:"Availability:\nEvery request receives a (non-error) response,\nwithout the guarantee that it contains the most recent write."}),"\n",(0,l.jsx)(n.li,{children:"Partition tolerance:\nThe system continues to operate\ndespite an arbitrary number of messages\nbeing dropped (or delayed) by the network between nodes."}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"\u670d\u52a1\u7194\u65ad",children:"\u670d\u52a1\u7194\u65ad"}),"\n",(0,l.jsx)(n.p,{children:"\u5f53\u4e0b\u6e38\u670d\u52a1\u4e0d\u53ef\u7528\u6216\u54cd\u5e94\u8fc7\u6162\u65f6, \u4e0a\u6e38\u670d\u52a1\u505c\u6b62\u8c03\u7528\u8be5\u670d\u52a1,\n\u76f4\u63a5\u5feb\u901f\u5931\u8d25\u5e76\u8fd4\u56de\u9ed8\u8ba4\u54cd\u5e94\u6216\u6267\u884c\u964d\u7ea7\u903b\u8f91, \u4ece\u800c\u4fdd\u62a4\u7cfb\u7edf\u6574\u4f53\u53ef\u7528\u6027."}),"\n",(0,l.jsx)(n.h3,{id:"\u670d\u52a1\u9650\u6d41",children:"\u670d\u52a1\u9650\u6d41"}),"\n",(0,l.jsx)(n.h4,{id:"\u7b97\u6cd5",children:"\u7b97\u6cd5"}),"\n",(0,l.jsx)(n.p,{children:"\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u53ef\u4ee5\u53c2\u8003\u8ba1\u7b97\u673a\u7f51\u7edc\u62e5\u585e\u63a7\u5236\u7b97\u6cd5:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u8ba1\u6570\u5668\u56fa\u5b9a\u7a97\u53e3\u9650\u6d41:\n\u5355\u4f4d\u65f6\u95f4\u5185\u8fbe\u5230\u9608\u503c\u540e\u5f00\u59cb\u9650\u6d41, \u5355\u4f4d\u65f6\u95f4\u540e\u91cd\u65b0\u8ba1\u6570.\n\u7a97\u53e3\u4e34\u754c\u5904\u6d41\u91cf\u8fc7\u5927, \u5bfc\u81f4\u670d\u52a1\u4e0d\u53ef\u7528."}),"\n",(0,l.jsx)(n.li,{children:"\u6ed1\u52a8\u7a97\u53e3\u9650\u6d41:\n\u5728\u56fa\u5b9a\u7a97\u53e3\u9650\u6d41\u57fa\u7840\u4e0a, \u5c06\u7a97\u53e3\u5411\u53f3\u6ed1\u52a8."}),"\n",(0,l.jsx)(n.li,{children:"\u6f0f\u6597\u9650\u6d41:\n\u672a\u6ee1\u524d\u53ef\u8fdb\u5165, \u6ee1\u5219\u62d2\u7edd.\n\u53ef\u4ee5\u5e73\u6ed1\u6d41\u91cf, \u65e0\u6cd5\u89e3\u51b3\u7a81\u53d1\u6d41\u91cf."}),"\n",(0,l.jsx)(n.li,{children:"\u4ee4\u724c\u6876\u9650\u6d41:\n\u5728\u6f0f\u6597\u9650\u6d41\u57fa\u7840\u4e0a, \u4ee5\u6052\u5b9a\u901f\u7387\u4ea7\u751f\u4ee4\u724c.\n\u62e5\u6709\u4ee4\u724c\u53ef\u8fdb\u5165, \u65e0\u5219\u62d2\u7edd.\n\u53ef\u4ee5\u5e73\u6ed1\u6d41\u91cf, \u53ef\u4ee5\u5bb9\u5fcd\u7a81\u53d1\u6d41\u91cf."}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"\u7b56\u7565",children:"\u7b56\u7565"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u670d\u52a1\u62d2\u7edd"}),"\n",(0,l.jsx)(n.li,{children:"\u5ef6\u65f6\u5904\u7406"}),"\n",(0,l.jsx)(n.li,{children:"\u8bf7\u6c42\u5206\u7ea7"}),"\n",(0,l.jsx)(n.li,{children:"\u76d1\u63a7\u9884\u8b66"}),"\n",(0,l.jsx)(n.li,{children:"\u52a8\u6001\u9650\u6d41"}),"\n",(0,l.jsx)(n.li,{children:"\u52a8\u6001\u6269\u5bb9"}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"\u4f4d\u7f6e",children:"\u4f4d\u7f6e"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u63a5\u5165\u5c42\u9650\u6d41: \u901a\u8fc7 Nginx/API Router \u5bf9 DNS/IP \u9650\u6d41."}),"\n",(0,l.jsx)(n.li,{children:"\u5e94\u7528\u9650\u6d41: \u6bcf\u4e2a\u670d\u52a1\u62e5\u6709\u81ea\u5df1\u7684\u96c6\u7fa4\u9650\u6d41\u670d\u52a1."}),"\n",(0,l.jsx)(n.li,{children:"\u57fa\u7840\u670d\u52a1\u9650\u6d41: \u5bf9\u6d88\u606f\u961f\u5217/\u6570\u636e\u5e93\u9650\u6d41."}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"\u670d\u52a1\u964d\u7ea7",children:"\u670d\u52a1\u964d\u7ea7"}),"\n",(0,l.jsx)(n.p,{children:"\u670d\u52a1\u5668\u538b\u529b\u5267\u589e\u65f6, \u6839\u636e\u4e1a\u52a1\u4f18\u5148\u7ea7\u5bf9\u975e\u6838\u5fc3\u670d\u52a1\u6216\u9875\u9762\u91c7\u7528\u7b56\u7565\u6027\u5904\u7406,\n\u5982\u76f4\u63a5\u8fd4\u56de\u515c\u5e95\u6570\u636e (fallback) \u6216\u62d2\u7edd\u8bf7\u6c42, \u4ece\u800c\u91ca\u653e\u8d44\u6e90\u4fdd\u8bc1\u6838\u5fc3\u529f\u80fd\u7a33\u5b9a."}),"\n",(0,l.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Frontend domain driven design ",(0,l.jsx)(n.a,{href:"https://dev.to/bespoyasov/clean-architecture-on-frontend-4311",children:"guide"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Scalable React project structure ",(0,l.jsx)(n.a,{href:"https://github.com/developerway/example-react-project",children:"guide"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Nest.js clean architecture ",(0,l.jsx)(n.a,{href:"https://medium.com/@jonathan.pretre91/clean-architecture-with-nestjs-e089cef65045",children:"template"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Domain driven design layout in ",(0,l.jsx)(n.a,{href:"https://github.com/lupguo/ddd-layout",children:"Golang"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Scaling PostgreSQL to ",(0,l.jsx)(n.a,{href:"https://openai.com/index/scaling-postgresql",children:"millions of QPS"}),"."]}),"\n"]})]})}function o(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(h,{...e})}):h(e)}},86020:(e,n,i)=>{i.d(n,{A:()=>r});const r=i.p+"assets/images/cascading-replication-0c3dfcdc09e2d24c52255af4487a79b1.svg"},336:(e,n,i)=>{i.d(n,{A:()=>r});const r=i.p+"assets/images/clean-architecture-0cc6a65651528cc435f6c10394463515.png"},86145:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>a});var r=i(57140);const l={},t=r.createContext(l);function s(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:s(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);