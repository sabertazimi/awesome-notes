"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[26022],{41448:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"web/security/csrf","title":"CSRF","description":"Attack","source":"@site/content/web/security/csrf.md","sourceDirName":"web/security","slug":"/web/security/csrf","permalink":"/notes/web/security/csrf","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/security/csrf.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"Security","permalink":"/notes/tags/security"},{"inline":true,"label":"CSRF","permalink":"/notes/tags/csrf"},{"inline":true,"label":"Vulnerability","permalink":"/notes/tags/vulnerability"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":11,"frontMatter":{"sidebar_position":11,"tags":["Web","Security","CSRF","Vulnerability"]},"sidebar":"tutorialSidebar","previous":{"title":"XSS","permalink":"/notes/web/security/xss"},"next":{"title":"SQL Injection","permalink":"/notes/web/security/sql"}}');var i=s(35656),t=s(86145);const c={sidebar_position:11,tags:["Web","Security","CSRF","Vulnerability"]},l="CSRF",d={},o=[{value:"Attack",id:"attack",level:2},{value:"Protection",id:"protection",level:2}];function a(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"csrf",children:"CSRF"})}),"\n",(0,i.jsx)(n.h2,{id:"attack",children:"Attack"}),"\n",(0,i.jsxs)(n.p,{children:["Cross-site request forgery (\u8de8\u7ad9\u8bf7\u6c42\u4f2a\u9020)\n\u631f\u5236\u7528\u6237\u5728\u5f53\u524d\u5df2\u767b\u5f55\u7684 Web \u5e94\u7528\u7a0b\u5e8f\u4e0a\u6267\u884c",(0,i.jsx)(n.strong,{children:"\u975e\u672c\u610f"}),"\u7684\u64cd\u4f5c,\n\u5229\u7528\u5df2\u8ba4\u8bc1\u7528\u6237 (\u957f\u671f\u672c\u5730 ",(0,i.jsx)(n.code,{children:"Cookie"}),"), \u8bbf\u95ee\u653b\u51fb\u8005\u7f51\u7ad9, \u5e76\u88ab\u5f3a\u5236\u6267\u884c\u811a\u672c,\n\u5728\u7528\u6237\u4e0d\u77e5\u60c5\u7684\u60c5\u51b5\u4e0b\u63d0\u4ea4 ",(0,i.jsx)(n.code,{children:"GET"}),"/",(0,i.jsx)(n.code,{children:"POST"})," request (\u957f\u671f\u672c\u5730 ",(0,i.jsx)(n.code,{children:"Cookie"}),"):"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'<link href="">'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'<a href="">'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'<img src="">'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'<img lowsrc="">'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'<img dynsrc="">'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'<iframe src="">'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'<frame src="">'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'<meta http-equiv="refresh" content="0; url=">'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'<script src="">'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'<bgsound src="">'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'<embed src="">'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'<video src="">'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'<audio src="">'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'<table background="">'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'@import ""'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'background: url("")'}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{title:"XSS vs CSRF",type:"tip",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"XSS \u5229\u7528\u7684\u662f\u7f51\u7ad9\u5bf9\u7528\u6237 (\u8f93\u5165) \u7684\u4fe1\u4efb."}),"\n",(0,i.jsx)(n.li,{children:"CSRF \u5229\u7528\u7684\u662f\u7f51\u7ad9\u5bf9\u7528\u6237\u7f51\u9875\u6d4f\u89c8\u5668\u7684\u4fe1\u4efb."}),"\n"]})}),"\n",(0,i.jsx)(n.h2,{id:"protection",children:"Protection"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"REST"})," (representational state transfer) \u539f\u5219:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"GET"})," request: only read objects, \u786e\u4fdd\u65e0\u526f\u4f5c\u7528."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"PUT"})," request: only create new objects."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"POST"})," request: only modify objects."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"DELETE"})," request: only delete objects."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u786e\u4fdd ",(0,i.jsx)(n.code,{children:"request"})," \u6b63\u5e38\u53d1\u8d77\u6e20\u9053:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Anti-CSRF cookie:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u4e0d\u53ef\u9884\u6d4b salt token: ",(0,i.jsx)(n.code,{children:"Set-Cookie: _xsrf=5978e29d4ef434a1"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Hidden token check in ",(0,i.jsx)(n.code,{children:"<form>"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u5f00\u542f\u540c\u6e90\u7b56\u7565: ",(0,i.jsx)(n.code,{children:"Set-Cookie: _xsrf=5978e29d4ef434a1; SameSite=Strict;"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["\u68c0\u67e5 HTTP ",(0,i.jsx)(n.code,{children:"Referer"})," \u8bf7\u6c42\u5934."]}),"\n",(0,i.jsxs)(n.li,{children:["\u68c0\u67e5\u7b2c\u4e09\u65b9\u7f51\u7ad9 ",(0,i.jsx)(n.code,{children:"URL"}),", \u663e\u793a\u7b2c\u4e09\u65b9\u5730\u5740\u8df3\u8f6c\u8b66\u544a\u9875\u9762:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Remove sensitive data in URL query and ",(0,i.jsx)(n.code,{children:"Referer"})," header."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'<a href="https://3rd.com" target="_blank" rel="noopener noreferrer nofollow">'}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"Require re-authentication for sensitive action:\n\u652f\u4ed8\u8d26\u5355, \u4fee\u6539\u90ae\u7bb1, \u5220\u9664\u8d26\u53f7."}),"\n",(0,i.jsxs)(n.li,{children:["Use mature ",(0,i.jsx)(n.code,{children:"CSRF"})," protection library:\nexpress.js ",(0,i.jsx)(n.code,{children:"csurf"})," library."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# Reject cross-origin requests to protect from\n# CSRF, XSSI & other bugs\ndef allow_request(req):\n  # Allow requests from browsers which don't send Fetch Metadata\n  if not req['sec-fetch-site']:\n    return True\n\n  # Allow same-site and browser-initiated requests\n  if req['sec-fetch-site'] in ('same-origin', 'same-site', 'none'):\n    return True\n\n  # Allow simple top-level navigation from anywhere\n  if req['sec-fetch-mode'] == 'navigate' and req.method == 'GET':\n    return True\n\n  return False\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},86145:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>l});var r=s(57140);const i={},t=r.createContext(i);function c(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);