"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[8975],{69178:(n,e,a)=>{a.r(e),a.d(e,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"web/javascript/async","title":"Async and Await","description":"Features","source":"@site/content/web/javascript/async.md","sourceDirName":"web/javascript","slug":"/web/javascript/async","permalink":"/notes/web/javascript/async","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/javascript/async.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"JavaScript","permalink":"/notes/tags/java-script"},{"inline":true,"label":"ECMAScript","permalink":"/notes/tags/ecma-script"},{"inline":true,"label":"Asynchronous","permalink":"/notes/tags/asynchronous"},{"inline":true,"label":"Await","permalink":"/notes/tags/await"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":21,"frontMatter":{"sidebar_position":21,"tags":["Web","JavaScript","ECMAScript","Asynchronous","Await"]},"sidebar":"tutorialSidebar","previous":{"title":"Promise","permalink":"/notes/web/javascript/promise"},"next":{"title":"Concurrency","permalink":"/notes/web/javascript/concurrency"}}');var t=a(35656),o=a(86145);const r={sidebar_position:21,tags:["Web","JavaScript","ECMAScript","Asynchronous","Await"]},i="Async and Await",c={},l=[{value:"Features",id:"features",level:2},{value:"Arrays",id:"arrays",level:2}];function d(n){const e={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",pre:"pre",ul:"ul",...(0,o.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"async-and-await",children:"Async and Await"})}),"\n",(0,t.jsx)(e.h2,{id:"features",children:"Features"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"async"})," \u5f02\u6b65\u51fd\u6570\u5982\u679c\u4e0d\u5305\u542b ",(0,t.jsx)(e.code,{children:"await"})," \u5173\u952e\u5b57, \u5176\u6267\u884c (\u9664\u8fd4\u56de\u503c\u5916) \u57fa\u672c\u4e0a\u8ddf\u666e\u901a\u51fd\u6570\u6ca1\u6709\u4ec0\u4e48\u533a\u522b."]}),"\n",(0,t.jsxs)(e.li,{children:["JavaScript \u8fd0\u884c\u65f6\u5728\u78b0\u5230 ",(0,t.jsx)(e.code,{children:"await"})," \u5173\u952e\u5b57\u65f6, \u4f1a\u8bb0\u5f55\u5728\u54ea\u91cc\u6682\u505c\u6267\u884c."]}),"\n",(0,t.jsxs)(e.li,{children:["\u7b49\u5230 ",(0,t.jsx)(e.code,{children:"await"})," \u53f3\u8fb9\u7684\u503c\u53ef\u7528\u4e86, JavaScript \u8fd0\u884c\u65f6\u4f1a\u5411\u6d88\u606f\u961f\u5217\u4e2d\u63a8\u9001\u4e00\u4e2a\u4efb\u52a1, \u8fd9\u4e2a\u4efb\u52a1\u4f1a\u6062\u590d\u5f02\u6b65\u51fd\u6570\u7684\u6267\u884c."]}),"\n",(0,t.jsxs)(e.li,{children:["\u5373\u4f7f ",(0,t.jsx)(e.code,{children:"await"})," \u540e\u9762\u8ddf\u7740\u4e00\u4e2a\u7acb\u5373\u53ef\u7528\u7684\u503c, \u51fd\u6570\u7684\u5176\u4f59\u90e8\u5206\u4e5f\u4f1a\u88ab\u5f02\u6b65\u6c42\u503c."]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ts",children:"async function foo() {\n  console.log(2)\n}\n\nconsole.log(1)\nfoo()\nconsole.log(3)\n// 1\n// 2\n// 3\n\nasync function bar() {\n  console.log(2)\n  await null\n  console.log(4)\n}\n\nconsole.log(1)\nbar()\nconsole.log(3)\n// 1\n// 2\n// 3\n// 4\n"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Await ",(0,t.jsx)(e.code,{children:"thenable"})," object (implements ",(0,t.jsx)(e.code,{children:"then"})," interface):"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ts",children:"async function bar() {\n  const thenable = {\n    then(callback) {\n      callback('bar')\n    },\n  }\n  return thenable\n}\n\nbar().then(console.log)\n// bar\n\nasync function baz() {\n  const thenable = {\n    then(callback) {\n      callback('baz')\n    },\n  }\n  console.log(await thenable)\n}\n\nbaz()\n// baz\n"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"async"}),"/",(0,t.jsx)(e.code,{children:"await"})," implement generator based asynchronous control flow:"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ts",children:"const fetchJson = co.wrap(function* (url) {\n  try {\n    const response = yield fetch(url)\n    const text = yield response.text()\n    return JSON.parse(text)\n  } catch (error) {\n    console.log(`ERROR: ${error.stack}`)\n  }\n})\n\nasync function fetchJson(url) {\n  try {\n    const response = await fetch(url)\n    const text = await response.text()\n    return JSON.parse(text)\n  } catch (error) {\n    console.log(`ERROR: ${error.stack}`)\n  }\n}\n"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"async"})," \u51fd\u6570\u81ea\u52a8\u5c06\u8fd4\u56de\u503c\u5305\u88c5\u4e3a ",(0,t.jsx)(e.code,{children:"Promise"}),":"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ts",children:"// BAD.\nasync function downloadContent(urls) {\n  const promiseArray = urls.map(fetch)\n  return await Promise.all(promiseArray)\n}\n\n// GOOD.\nasync function downloadContent(urls) {\n  const promiseArray = urls.map(fetch)\n  return Promise.all(promiseArray)\n}\n"})}),"\n",(0,t.jsx)(e.h2,{id:"arrays",children:"Arrays"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"If you want to execute await calls in series,\nuse a for-loop (or any loop without a callback)."}),"\n",(0,t.jsxs)(e.li,{children:["Don't ever use await with ",(0,t.jsx)(e.code,{children:"forEach"})," (",(0,t.jsx)(e.code,{children:"forEach"})," is not promise-aware),\nuse a for-loop (or any loop without a callback) instead."]}),"\n",(0,t.jsx)(e.li,{children:"Don't await inside filter and reduce,\nalways await an array of promises with map, then filter or reduce accordingly."}),"\n",(0,t.jsx)(e.li,{children:"Avoid wrong parallel logic (too sequential):"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ts",children:"// Wrong:\nconst books = await bookModel.fetchAll()\nconst author = await authorModel.fetch(authorId)\n\n// Correct:\nconst bookPromise = bookModel.fetchAll()\nconst authorPromise = authorModel.fetch(authorId)\nconst book = await bookPromise\nconst author = await authorPromise\n\nasync function getAuthors(authorIds) {\n  // WRONG, this will cause sequential calls\n  // const authors = authorIds.map(id => await authorModel.fetch(id));\n  // CORRECT:\n  const promises = authorIds.map(id => authorModel.fetch(id))\n  const authors = await Promise.all(promises)\n}\n"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ts",children:"async function randomDelay(id) {\n  const delay = Math.random() * 1000\n  return new Promise(resolve =>\n    setTimeout(() => {\n      console.log(`${id} finished`)\n      resolve(id)\n    }, delay)\n  )\n}\n\nasync function sequential() {\n  const t0 = Date.now()\n\n  for (let i = 0; i < 5; ++i)\n    await randomDelay(i)\n\n  console.log(`${Date.now() - t0}ms elapsed`)\n}\n\nsequential()\n// 0 finished\n// 1 finished\n// 2 finished\n// 3 finished\n// 4 finished\n// 2877ms elapsed\n\nasync function parallel() {\n  const t0 = Date.now()\n  const promises = Array.from({ length: 5 })\n    .fill(null)\n    .map((_, i) => randomDelay(i))\n\n  for (const p of promises)\n    console.log(`awaited ${await p}`)\n\n  console.log(`${Date.now() - t0}ms elapsed`)\n}\n\nparallel()\n// 4 finished\n// 2 finished\n// 1 finished\n// 0 finished\n// 3 finished\n// awaited 0\n// awaited 1\n// awaited 2\n// awaited 3\n// awaited 4\n// 645ms elapsed\n"})})]})}function h(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(d,{...n})}):d(n)}},86145:(n,e,a)=>{a.d(e,{R:()=>r,x:()=>i});var s=a(57140);const t={},o=s.createContext(t);function r(n){const e=s.useContext(o);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:r(n.components),s.createElement(o.Provider,{value:e},n.children)}}}]);