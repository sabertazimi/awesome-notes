"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[66013],{1870:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"web/react/fiber","title":"Fiber","description":"React Fiber","source":"@site/content/web/react/fiber.md","sourceDirName":"web/react","slug":"/web/react/fiber","permalink":"/notes/web/react/fiber","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/react/fiber.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"React","permalink":"/notes/tags/react"},{"inline":true,"label":"Internals","permalink":"/notes/tags/internals"},{"inline":true,"label":"Fiber","permalink":"/notes/tags/fiber"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":32,"frontMatter":{"sidebar_position":32,"tags":["Web","React","Internals","Fiber"]},"sidebar":"tutorialSidebar","previous":{"title":"Scheduler","permalink":"/notes/web/react/scheduler"},"next":{"title":"Reconciler","permalink":"/notes/web/react/reconciler"}}');var r=t(35656),i=t(86145);const o={sidebar_position:32,tags:["Web","React","Internals","Fiber"]},a="Fiber",c={},l=[{value:"Type",id:"type",level:2},{value:"Work Tag",id:"work-tag",level:2},{value:"Mode",id:"mode",level:2},{value:"Effects",id:"effects",level:2},{value:"Lanes",id:"lanes",level:2},{value:"Trees",id:"trees",level:2},{value:"Work Loop",id:"work-loop",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"fiber",children:"Fiber"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://tigerabrodi.blog/reacts-evolution-from-hooks-to-concurrent-react#heading-react-fiber",children:"React Fiber"}),"\n\u7684\u76ee\u6807\u662f\u63d0\u9ad8\u5176\u5728\u52a8\u753b\u3001\u5e03\u5c40\u548c\u624b\u52bf\u7b49\u9886\u57df\u7684\u9002\u7528\u6027:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u5b83\u7684\u4e3b\u8981\u7279\u6027\u662f ",(0,r.jsx)(n.code,{children:"Incremental Rendering"}),":\n\u5c06\u6e32\u67d3\u4efb\u52a1\u62c6\u5206\u4e3a\u5c0f\u7684\u4efb\u52a1\u5757\u5e76\u5c06\u4efb\u52a1\u5206\u914d\u5230\u591a\u4e2a\u5e27\u4e0a\u7684\u80fd\u529b."]}),"\n",(0,r.jsx)(n.li,{children:"Ability to pause and resume rendering."}),"\n",(0,r.jsx)(n.li,{children:"Ability to prioritize updates."}),"\n",(0,r.jsx)(n.li,{children:"Ability to work on multiple tasks concurrently."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"type",children:"Type"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"Fiber"})," ",(0,r.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactInternalTypes.js",children:"definition"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Component type."}),"\n",(0,r.jsx)(n.li,{children:"Current props and state."}),"\n",(0,r.jsx)(n.li,{children:"Pointers to parent, sibling, and child components,"}),"\n",(0,r.jsx)(n.li,{children:"Pointer to DOM/class instance."}),"\n",(0,r.jsx)(n.li,{children:"Other internal metadata to track rendering process."}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"export interface Fiber {\n  tag: WorkTag\n  key: string | null\n  elementType: any\n  type: any // Tag/Class/Function.\n  stateNode: any // DOM/class instance.\n  ref: (((handle: mixed) => void) & { _stringRef: ?string }) | RefObject | null\n\n  // Singly Linked List Tree Structure.\n  return: Fiber | null // DFS parent Fiber node.\n  child: Fiber | null\n  sibling: Fiber | null\n  index: number\n\n  // Props and state for output.\n  pendingProps: any\n  memoizedProps: any\n  updateQueue: mixed // Updates from diff(pendingProps, memoizedProps).\n  memoizedState: any\n\n  // Context API.\n  dependencies: Dependencies | null // (Contexts, Events) dependencies.\n\n  mode: TypeOfMode // NoMode/BlockingMode/ConcurrentMode bit.\n\n  // Effects.\n  flags: Flags\n  subtreeFlags: Flags\n  deletions: Array<Fiber> | null\n  nextEffect: Fiber | null // Next effect Fiber node.\n  firstEffect: Fiber | null // First effect Fiber node.\n  lastEffect: Fiber | null // Last effect Fiber node.\n\n  // Priority.\n  lanes: Lanes\n  childLanes: Lanes\n  alternate: Fiber | null // `current` Fiber and `workInProgress` Fiber.\n\n  // Performance statistics for React DevTool.\n  actualDuration?: number\n  actualStartTime?: number\n  selfBaseDuration?: number\n  treeBaseDuration?: number\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"work-tag",children:"Work Tag"}),"\n",(0,r.jsxs)(n.p,{children:["\u5e38\u89c1\u7684 Fiber ",(0,r.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactWorkTags.js",children:"\u7c7b\u578b"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"HostComponent: HTML native tag."}),"\n",(0,r.jsx)(n.li,{children:"ClassComponent."}),"\n",(0,r.jsx)(n.li,{children:"FunctionComponent."}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"type WorkTag\n  = | 'FunctionComponent'\n    | 'ClassComponent'\n    | 'IndeterminateComponent'\n    | 'HostRoot'\n    | 'HostPortal'\n    | 'HostComponent'\n    | 'HostText'\n    | 'Fragment'\n    | 'Mode'\n    | 'ContextConsumer'\n    | 'ContextProvider'\n    | 'ForwardRef'\n    | 'Profiler'\n    | 'SuspenseComponent'\n    | 'MemoComponent'\n    | 'SimpleMemoComponent'\n    | 'LazyComponent'\n    | 'IncompleteClassComponent'\n    | 'DehydratedFragment'\n    | 'SuspenseListComponent'\n    | 'FundamentalComponent'\n    | 'ScopeComponent'\n    | 'Block'\n    | 'OffscreenComponent'\n    | 'LegacyHiddenComponent'\n"})}),"\n",(0,r.jsx)(n.h2,{id:"mode",children:"Mode"}),"\n",(0,r.jsxs)(n.p,{children:["React ",(0,r.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactTypeOfMode.js",children:"\u8fd0\u884c\u6a21\u5f0f"}),":\n\u6240\u6709 ",(0,r.jsx)(n.code,{children:"Fiber.mode"})," \u4fdd\u6301\u4e00\u81f4 (\u5305\u62ec ",(0,r.jsx)(n.code,{children:"FiberRoot"}),")."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"type TypeOfMode = number\n\nconst NoMode = /*                         */ 0b000000\nconst ConcurrentMode = /*                 */ 0b000001\nconst ProfileMode = /*                    */ 0b000010\nconst DebugTracingMode = /*               */ 0b000100\nconst StrictLegacyMode = /*               */ 0b001000\nconst StrictEffectsMode = /*              */ 0b010000\nconst ConcurrentUpdatesByDefaultMode = /* */ 0b100000\n"})}),"\n",(0,r.jsx)(n.h2,{id:"effects",children:"Effects"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Insert DOM elements: ",(0,r.jsx)(n.code,{children:"Placement"})," tag."]}),"\n",(0,r.jsxs)(n.li,{children:["Update DOM elements: ",(0,r.jsx)(n.code,{children:"Update"})," tag."]}),"\n",(0,r.jsxs)(n.li,{children:["Delete DOM elements: ",(0,r.jsx)(n.code,{children:"Deletion"})," tag."]}),"\n",(0,r.jsxs)(n.li,{children:["Update Ref property: ",(0,r.jsx)(n.code,{children:"Ref"})," tag."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"useEffect"})," callback: ",(0,r.jsx)(n.code,{children:"got Passive"})," tag.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"useEffect(fn)"}),": ",(0,r.jsx)(n.code,{children:"Mount"})," and ",(0,r.jsx)(n.code,{children:"Update"})," lifecycle."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"useEffect(fn, [])"}),": ",(0,r.jsx)(n.code,{children:"Mount"})," lifecycle."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"useEffect(fn, [deps])"}),":\n",(0,r.jsx)(n.code,{children:"Mount"})," lifecycle and\n",(0,r.jsx)(n.code,{children:"Update"})," lifecycle with ",(0,r.jsx)(n.code,{children:"deps"})," changed."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["React create effects when ",(0,r.jsx)(n.code,{children:"Render"})," stage,\nthen update effects to real DOM when ",(0,r.jsx)(n.code,{children:"Commit"})," stage."]}),"\n",(0,r.jsxs)(n.p,{children:["\u5e38\u89c1\u7684 Effect ",(0,r.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberFlags.js",children:"\u6807\u5fd7\u4f4d"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"type Flags = number\n\nconst NoFlags = /*                      */ 0b000000000000000000\nconst PerformedWork = /*                */ 0b000000000000000001\nconst Placement = /*                    */ 0b000000000000000010\nconst Update = /*                       */ 0b000000000000000100\nconst PlacementAndUpdate = /*           */ 0b000000000000000110\nconst Deletion = /*                     */ 0b000000000000001000\nconst ContentReset = /*                 */ 0b000000000000010000\nconst Callback = /*                     */ 0b000000000000100000\nconst DidCapture = /*                   */ 0b000000000001000000\nconst Ref = /*                          */ 0b000000000010000000\nconst Snapshot = /*                     */ 0b000000000100000000\nconst Passive = /*                      */ 0b000000001000000000\nconst PassiveUnmountPendingDev = /*     */ 0b000010000000000000\nconst Hydrating = /*                    */ 0b000000010000000000\nconst HydratingAndUpdate = /*           */ 0b000000010000000100\nconst LifecycleEffectMask = /*          */ 0b000000001110100100\nconst HostEffectMask = /*               */ 0b000000011111111111\nconst Incomplete = /*                   */ 0b000000100000000000\nconst ShouldCapture = /*                */ 0b000001000000000000\nconst ForceUpdateForLegacySuspense = /* */ 0b000100000000000000\nconst PassiveStatic = /*                */ 0b001000000000000000\nconst BeforeMutationMask = /*           */ 0b000000001100001010\nconst MutationMask = /*                 */ 0b000000010010011110\nconst LayoutMask = /*                   */ 0b000000000010100100\nconst PassiveMask = /*                  */ 0b000000001000001000\nconst StaticMask = /*                   */ 0b001000000000000000\nconst MountLayoutDev = /*               */ 0b010000000000000000\nconst MountPassiveDev = /*              */ 0b100000000000000000\n"})}),"\n",(0,r.jsx)(n.h2,{id:"lanes",children:"Lanes"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsxs)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberWorkLoop.js",children:["Assign ",(0,r.jsx)(n.code,{children:"Lane"})," to ",(0,r.jsx)(n.code,{children:"Update"})]}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Legacy \u6a21\u5f0f: \u8fd4\u56de SyncLane."}),"\n",(0,r.jsx)(n.li,{children:"Blocking \u6a21\u5f0f: \u8fd4\u56de SyncLane."}),"\n",(0,r.jsxs)(n.li,{children:["Concurrent \u6a21\u5f0f:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u6b63\u5e38\u60c5\u51b5: \u6839\u636e\u5f53\u524d\u7684\u8c03\u5ea6\u4f18\u5148\u7ea7\u6765\u751f\u6210\u4e00\u4e2a lane."}),"\n",(0,r.jsxs)(n.li,{children:["\u5904\u4e8e Suspense \u8fc7\u7a0b\u4e2d: \u4f1a\u4f18\u5148\u9009\u62e9 ",(0,r.jsx)(n.code,{children:"TransitionLanes"})," \u901a\u9053\u4e2d\u7684\u7a7a\u95f2\u901a\u9053 (\u6216\u6700\u9ad8\u4f18\u5148\u7ea7)."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"export function requestUpdateLane(fiber: Fiber): Lane {\n  const mode = fiber.mode\n\n  if ((mode & BlockingMode) === NoMode) {\n    // Legacy \u6a21\u5f0f.\n    return SyncLane\n  } else if ((mode & ConcurrentMode) === NoMode) {\n    // Blocking \u6a21\u5f0f.\n    return getCurrentPriorityLevel() === ImmediateSchedulerPriority\n      ? SyncLane\n      : SyncBatchedLane\n  }\n\n  // Concurrent \u6a21\u5f0f.\n  if (currentEventWipLanes === NoLanes)\n    currentEventWipLanes = workInProgressRootIncludedLanes\n\n  const isTransition = requestCurrentTransition() !== NoTransition\n\n  if (isTransition) {\n    // \u7279\u6b8a\u60c5\u51b5, \u5904\u4e8e Suspense \u8fc7\u7a0b\u4e2d.\n    if (currentEventPendingLanes !== NoLanes) {\n      currentEventPendingLanes\n        = mostRecentlyUpdatedRoot !== null\n          ? mostRecentlyUpdatedRoot.pendingLanes\n          : NoLanes\n    }\n\n    return findTransitionLane(currentEventWipLanes, currentEventPendingLanes)\n  }\n\n  // \u6b63\u5e38\u60c5\u51b5, \u83b7\u53d6\u8c03\u5ea6\u4f18\u5148\u7ea7.\n  let lane\n  const schedulerPriority = getCurrentPriorityLevel()\n\n  if (\n    (executionContext & DiscreteEventContext) !== NoContext\n    && schedulerPriority === UserBlockingSchedulerPriority\n  ) {\n    // `executionContext` \u5b58\u5728\u8f93\u5165\u4e8b\u4ef6, \u4e14\u8c03\u5ea6\u4f18\u5148\u7ea7\u662f\u7528\u6237\u963b\u585e\u6027\u8d28.\n    lane = findUpdateLane(InputDiscreteLanePriority, currentEventWipLanes)\n  } else {\n    // \u8c03\u5ea6\u4f18\u5148\u7ea7\u8f6c\u6362\u4e3a\u8f66\u9053\u6a21\u578b.\n    const schedulerLanePriority\n      = schedulerPriorityToLanePriority(schedulerPriority)\n    lane = findUpdateLane(schedulerLanePriority, currentEventWipLanes)\n  }\n\n  return lane\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsxs)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberLane.js",children:["Global ",(0,r.jsx)(n.code,{children:"renderLanes"})]}),":"]}),"\n",(0,r.jsxs)(n.p,{children:["Fiber \u6811\u6784\u9020\u8fc7\u7a0b\u4e2d (",(0,r.jsx)(n.code,{children:"Render Phase"}),"),\n\u82e5 Fiber \u5bf9\u8c61\u6216 Update \u5bf9\u8c61\u4f18\u5148\u7ea7 (",(0,r.jsx)(n.code,{children:"fiber.lanes"}),"/",(0,r.jsx)(n.code,{children:"update.lane"}),") \u6bd4\u5168\u5c40\u6e32\u67d3\u4f18\u5148\u7ea7\u4f4e,\n\u5219\u5c06\u4f1a\u88ab\u5ffd\u7565 (\u8282\u70b9\u672a\u66f4\u65b0, \u53ef\u4ee5\u76f4\u63a5\u590d\u7528)."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"export function getNextLanes(root: FiberRoot, wipLanes: Lanes): Lanes {\n  const pendingLanes = root.pendingLanes\n\n  if (pendingLanes === NoLanes)\n    return NoLanes\n\n  let nextLanes = NoLanes\n  const suspendedLanes = root.suspendedLanes\n  const pingedLanes = root.pingedLanes\n  const nonIdlePendingLanes = pendingLanes & NonIdleLanes\n\n  if (nonIdlePendingLanes !== NoLanes) {\n    const nonIdleUnblockedLanes = nonIdlePendingLanes & ~suspendedLanes\n\n    if (nonIdleUnblockedLanes !== NoLanes) {\n      nextLanes = getHighestPriorityLanes(nonIdleUnblockedLanes)\n    } else {\n      const nonIdlePingedLanes = nonIdlePendingLanes & pingedLanes\n\n      if (nonIdlePingedLanes !== NoLanes)\n        nextLanes = getHighestPriorityLanes(nonIdlePingedLanes)\n    }\n  } else {\n    const unblockedLanes = pendingLanes & ~suspendedLanes\n\n    if (unblockedLanes !== NoLanes) {\n      nextLanes = getHighestPriorityLanes(unblockedLanes)\n    } else {\n      if (pingedLanes !== NoLanes)\n        nextLanes = getHighestPriorityLanes(pingedLanes)\n    }\n  }\n\n  if (nextLanes === NoLanes)\n    return NoLanes\n\n  if (\n    wipLanes !== NoLanes\n    && wipLanes !== nextLanes\n    && (wipLanes & suspendedLanes) === NoLanes\n  ) {\n    const nextLane = getHighestPriorityLane(nextLanes)\n    const wipLane = getHighestPriorityLane(wipLanes)\n\n    if (\n      nextLane >= wipLane\n      || (nextLane === DefaultLane && (wipLane & TransitionLanes) !== NoLanes)\n    ) {\n      return wipLanes\n    }\n  }\n\n  if (\n    allowConcurrentByDefault\n    && (root.current.mode & ConcurrentUpdatesByDefaultMode) !== NoMode\n  ) {\n    // Do nothing, use lanes as they were assigned.\n  } else if ((nextLanes & InputContinuousLane) !== NoLanes) {\n    nextLanes |= pendingLanes & DefaultLane\n  }\n\n  const entangledLanes = root.entangledLanes\n\n  if (entangledLanes !== NoLanes) {\n    const entanglements = root.entanglements\n    let lanes = nextLanes & entangledLanes\n\n    while (lanes > 0) {\n      const index = pickArbitraryLaneIndex(lanes)\n      const lane = 1 << index\n      nextLanes |= entanglements[index]\n      lanes &= ~lane\n    }\n  }\n\n  return nextLanes\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Lanes model ",(0,r.jsx)(n.a,{href:"https://github.com/facebook/react/pull/18796",children:"use case"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// task \u4e0e batchTask \u7684\u4f18\u5148\u7ea7\u662f\u5426\u91cd\u53e0:\n// 1. expirationTime:\nconst isTaskIncludedInBatch = priorityOfTask >= priorityOfBatch\n// 2. Lanes:\nconst isTaskIncludedInBatch = (task & batchOfTasks) !== 0\n\n// \u5f53\u540c\u65f6\u5904\u7406\u4e00\u7ec4\u4efb\u52a1, \u8be5\u7ec4\u5185\u6709\u591a\u4e2a\u4efb\u52a1, \u4e14\u6bcf\u4e2a\u4efb\u52a1\u7684\u4f18\u5148\u7ea7\u4e0d\u4e00\u81f4:\n// 1. expirationTime:\nconst isTaskIncludedInBatch\n  = taskPriority <= highestPriorityInRange\n    && taskPriority >= lowestPriorityInRange\n// 2. Lanes:\nconst isTaskIncludedInBatch = (task & batchOfTasks) !== 0\n\n// \u4ece group \u4e2d\u589e\u5220 task:\n// 1. expirationTime (need list):\ntask.prev.next = task.next\n\nlet current = queue\nwhile (task.expirationTime >= current.expirationTime)\n  current = current.next\n\ntask.next = current.next\ncurrent.next = task\n\nconst isTaskIncludedInBatch\n  = taskPriority <= highestPriorityInRange\n    && taskPriority >= lowestPriorityInRange\n\n// 2. Lanes:\nbatchOfTasks &= ~task // Delete task.\nbatchOfTasks |= task // Add task.\nconst isTaskIncludedInBatch = (task & batchOfTasks) !== 0\n"})}),"\n",(0,r.jsx)(n.h2,{id:"trees",children:"Trees"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"current"})," Fiber tree: rendered to screen."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"workInProgress"})," Fiber tree: under reconciliation."]}),"\n",(0,r.jsxs)(n.li,{children:["When ",(0,r.jsx)(n.code,{children:"workInProgress"})," Fiber tree complete ",(0,r.jsx)(n.code,{children:"render"})," + ",(0,r.jsx)(n.code,{children:"commit"}),",\nswap 2 Fiber tree:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Reuse Fiber objects."}),"\n",(0,r.jsx)(n.li,{children:"Reduce memory usage and GC time."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"FiberRoot"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"FiberRoot.current = currentHostRootFiber"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"FiberRoot.finishedWork = workInProgressHostRootFiber"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"currentHostRootFiber.stateNode = FiberRoot"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"workInProgressHostRootFiber.stateNode = FiberRoot"}),"."]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"currentHostRootFiber.alternate = workInProgressHostRootFiber"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"workInProgressHostRootFiber.alternate = currentHostRootFiber"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ReactElement"})," tree -> ",(0,r.jsx)(n.code,{children:"Fiber"})," tree -> ",(0,r.jsx)(n.code,{children:"DOM"})," tree."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://7kms.github.io/react-illustration-series/main/fibertree-prepare",children:(0,r.jsx)(n.img,{alt:"React Fiber Trees",src:t(40049).A+"",width:"1325",height:"899"})})}),"\n",(0,r.jsx)(n.h2,{id:"work-loop",children:"Work Loop"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://7kms.github.io/react-illustration-series/main/reconciler-workflow",children:(0,r.jsx)(n.img,{alt:"React Fiber Work Loop",src:t(75216).A+"",width:"921",height:"638"})})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},40049:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/react-fiber-trees-c1b57b3b1ce1239d058a44a8d33f0ab4.png"},75216:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/react-fiber-work-loop-59263ed5fab0b0ece74a9201cde6ccee.png"},86145:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var s=t(57140);const r={},i=s.createContext(r);function o(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);