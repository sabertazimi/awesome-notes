"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[30802],{62408:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>d,frontMatter:()=>c,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"web/react/hooks/utility","title":"Utility","description":"useImperativeHandle","source":"@site/content/web/react/hooks/utility.md","sourceDirName":"web/react/hooks","slug":"/web/react/hooks/utility","permalink":"/notes/web/react/hooks/utility","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/react/hooks/utility.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"React","permalink":"/notes/tags/react"},{"inline":true,"label":"Hook","permalink":"/notes/tags/hook"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":10,"frontMatter":{"sidebar_position":10,"tags":["Web","React","Hook"]},"sidebar":"tutorialSidebar","previous":{"title":"Servers","permalink":"/notes/web/react/hooks/servers"},"next":{"title":"Lifecycle","permalink":"/notes/web/react/hooks/lifecycle"}}');var o=t(35656),s=t(86145);const c={sidebar_position:10,tags:["Web","React","Hook"]},i="Utility",a={},l=[{value:"useImperativeHandle",id:"useimperativehandle",level:2},{value:"useDebugValue",id:"usedebugvalue",level:2},{value:"useId",id:"useid",level:2},{value:"useEvent",id:"useevent",level:2}];function u(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"utility",children:"Utility"})}),"\n",(0,o.jsx)(n.h2,{id:"useimperativehandle",children:"useImperativeHandle"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:"interface MyInputHandles {\n  focus: () => void\n}\n\nconst MyInput: RefForwardingComponent<MyInputHandles, MyInputProps> = (\n  props,\n  ref\n) => {\n  const inputRef = useRef<HTMLInputElement>(null)\n\n  useImperativeHandle(ref, () => ({\n    focus: () => {\n      if (inputRef.current)\n        inputRef.current.focus()\n    },\n  }))\n\n  return <input {...props} ref={inputRef} />\n}\n\nconst ForwardMyInput = React.forwardReft(MyInput)\nexport default ForwardMyInput\n"})}),"\n",(0,o.jsx)(n.h2,{id:"usedebugvalue",children:"useDebugValue"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"function App() {\n  const date = new Date()\n  useDebugValue(date, date => date.toISOString())\n}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"useid",children:"useId"}),"\n",(0,o.jsx)(n.p,{children:"Generating unique IDs on client and server\n(\u6bcf\u4e2a ID \u4ee3\u8868\u8be5\u7ec4\u4ef6\u5728\u7ec4\u4ef6\u6811\u4e2d\u7684\u5c42\u7ea7\u7ed3\u6784):"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:'export default function Checkbox() {\n  const id = useId()\n\n  return (\n    <>\n      <label htmlFor={id}>Do you like React?</label>\n      <input type="checkbox" name="react" id={id} />\n    </>\n  )\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"useevent",children:"useEvent"}),"\n",(0,o.jsxs)(n.p,{children:["Extracting non-reactive logic out of ",(0,o.jsx)(n.code,{children:"useEffect"}),",\n",(0,o.jsxs)(n.a,{href:"https://react.dev/learn/separating-events-from-effects",children:["put them into ",(0,o.jsx)(n.code,{children:"useEvent"})]}),",\ncall ",(0,o.jsx)(n.code,{children:"useEvent"})," from inside ",(0,o.jsx)(n.code,{children:"useEffect"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["Event functions let you split an ",(0,o.jsx)(n.code,{children:"Effect"}),'\ninto reactive parts (which should "react" to reactive values and their changes)\nand non-reactive parts (which only read their latest values):']}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"import { useCallback, useEffect, useInsertionEffect, useRef } from 'react'\n\nfunction useEvent(fn) {\n  const ref = useRef(null)\n  useInsertionEffect(() => {\n    ref.current = fn\n  }, [fn])\n  return useCallback((...args) => {\n    const f = ref.current // Get latest snapshot, break out closure.\n    return f(...args)\n  }, [])\n}\n\nfunction ChatRoom({ roomId, theme }) {\n  const onConnected = useEvent((connectedRoomId) => {\n    // Non-reactive to `theme`.\n    showNotification(`Welcome to ${connectedRoomId}`, theme)\n  })\n\n  useEffect(() => {\n    const connection = createConnection(serverUrl, roomId)\n    connection.on('connected', () => {\n      onConnected(roomId)\n    })\n    connection.connect()\n    return () => connection.disconnect()\n  }, [roomId, onConnected]) // Linter will allow [roomId] in the future.\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Reusable ",(0,o.jsx)(n.a,{href:"https://jser.dev/react/2022/02/18/reusable-behavior-hooks-through-ref",children:"behavior hooks"}),"\nthrough ref:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:"function useEvent(event, handler, option = {}) {\n  const refPrev = useRef()\n  const attach = useCallback(\n    (el) => {\n      el.addEventListener(event, handler, option)\n      refPrev.current = el\n    },\n    [handler]\n  )\n  const detach = useCallback(\n    (el) => {\n      refPrev.current.removeEventListener(event, handler)\n      refPrev.current = null\n    },\n    [handler]\n  )\n  const ref = (el) => {\n    if (el === null) {\n      detach()\n    } else {\n      attach(el)\n    }\n  }\n  return ref\n}\n\nfunction App() {\n  const onScroll = () => {}\n  const onClick = () => {}\n  const refScroll = useEvent('scroll', onScroll, ({ onScroll }))\n  const refClick = useEvent('click', onClick)\n  const mergedRefs = mergeRefs(refScroll, refClick)\n  return (<div ref={mergedRefs}>some content</div>)\n}\n"})})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}},86145:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>i});var r=t(57140);const o={},s=r.createContext(o);function c(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:c(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);