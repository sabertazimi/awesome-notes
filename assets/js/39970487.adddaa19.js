"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[44388],{57666:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>d,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"cs/os/device-io","title":"Device I/O","description":"\u8bbe\u5907\u7ba1\u7406","source":"@site/content/cs/os/device-io.md","sourceDirName":"cs/os","slug":"/cs/os/device-io","permalink":"/notes/cs/os/device-io","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/cs/os/device-io.md","tags":[{"inline":true,"label":"CS","permalink":"/notes/tags/cs"},{"inline":true,"label":"System","permalink":"/notes/tags/system"},{"inline":true,"label":"OS","permalink":"/notes/tags/os"},{"inline":true,"label":"Device","permalink":"/notes/tags/device"},{"inline":true,"label":"I/O","permalink":"/notes/tags/i-o"},{"inline":true,"label":"Network","permalink":"/notes/tags/network"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":8,"frontMatter":{"sidebar_position":8,"tags":["CS","System","OS","Device","I/O","Network"]},"sidebar":"tutorialSidebar","previous":{"title":"Memory","permalink":"/notes/cs/os/memory"},"next":{"title":"Filesystem","permalink":"/notes/cs/os/filesystem"}}');var r=i(35656),s=i(86145);const d={sidebar_position:8,tags:["CS","System","OS","Device","I/O","Network"]},o="Device I/O",l={},a=[{value:"\u8bbe\u5907\u7ba1\u7406",id:"\u8bbe\u5907\u7ba1\u7406",level:2},{value:"CGA EGA and ChromaText Video Buffer",id:"cga-ega-and-chromatext-video-buffer",level:3},{value:"Input and Output",id:"input-and-output",level:3},{value:"\u7cfb\u7edf\u7ea7 I/O",id:"\u7cfb\u7edf\u7ea7-io",level:2},{value:"socket I/O",id:"socket-io",level:2},{value:"\u9650\u5236",id:"\u9650\u5236",level:3},{value:"I/O \u51fd\u6570\u7684\u9009\u62e9",id:"io-\u51fd\u6570\u7684\u9009\u62e9",level:3},{value:"Zero Copy",id:"zero-copy",level:2},{value:"Network",id:"network",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"device-io",children:"Device I/O"})}),"\n",(0,r.jsx)(n.h2,{id:"\u8bbe\u5907\u7ba1\u7406",children:"\u8bbe\u5907\u7ba1\u7406"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"CPU \u4e00\u822c\u90fd\u662f\u901a\u8fc7\u5bc4\u5b58\u5668\u7684\u5f62\u5f0f\u6765\u8bbf\u95ee\u5916\u90e8\u8bbe\u5907"}),"\n",(0,r.jsx)(n.li,{children:"\u5916\u8bbe\u7684\u5bc4\u5b58\u5668\u901a\u5e38\u5305\u62ec\u63a7\u5236\u5bc4\u5b58\u5668\u3001\u72b6\u6001\u5bc4\u5b58\u5668\u4e0e\u6570\u636e\u5bc4\u5b58\u5668\u4e09\u7c7b, \u5206\u522b\u7528\u4e8e\u53d1\u9001\u547d\u4ee4/\u8bfb\u53d6\u72b6\u6001/\u8bfb\u5199\u6570\u636e."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"cga-ega-and-chromatext-video-buffer",children:"CGA EGA and ChromaText Video Buffer"}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u5185\u5b58\u7684\u4f4e 1MB \u4e2d, \u6709\u8bb8\u591a\u5730\u5740\u88ab\u6620\u5c04\u81f3\u5916\u90e8\u8bbe\u5907, \u5176\u4e2d\u5c31\u5305\u542b\u6587\u5b57\u663e\u793a\u6a21\u5757(\u663e\u5361\u63a7\u5236\u663e\u793a\u5668):"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4ece 0xB8000 \u5f00\u59cb, \u6bcf 2 \u4e2a\u5b57\u8282\u8868\u793a\u5c4f\u5e55\u4e0a\u663e\u793a\u7684\u4e00\u4e2a\u5b57\u7b26(80 x 25)"}),"\n",(0,r.jsx)(n.li,{children:"\u524d\u4e00\u4e2a\u5b57\u8282\u4e3a \u5b57\u7b26 ASCII \u7801, \u540e\u4e00\u4e2a\u5b57\u8282\u4e3a\n\u5b57\u7b26\u989c\u8272\u548c\u5c5e\u6027\u7684\u63a7\u5236\u4fe1\u606f\n(back_twinkle, back_r, back_g, back_b, front_light, front_r, front_g, front_b)"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"input-and-output",children:"Input and Output"}),"\n",(0,r.jsxs)(n.p,{children:["\u8c03\u7528 ",(0,r.jsx)(n.code,{children:"io_delay()"})," \u51fd\u6570: \u5bf9\u4e8e\u4e00\u4e9b\u8001\u5f0f\u603b\u7ebf\u7684\u5916\u90e8\u8bbe\u5907, \u8bfb\u5199 I/O \u7aef\u53e3\u7684\u901f\u5ea6\u82e5\u8fc7\u5feb\u5c31\u5bb9\u6613\u51fa\u73b0\u4e22\u5931\u6570\u636e\u7684\u73b0\u8c61"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"I/O Model",src:i(22722).A+"",title:"I/O Model",width:"761",height:"427"})}),"\n",(0,r.jsx)(n.h2,{id:"\u7cfb\u7edf\u7ea7-io",children:"\u7cfb\u7edf\u7ea7 I/O"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"// robust I/O\nssize_t rio_read_n(int fd, void *usr_buf, size_t n) {\n    size_t n_left = n;\n    ssize_t n_read;\n    char *buf_p = usr_buf;\n\n    while (n_left > 0) {\n        if ((n_read = read(fd, buf_p, n_left)) < 0) {\n            if (errno == EINTR) {\n                n_read = 0; // interrupted by signal_handler, re-call read()\n            } else {\n                return -1;\n            }\n        } else if (n_read == 0) {\n            break;\n        }\n\n        n_left -= n_read;\n        buf_p += n_read; // remove data from buf_p\n    }\n\n    return (n - n_left);\n}\n\nssize_t rio_write_n(int fd, void *usr_buf, size_t n) {\n    size_t n_left = n;\n    ssize_t n_written;\n    char *buf_p = usr_buf;\n\n    while (n_left > 0) {\n        if ((n_written = read(fd, buf_p, n_left)) < 0) {\n            if (errno == EINTR) {\n                n_written = 0; // interrupted by signal_handler, re-call read()\n            } else {\n                return -1;\n            }\n        }\n\n        n_left -= n_written;\n        buf_p += n_written; // remove data from buf_p\n    }\n\n    return n;\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"socket-io",children:"socket I/O"}),"\n",(0,r.jsx)(n.h3,{id:"\u9650\u5236",children:"\u9650\u5236"}),"\n",(0,r.jsx)(n.p,{children:"\u8f93\u51fa\u51fd\u6570+\u8f93\u5165\u51fd\u6570: \u4e2d\u95f4\u5fc5\u987b\u63d2\u5165 fflush, fseek, fsetpos, rewind\n\u8f93\u5165\u51fd\u6570+\u8f93\u51fa\u51fd\u6570: \u4e2d\u95f4\u5fc5\u987b\u63d2\u5165 fseek, fsetpos, rewind"}),"\n",(0,r.jsx)(n.h3,{id:"io-\u51fd\u6570\u7684\u9009\u62e9",children:"I/O \u51fd\u6570\u7684\u9009\u62e9"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"sprintf+rio_written: \u683c\u5f0f\u5316\u8f93\u51fa\u81f3\u5957\u63a5\u53e3"}),"\n",(0,r.jsx)(n.li,{children:"rio_readlineb + sscanf: \u683c\u5f0f\u5316\u8f93\u5165"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"zero-copy",children:"Zero Copy"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"read()"}),": 2 \u6b21\u72b6\u6001\u5207\u6362, 1 \u6b21 CPU Copy, 1 \u6b21 DMA Copy.\n",(0,r.jsx)(n.code,{children:"write()"}),": 2 \u6b21\u72b6\u6001\u5207\u6362, 1 \u6b21 CPU Copy, 1 \u6b21 DMA Copy."]}),"\n",(0,r.jsx)(n.p,{children:"\u603b\u8ba1 4 \u6b21\u72b6\u6001\u5207\u6362, 2 \u6b21 CPU Copy, 2 \u6b21 DMA Copy.\n\u6d89\u53ca\u591a\u6b21\u7a7a\u95f4\u5207\u6362\u548c\u6570\u636e\u5197\u4f59\u62f7\u8d1d, \u6548\u7387\u4f4e\u4e0b\uff0c\u53ef\u4f7f\u7528\u96f6\u62f7\u8d1d\u6280\u672f\u8fdb\u884c\u4f18\u5316:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"mmap"})," + ",(0,r.jsx)(n.code,{children:"write"}),": 4 \u6b21\u72b6\u6001\u5207\u6362, 1 \u6b21 CPU Copy, 2 \u6b21 DMA Copy."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"sendfile"}),": 2 \u6b21\u72b6\u6001\u5207\u6362, 1 \u6b21 CPU Copy, 2 \u6b21 DMA Copy."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"sendfile"})," + ",(0,r.jsx)(n.code,{children:"DMA \u6536\u96c6"}),": 2 \u6b21\u72b6\u6001\u5207\u6362, 0 \u6b21 CPU Copy, 2 \u6b21 DMA Copy (\u53ea\u53ef\u8bfb)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"splice"}),": 2 \u6b21\u72b6\u6001\u5207\u6362, 0 \u6b21 CPU Copy, 2 \u6b21 DMA Copy (\u53ea\u53ef\u7ba1\u9053)."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"network",children:"Network"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:'#include <netinet/in.h>\n#include <arpa/inet.h>\n#include <netdb.h>\n\nint main(int argc, char *argv) {\n    char **pp;\n    struct in_addr addr;\n    struct hostent *host_p;\n\n    if (argc != 2) {\n        fprintf(stderr, "usage: %s <domain name or dotted-decimal>\\n", argv[0]);\n        exit(0);\n    }\n\n    if (inet_aton(argv[1], &addr) != 0) {\n        host_p = gethostbyaddr((const char*)&addr, sizeof(addr), AF_INET);\n    } else {\n        host_p = gethostbyname(argv[1]);\n    }\n\n    printf("official hostname: %s\\n:", host_p->h_name);\n\n    for (pp = host_p->h_aliases; *pp != NULL; pp++) {\n        printf("alias: %s\\n", *pp);\n    }\n\n    for (pp = host_p->h_addr_list; *pp != NULL; pp++) {\n        addr.s_addr = ((struct in_addr *)*pp)->s_addr;\n        printf("address: %s\\n", inet_ntoa(addr));\n    }\n\n    exit(0);\n}\n'})})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},22722:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/io-model-044fd75adf7a5668e38b6f1364db8cad.png"},86145:(e,n,i)=>{i.d(n,{R:()=>d,x:()=>o});var t=i(57140);const r={},s=t.createContext(r);function d(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);