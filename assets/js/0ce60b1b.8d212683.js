"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[67542],{75217:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>m,frontMatter:()=>o,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"web/react/hooks/servers","title":"Servers","description":"useOptimistic","source":"@site/content/web/react/hooks/servers.md","sourceDirName":"web/react/hooks","slug":"/web/react/hooks/servers","permalink":"/notes/web/react/hooks/servers","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/react/hooks/servers.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"React","permalink":"/notes/tags/react"},{"inline":true,"label":"Hook","permalink":"/notes/tags/hook"},{"inline":true,"label":"Server","permalink":"/notes/tags/server"},{"inline":true,"label":"Form","permalink":"/notes/tags/form"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":9,"frontMatter":{"sidebar_position":9,"tags":["Web","React","Hook","Server","Form"]},"sidebar":"tutorialSidebar","previous":{"title":"Concurrent","permalink":"/notes/web/react/hooks/concurrent"},"next":{"title":"Utility","permalink":"/notes/web/react/hooks/utility"}}');var i=t(35656),a=t(86145);const o={sidebar_position:9,tags:["Web","React","Hook","Server","Form"]},r="Servers",c={},l=[{value:"useOptimistic",id:"useoptimistic",level:2},{value:"useActionState",id:"useactionstate",level:2},{value:"useFormStatus",id:"useformstatus",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"servers",children:"Servers"})}),"\n",(0,i.jsx)(n.h2,{id:"useoptimistic",children:"useOptimistic"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://jser.dev/2024-03-20-how-does-useoptimisticwork-internally-in-react#42-updateoptimistic",children:(0,i.jsx)(n.code,{children:"updateOptimistic()"})}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["An optimistic update has ",(0,i.jsx)(n.code,{children:"revertLane"})," of ",(0,i.jsx)(n.code,{children:"TransitionLaneXX"})," and ",(0,i.jsx)(n.code,{children:"lane"})," of ",(0,i.jsx)(n.code,{children:"SyncLane"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Update is processed in ",(0,i.jsx)(n.code,{children:"SyncLane"})," and also in all following renders,\nbut it is NOT skipped and always kept in the next update queue."]}),"\n",(0,i.jsxs)(n.li,{children:["Update is reverted in ",(0,i.jsx)(n.code,{children:"revertLane"})," (low priority transition lane),\nby NOT getting added to the next queue.\nBut if the async action on the transition lane is not yet complete,\nit suspends by throwing the promise.\nThe revert will be tried again after the async action is done."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:'function useOptimistic(state, optimisticDispatcher) {\n  const [optimisticState, setState] = useState(state)\n\n  useLayoutEffect(() => {\n    setState(optimisticState)\n  }, [state])\n\n  const dispatch = (action) => {\n    setState(state => optimisticDispatcher(state, action))\n  }\n\n  return [\n    optimisticState,\n    dispatch\n  ]\n}\n\nfunction Thread({ messages, sendMessage }) {\n  const formRef = useRef()\n\n  async function formAction(formData) {\n    addOptimisticMessage(formData.get(\'message\'))\n    formRef.current.reset()\n    await sendMessage(formData)\n  }\n\n  const [optimisticMessages, addOptimisticMessage] = useOptimistic(\n    messages,\n    (state, newMessage) => [\n      ...state,\n      {\n        text: newMessage,\n        sending: true\n      }\n    ]\n  )\n\n  return (\n    <>\n      {optimisticMessages.map((message, index) => (\n        <div key={message.id}>\n          {message.text}\n          {!!message.sending && <small> (Sending...)</small>}\n        </div>\n      ))}\n      <form action={formAction} ref={formRef}>\n        <input type="text" name="message" placeholder="Hello!" />\n        <button type="submit">Send</button>\n      </form>\n    </>\n  )\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"useactionstate",children:"useActionState"}),"\n",(0,i.jsx)(n.p,{children:"Form loading state:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"import { useActionState } from 'react'\n\nexport default function App() {\n  const sendMessage = async (_actionState: null, formData: FormData) => {\n    const message = formData.get('message')\n\n    console.log(message)\n\n    // Artificial delay to simulate async operation\n    await new Promise(resolve => setTimeout(resolve, 2000))\n\n    // TODO: do call (e.g. API call) to send the message\n\n    return null\n  }\n\n  const [_actionState, action, isPending] = useActionState(sendMessage, null)\n\n  return (\n    <form action={action}>\n      <label htmlFor=\"message\">Message:</label>\n      <input name=\"message\" id=\"message\" />\n\n      <button type=\"submit\" disabled={isPending}>\n        {isPending ? 'Sending ...' : 'Send'}\n      </button>\n    </form>\n  )\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"useformstatus",children:"useFormStatus"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"import { useFormStatus } from 'react-dom'\n\nfunction SubmitButton() {\n  const { pending } = useFormStatus()\n\n  return (\n    <button type=\"submit\" disabled={pending}>\n      {pending ? 'Sending ...' : 'Send'}\n    </button>\n  )\n}\n\nexport default function App() {\n  const sendMessage = async (formData: FormData) => {\n    const message = formData.get('message')\n\n    console.log(message)\n\n    // Artificial delay to simulate async operation\n    await new Promise(resolve => setTimeout(resolve, 2000))\n\n    // TODO: do call (e.g. API call) to send the message\n  }\n\n  return (\n    <form action={sendMessage}>\n      <label htmlFor=\"message\">Message:</label>\n      <input name=\"message\" id=\"message\" />\n\n      <SubmitButton />\n    </form>\n  )\n}\n"})})]})}function m(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},86145:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>r});var s=t(57140);const i={},a=s.createContext(i);function o(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);