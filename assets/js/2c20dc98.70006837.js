"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[14852],{5556:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"web/javascript/canvas","title":"Canvas","description":"- Path2D \u5bf9\u8c61.","source":"@site/content/web/javascript/canvas.md","sourceDirName":"web/javascript","slug":"/web/javascript/canvas","permalink":"/notes/web/javascript/canvas","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/javascript/canvas.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"JavaScript","permalink":"/notes/tags/java-script"},{"inline":true,"label":"ECMAScript","permalink":"/notes/tags/ecma-script"},{"inline":true,"label":"Canvas","permalink":"/notes/tags/canvas"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":54,"frontMatter":{"sidebar_position":54,"tags":["Web","JavaScript","ECMAScript","Canvas"]},"sidebar":"tutorialSidebar","previous":{"title":"Animations","permalink":"/notes/web/javascript/animation"},"next":{"title":"Media","permalink":"/notes/web/javascript/media"}}');var a=t(35656),r=t(86145);const c={sidebar_position:54,tags:["Web","JavaScript","ECMAScript","Canvas"]},o="Canvas",i={},l=[{value:"Game Loop",id:"game-loop",level:2},{value:"Performance",id:"performance",level:2},{value:"Houdini",id:"houdini",level:2},{value:"References",id:"references",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"canvas",children:"Canvas"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Path2D \u5bf9\u8c61."}),"\n",(0,a.jsxs)(n.li,{children:["\u7ed8\u5236\u8def\u5f84: ",(0,a.jsx)(n.code,{children:"beginPath()"})," -> ",(0,a.jsx)(n.code,{children:"draw()"})," -> ",(0,a.jsx)(n.code,{children:"closePath()"}),"."]}),"\n",(0,a.jsx)(n.li,{children:"\u7ed8\u5236\u6837\u5f0f: \u989c\u8272/\u6e10\u53d8/\u53d8\u6362/\u9634\u5f71."}),"\n",(0,a.jsxs)(n.li,{children:["\u7ed8\u5236\u56fe\u5f62: ",(0,a.jsx)(n.code,{children:"fill"}),"/",(0,a.jsx)(n.code,{children:"stroke"}),"/",(0,a.jsx)(n.code,{children:"clip"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:["\u7ed8\u5236\u6587\u5b57: ",(0,a.jsx)(n.code,{children:"font"}),"/",(0,a.jsx)(n.code,{children:"fillText()"}),"/",(0,a.jsx)(n.code,{children:"measureText()"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"const context = canvas.getContext('2d')\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"// \u6839\u636e\u53c2\u6570\u753b\u7ebf\nfunction drawLine(fromX, fromY, toX, toY) {\n  context.moveTo(fromX, fromY)\n  context.lineTo(toX, toY)\n  context.stroke()\n}\n\n// \u6839\u636e\u53c2\u6570\u753b\u5706\nfunction drawCircle(x, y, radius, color) {\n  context.fillStyle = color\n  context.beginPath()\n  context.arc(x, y, radius, 0, Math.PI * 2, true)\n  context.closePath()\n  context.fill()\n  context.stroke()\n}\n\n// \u6539\u53d8 canvas \u4e2d\u56fe\u5f62\u989c\u8272\nfunction changeColor(color) {\n  context.fillStyle = color\n  context.fill()\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://eloquentjavascript.net/17_canvas.html",children:"Recursive tree"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-html",children:"<canvas width=\"600\" height=\"300\"></canvas>\n<script>\n  const cx = document.querySelector('canvas').getContext('2d')\n\n  function branch(length, angle, scale) {\n    cx.fillRect(0, 0, 1, length)\n    if (length < 8) return\n    cx.save()\n    cx.translate(0, length)\n    cx.rotate(-angle)\n    branch(length * scale, angle, scale)\n    cx.rotate(2 * angle)\n    branch(length * scale, angle, scale)\n    cx.restore()\n  }\n\n  cx.translate(300, 0)\n  branch(60, 0.5, 0.8)\n<\/script>\n"})}),"\n",(0,a.jsx)(n.h2,{id:"game-loop",children:"Game Loop"}),"\n",(0,a.jsx)(n.p,{children:"For all objects:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["constructor: ",(0,a.jsx)(n.code,{children:"position{x, y}"}),", ",(0,a.jsx)(n.code,{children:"speed{x, y}"}),", ",(0,a.jsx)(n.code,{children:"size{x, y}"})]}),"\n",(0,a.jsx)(n.li,{children:"update(deltaTime): change position or speed"}),"\n",(0,a.jsx)(n.li,{children:"draw(ctx): use canvas api and object properties (position/size) to render objects"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"const canvas = document.getElementById('gameScreen')\nconst ctx = canvas.getContext('2d')\n\nconst GAME_WIDTH = 800\nconst GAME_HEIGHT = 600\n\nconst game = new Game(GAME_WIDTH, GAME_HEIGHT)\n\nlet lastTime = 0\n\nfunction gameLoop(timestamp) {\n  const deltaTime = timestamp - lastTime\n  lastTime = timestamp\n\n  ctx.clearRect(0, 0, GAME_WIDTH, GAME_HEIGHT)\n\n  game.update(deltaTime)\n  game.draw(ctx)\n\n  requestAnimationFrame(gameLoop)\n}\n\nrequestAnimationFrame(gameLoop)\n"})}),"\n",(0,a.jsx)(n.h2,{id:"performance",children:"Performance"}),"\n",(0,a.jsx)(n.p,{children:"Canvas buffer:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"frontCanvasContext.drawImage(bufferCanvas, 0, 0)\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"multiple canvas: top layer, background layer, interactive layer"}),"\n",(0,a.jsx)(n.li,{children:"disable alpha path"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"const ctx = canvas.getContext('2d', { alpha: false })\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://dbushell.com/2024/04/02/offscreen-canvas-and-web-workers",children:"Offscreen canvas and web workers"}),":"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"transferControlToOffscreen"})," method:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"// index.js\nconst offscreenCanvas = document.querySelector('#frame2')\nconst offscreen = offscreenCanvas.transferControlToOffscreen()\nconst worker = new Worker('./worker.js')\nworker.postMessage({ canvas: offscreen }, [offscreen])\n\n// worker.js\nonmessage = function (event) {\n  canvas = event.data.canvas\n  context = canvas.getContext('2d')\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"OffscreenCanvas"})," in service workers:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"// Create reusable canvas\nconst offscreen = new OffscreenCanvas(512, 512)\nconst context = offscreen.getContext('2d')\n\n// eslint-disable-next-line no-restricted-globals -- Service worker.\nself.addEventListener('fetch', (ev) => {\n  // Only handle image requests\n  const url = new URL(ev.request.url)\n\n  if (url.pathname.startsWith('/artwork/'))\n    ev.respondWith(artwork(ev))\n})\n\nasync function artwork(ev) {\n  const cache = await caches.open('artwork')\n\n  // 1. Return from cache\n  let response = await cache.match(ev.request)\n  if (response)\n    return response\n\n  // 2. Or fetch from network\n  response = await fetch(ev.request)\n  if (!response.ok || response.status !== 200)\n    return response\n\n  // 3. Use canvas to resize\n  let blob = await response.blob()\n  context.drawImage(await createImageBitmap(blob), 0, 0, 512, 512)\n  blob = await offscreen.convertToBlob({ type: 'image/png' })\n\n  // 4. Create new headers\n  const headers = new Headers(response.headers)\n  headers.set('content-type', blob.type)\n  headers.set('content-length', blob.size)\n\n  // 5. Create new response\n  const { status, statusText } = response\n  response = new Response(await blob.arrayBuffer(), {\n    status,\n    statusText,\n    headers\n  })\n  await cache.put(ev.request, response.clone())\n  return response\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"houdini",children:"Houdini"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/API/PaintWorklet",children:(0,a.jsx)(n.code,{children:"PaintWorklet"})}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"// checkerboard.js:\n// Create a `PaintWorklet`.\nclass CheckerboardPainter {\n  static get contextOptions() {\n    return { alpha: true }\n  }\n\n  /**\n   * @returns {string[]} any custom properties or regular properties\n   */\n  static get inputProperties() {\n    return ['--red', '--green', '--blue', '--width', 'height']\n  }\n\n  paint(context, geometry, props) {\n    const colors = [\n      props.get('--red').toString(),\n      props.get('--green').toString(),\n      props.get('--blue').toString(),\n    ]\n    const size = Number.parseInt(props.get('--width'))\n\n    for (let y = 0; y < geometry.height / size; y++) {\n      for (let x = 0; x < geometry.width / size; x++) {\n        const color = colors[(x + y) % colors.length]\n        context.beginPath()\n        context.fillStyle = color\n        context.rect(x * size, y * size, size, size)\n        context.fill()\n      }\n    }\n  }\n}\n\n// Register our class under a specific name\nregisterPaint('checkerboard', CheckerboardPainter)\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-html",children:"\x3c!-- Load a `PaintWorklet`. --\x3e\n<script>\n  if ('paintWorklet' in CSS) {\n    CSS.paintWorklet.addModule('checkerboard.js')\n  }\n<\/script>\n\n\x3c!-- Use a `PaintWorklet`. --\x3e\n<style>\n  textarea {\n    background-image: paint(checkerboard);\n  }\n</style>\n<textarea></textarea>\n"})}),"\n",(0,a.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/API/Canvas_API",children:"Canvas API"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/API/Canvas_API/Tutorial",children:"Canvas Tutorial"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://joshondesign.com/p/books/canvasdeepdive/toc.html",children:"Canvas Deep Dive"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://devhints.io/canvas",children:"Canvas Cheat Sheet"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/API/Canvas_API/Tutorial/Optimizing_canvas",children:"Canvas Performance"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://zhuanlan.zhihu.com/p/438142235",children:"Canvas Real World Case"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},86145:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>o});var s=t(57140);const a={},r=s.createContext(a);function c(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:c(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);