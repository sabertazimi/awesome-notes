"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[73621],{10904:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>d,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"web/react/redux/core","title":"Core","description":"Concepts","source":"@site/content/web/react/redux/core.md","sourceDirName":"web/react/redux","slug":"/web/react/redux/core","permalink":"/notes/web/react/redux/core","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/react/redux/core.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"React","permalink":"/notes/tags/react"},{"inline":true,"label":"Redux","permalink":"/notes/tags/redux"},{"inline":true,"label":"State Management","permalink":"/notes/tags/state-management"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":1,"frontMatter":{"sidebar_position":1,"tags":["Web","React","Redux","State Management"]},"sidebar":"tutorialSidebar","previous":{"title":"Redux","permalink":"/notes/web/react/redux/"},"next":{"title":"Toolkit","permalink":"/notes/web/react/redux/toolkit"}}');var s=n(35656),o=n(86145);const a={sidebar_position:1,tags:["Web","React","Redux","State Management"]},i="Core",d={},c=[{value:"Concepts",id:"concepts",level:2},{value:"Store",id:"store",level:2},{value:"Creation",id:"creation",level:3},{value:"Configuration",id:"configuration",level:3},{value:"State",id:"state",level:2},{value:"Persistence",id:"persistence",level:3},{value:"Normalization",id:"normalization",level:3},{value:"Entity Adapter",id:"entity-adapter",level:3}];function l(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"core",children:"Core"})}),"\n",(0,s.jsx)(r.h2,{id:"concepts",children:"Concepts"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"\u5355\u4e00\u6570\u636e\u6e90: \u6574\u4e2a\u5e94\u7528\u7a0b\u5e8f\u7684\u72b6\u6001\u5b58\u50a8\u5728\u5355\u4e2a\u5bf9\u8c61\u6811\u4e2d (\u5bb9\u6613\u8ddf\u8e2a/\u8c03\u8bd5)"}),"\n",(0,s.jsx)(r.li,{children:"\u72b6\u6001\u53ea\u8bfb: \u901a\u8fc7 dispatch(action) \u95f4\u63a5\u66f4\u6539\u72b6\u6001, \u4e0d\u76f4\u63a5\u5199\u5165\u72b6\u6001"}),"\n",(0,s.jsx)(r.li,{children:"\u7eaf\u51fd\u6570\u66f4\u6539\u72b6\u6001: reducer(state, action) => newState"}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"store",children:"Store"}),"\n",(0,s.jsx)(r.p,{children:"Redux \u4e2d\u53ea\u6709\u4e00\u4e2a\u5168\u5c40\u552f\u4e00 store \u72b6\u6001\u6811, \u4e14\u7531 reducers \u521b\u5efa store."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:"export default appStore = createStore(rootReducers, initState)\n"})}),"\n",(0,s.jsx)(r.h3,{id:"creation",children:"Creation"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:"import { applyMiddleware, createStore } from 'redux'\r\nimport { composeWithDevTools } from 'redux-devtools-extension'\r\nimport thunkMiddleware from 'redux-thunk'\r\n\r\nimport monitorReducersEnhancer from './enhancers/monitorReducers'\r\nimport loggerMiddleware from './middleware/logger'\r\nimport rootReducer from './reducers'\r\n\r\nexport default function configureStore(preloadedState) {\r\n  const middlewares = [loggerMiddleware, thunkMiddleware]\r\n  const middlewareEnhancer = applyMiddleware(...middlewares)\r\n\r\n  const enhancers = [middlewareEnhancer, monitorReducersEnhancer]\r\n  const composedEnhancers = composeWithDevTools(...enhancers)\r\n\r\n  const store = createStore(rootReducer, preloadedState, composedEnhancers)\r\n\r\n  if (process.env.NODE_ENV !== 'production' && module.hot)\r\n    module.hot.accept('./reducers', () => store.replaceReducer(rootReducer))\r\n\r\n  return store\r\n}\n"})}),"\n",(0,s.jsx)(r.h3,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsxs)(r.p,{children:["By default, ",(0,s.jsx)(r.code,{children:"configureStore"})," from Redux Toolkit will:"]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["Call ",(0,s.jsx)(r.code,{children:"applyMiddleware"})," with a default list of middlewares","\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"https://github.com/reduxjs/redux-thunk",children:"Async thunk middleware"}),"."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"https://redux-toolkit.js.org/api/immutabilityMiddleware",children:"Immutability check middleware"}),":\r\nthrow error when detecting mutations in reducers during a dispatch."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"https://redux-toolkit.js.org/api/serializabilityMiddleware",children:"Serializability check middleware"}),":\r\nthrow error when deeply detecting non-serializable values in state tree\r\n(functions, promises, symbols, and other non-plain-data values)."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["Call ",(0,s.jsx)(r.code,{children:"composeWithDevTools"})," to set up the Redux DevTools Extension."]}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:"import { configureStore, getDefaultMiddleware } from '@reduxjs/toolkit'\r\nimport loggerMiddleware from './middleware/logger'\r\nimport rootReducer from './reducers'\r\n\r\nexport default function configureAppStore(preloadedState) {\r\n  const store = configureStore({\r\n    reducer: rootReducer,\r\n    middleware: [loggerMiddleware, ...getDefaultMiddleware()],\r\n    preloadedState,\r\n  })\r\n\r\n  if (process.env.NODE_ENV === 'development' && module.hot)\r\n    module.hot.accept('./reducers', () => store.replaceReducer(rootReducer))\r\n\r\n  return store\r\n}\n"})}),"\n",(0,s.jsx)(r.h2,{id:"state",children:"State"}),"\n",(0,s.jsx)(r.p,{children:"\u5728 Redux \u4e2d State \u5e76\u4e0d\u663e\u5f0f\u5b9a\u4e49:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"\u521d\u6001\u4e0e\u53d8\u5316\u6001\u7686\u7531 Reducers \u5b9a\u4e49\u5e76\u63a7\u5236"}),"\n",(0,s.jsx)(r.li,{children:"Actions \u4e2d\u4fdd\u5b58\u7740 action.type \u5916, \u8fd8\u4fdd\u5b58\u7740\u4f9b Reducers \u8fdb\u884c\u6709\u6548\u72b6\u6001\u53d8\u5316\u7684\u5176\u4ed6\u4fe1\u606f(\u53ef\u81ea\u5b9a\u4e49)"}),"\n",(0,s.jsx)(r.li,{children:"\u8c03\u7528 Dispatch \u65b9\u6cd5\u81ea\u52a8\u5411 Store \u4f20\u9012\u4e00\u4e2a Action(\u56e0\u4e3a\u53ea\u6709\u4e00\u4e2a\u5168\u5c40 Store, \u6545\u65e0\u9700\u989d\u5916\u6307\u5b9a Store \u53c2\u6570),\r\nStore \u904d\u5386\u8c03\u7528\u5176\u4e2d\u7684 Reducers, \u6839\u636e switch \u8bed\u53e5\u8fdb\u884c\u5339\u914d action \u5904\u7406"}),"\n",(0,s.jsx)(r.li,{children:"reducer \u53ea\u4fdd\u5b58\u6700\u57fa\u672c\u7684 state, \u53ef\u8ba1\u7b97\u51fa\u7684 state \u653e\u5728 mapStateToProps(selector) \u4e2d\u76f4\u63a5\u8ba1\u7b97\u540e\u7ed1\u5b9a\u81f3 props"}),"\n",(0,s.jsx)(r.li,{children:"\u5c06\u6570\u636e\u4fdd\u5b58\u5728 Redux \u5b58\u50a8\u4e2d, \u5e76\u5728\u7ec4\u4ef6\u5185\u90e8\u4fdd\u6301 UI \u76f8\u5173\u72b6\u6001"}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"persistence",children:"Persistence"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:"// localStorage.getItem('state')/localStorage.setItem('state', serializedState)\r\nconst persistedState = loadLocalStorageState()\r\nconst appStore = createStore(rootReducers, persistedState)\r\n\r\nappStore.subscribe(\r\n  throttle(() => {\r\n    saveLocalStorageState({\r\n      todos: store.getState().todos,\r\n    })\r\n  }, 1000)\r\n)\n"})}),"\n",(0,s.jsx)(r.h3,{id:"normalization",children:"Normalization"}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.a,{href:"https://redux.js.org/usage/structuring-reducers/normalizing-state-shape",children:"Redux normalizing state shape"}),":"]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Only have one copy of each particular piece of data in state (no duplication)."}),"\n",(0,s.jsx)(r.li,{children:"Normalized data is kept in lookup table (key-value store),\r\nwhere item IDs are keys, items themselves are values."}),"\n",(0,s.jsx)(r.li,{children:"There may also be an array of all of the IDs for a particular item type."}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:"Normalizing data:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["Each type of data gets its own ",(0,s.jsx)(r.code,{children:"table"})," in state."]}),"\n",(0,s.jsxs)(r.li,{children:["Each ",(0,s.jsx)(r.code,{children:"data table"})," should store individual items in an ",(0,s.jsx)(r.code,{children:"{ key, value }"})," object:\r\n",(0,s.jsx)(r.code,{children:'"p1" : { id : "p1", author : "user1", comments : ["comment1", "comment2"] }'}),"."]}),"\n",(0,s.jsx)(r.li,{children:"Any references to individual items should be item ID."}),"\n",(0,s.jsx)(r.li,{children:"Arrays of IDs should be used to indicate ordering."}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:"const state = {\r\n  users: {\r\n    ids: ['user1', 'user2', 'user3'],\r\n    entities: {\r\n      user1: { id: 'user1', firstName, lastName },\r\n      user2: { id: 'user2', firstName, lastName },\r\n      user3: { id: 'user3', firstName, lastName },\r\n    },\r\n  },\r\n}\r\n\r\nconst userId = 'user2'\r\nconst userObject = state.users.entities[userId]\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Normalize nesting data with ",(0,s.jsx)(r.a,{href:"https://github.com/paularmstrong/normalizr",children:"Normalizr"}),":"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:"const data = {\r\n  entities: {\r\n    authors: { byId: {}, allIds: [] },\r\n    books: { byId: {}, allIds: [] },\r\n    authorBook: {\r\n      byId: {\r\n        1: {\r\n          id: 1,\r\n          authorId: 5,\r\n          bookId: 22,\r\n        },\r\n        2: {\r\n          id: 2,\r\n          authorId: 5,\r\n          bookId: 15,\r\n        },\r\n        3: {\r\n          id: 3,\r\n          authorId: 42,\r\n          bookId: 12,\r\n        },\r\n      },\r\n      allIds: [1, 2, 3],\r\n    },\r\n  },\r\n}\n"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:"const blogPosts = [\r\n  {\r\n    id: 'post1',\r\n    author: { username: 'user1', name: 'User 1' },\r\n    body: '......',\r\n    comments: [\r\n      {\r\n        id: 'comment1',\r\n        author: { username: 'user2', name: 'User 2' },\r\n        comment: '.....',\r\n      },\r\n      {\r\n        id: 'comment2',\r\n        author: { username: 'user3', name: 'User 3' },\r\n        comment: '.....',\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    id: 'post2',\r\n    author: { username: 'user2', name: 'User 2' },\r\n    body: '......',\r\n    comments: [\r\n      {\r\n        id: 'comment3',\r\n        author: { username: 'user3', name: 'User 3' },\r\n        comment: '.....',\r\n      },\r\n      {\r\n        id: 'comment4',\r\n        author: { username: 'user1', name: 'User 1' },\r\n        comment: '.....',\r\n      },\r\n      {\r\n        id: 'comment5',\r\n        author: { username: 'user3', name: 'User 3' },\r\n        comment: '.....',\r\n      },\r\n    ],\r\n  },\r\n  // and repeat many times\r\n]\r\n\r\nconst normalizedBlogPosts = {\r\n  posts: {\r\n    byId: {\r\n      post1: {\r\n        id: 'post1',\r\n        author: 'user1',\r\n        body: '......',\r\n        comments: ['comment1', 'comment2'],\r\n      },\r\n      post2: {\r\n        id: 'post2',\r\n        author: 'user2',\r\n        body: '......',\r\n        comments: ['comment3', 'comment4', 'comment5'],\r\n      },\r\n    },\r\n    allIds: ['post1', 'post2'],\r\n  },\r\n  comments: {\r\n    byId: {\r\n      comment1: {\r\n        id: 'comment1',\r\n        author: 'user2',\r\n        comment: '.....',\r\n      },\r\n      comment2: {\r\n        id: 'comment2',\r\n        author: 'user3',\r\n        comment: '.....',\r\n      },\r\n      comment3: {\r\n        id: 'comment3',\r\n        author: 'user3',\r\n        comment: '.....',\r\n      },\r\n      comment4: {\r\n        id: 'comment4',\r\n        author: 'user1',\r\n        comment: '.....',\r\n      },\r\n      comment5: {\r\n        id: 'comment5',\r\n        author: 'user3',\r\n        comment: '.....',\r\n      },\r\n    },\r\n    allIds: ['comment1', 'comment2', 'comment3', 'comment4', 'comment5'],\r\n  },\r\n  users: {\r\n    byId: {\r\n      user1: {\r\n        username: 'user1',\r\n        name: 'User 1',\r\n      },\r\n      user2: {\r\n        username: 'user2',\r\n        name: 'User 2',\r\n      },\r\n      user3: {\r\n        username: 'user3',\r\n        name: 'User 3',\r\n      },\r\n    },\r\n    allIds: ['user1', 'user2', 'user3'],\r\n  },\r\n}\n"})}),"\n",(0,s.jsx)(r.h3,{id:"entity-adapter",children:"Entity Adapter"}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.a,{href:"https://redux-toolkit.js.org/api/createEntityAdapter",children:"createEntityAdapter"}),":"]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Build normalized state."}),"\n",(0,s.jsx)(r.li,{children:"Return normalized state CURD operation reducers."}),"\n",(0,s.jsxs)(r.li,{children:["Get data selectors by ",(0,s.jsx)(r.code,{children:"getSelectors"}),"."]}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:"import {\r\n  createAsyncThunk,\r\n  createEntityAdapter,\r\n  createSlice,\r\n} from '@reduxjs/toolkit'\r\nimport { client } from './api'\r\n\r\nconst postsAdapter = createEntityAdapter({\r\n  sortComparer: (a, b) => b.date.localeCompare(a.date),\r\n})\r\n\r\n// State = { ids: [], entities: {}, status: 'idle', error: null };\r\nconst initialState = postsAdapter.getInitialState({\r\n  status: 'idle',\r\n  error: null,\r\n})\r\n\r\nexport const fetchPosts = createAsyncThunk('posts/fetchPosts', async () => {\r\n  const response = await client.get('/fakeApi/posts')\r\n  return response.data\r\n})\r\n\r\nconst postsSlice = createSlice({\r\n  name: 'posts',\r\n  initialState,\r\n  reducers: {\r\n    reactionAdded(state, action) {\r\n      const { postId, reaction } = action.payload\r\n      const existingPost = state.entities[postId]\r\n      if (existingPost)\r\n        existingPost.reactions[reaction]++\r\n    },\r\n    postUpdated(state, action) {\r\n      const { id, title, content } = action.payload\r\n      const existingPost = state.entities[id]\r\n      if (existingPost) {\r\n        existingPost.title = title\r\n        existingPost.content = content\r\n      }\r\n    },\r\n  },\r\n  extraReducers(builder) {\r\n    builder\r\n      .addCase(fetchPosts.fulfilled, (state, action) => {\r\n        state.status = 'succeeded'\r\n        // Use the `upsertMany` reducer as a mutating update utility\r\n        postsAdapter.upsertMany(state, action.payload)\r\n      })\r\n      // Use the `addOne` reducer for the fulfilled case\r\n      .addCase(addNewPost.fulfilled, postsAdapter.addOne)\r\n  },\r\n})\r\n\r\nexport const { postAdded, postUpdated, reactionAdded } = postsSlice.actions\r\n\r\n// Export the customized selectors for this adapter using `getSelectors`\r\nexport const {\r\n  selectAll: selectAllPosts,\r\n  selectById: selectPostById,\r\n  selectIds: selectPostIds,\r\n  // Pass in a selector that returns the posts slice of state\r\n} = postsAdapter.getSelectors(state => state.posts)\r\n\r\nexport const selectPostsByUser = createSelector(\r\n  [selectAllPosts, (state, userId) => userId],\r\n  (posts, userId) => posts.filter(post => post.user === userId)\r\n)\r\n\r\nexport default postsSlice.reducer\n"})})]})}function u(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},86145:(e,r,n)=>{n.d(r,{R:()=>a,x:()=>i});var t=n(57140);const s={},o=t.createContext(s);function a(e){const r=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(o.Provider,{value:r},e.children)}}}]);