"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[45670],{15092:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"web/node/network","title":"Network","description":"Fetch","source":"@site/content/web/node/network.md","sourceDirName":"web/node","slug":"/web/node/network","permalink":"/notes/web/node/network","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/node/network.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"Node.js","permalink":"/notes/tags/node-js"},{"inline":true,"label":"Network","permalink":"/notes/tags/network"},{"inline":true,"label":"Fetch","permalink":"/notes/tags/fetch"},{"inline":true,"label":"HTTP","permalink":"/notes/tags/http"},{"inline":true,"label":"Socket","permalink":"/notes/tags/socket"},{"inline":true,"label":"DNS","permalink":"/notes/tags/dns"},{"inline":true,"label":"URL","permalink":"/notes/tags/url"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":9,"frontMatter":{"sidebar_position":9,"tags":["Web","Node.js","Network","Fetch","HTTP","Socket","DNS","URL"]},"sidebar":"tutorialSidebar","previous":{"title":"Filesystem","permalink":"/notes/web/node/filesystem"},"next":{"title":"Crypto","permalink":"/notes/web/node/crypto"}}');var r=t(35656),l=t(86145);const o={sidebar_position:9,tags:["Web","Node.js","Network","Fetch","HTTP","Socket","DNS","URL"]},i="Network",c={},a=[{value:"Fetch",id:"fetch",level:2},{value:"Http",id:"http",level:2},{value:"Request",id:"request",level:3},{value:"Response",id:"response",level:3},{value:"Get",id:"get",level:3},{value:"Server",id:"server",level:3},{value:"Socket",id:"socket",level:2},{value:"DNS",id:"dns",level:2},{value:"URL",id:"url",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"network",children:"Network"})}),"\n",(0,r.jsx)(n.h2,{id:"fetch",children:"Fetch"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"async function fetchData(url) {\n  try {\n    const response = await fetch(url, {\n      signal: AbortSignal.timeout(5000) // Built-in timeout support\n    })\n\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`)\n    }\n\n    return await response.json()\n  } catch (error) {\n    if (error.name === 'TimeoutError') {\n      throw new Error('Request timed out')\n    }\n    throw error\n  }\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// Cancel long-running operations cleanly\nconst controller = new AbortController()\n\n// Set up automatic cancellation\nsetTimeout(() => controller.abort(), 10000)\n\ntry {\n  const data = await fetch('https://slow-api.com/data', {\n    signal: controller.signal\n  })\n  console.log('Data received:', data)\n} catch (error) {\n  if (error.name === 'AbortError') {\n    console.log('Request was cancelled - this is expected behavior')\n  } else {\n    console.error('Unexpected error:', error)\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"http",children:"Http"}),"\n",(0,r.jsx)(n.h3,{id:"request",children:"Request"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const request = {\n  method: 'POST',\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"response",children:"Response"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"typedef Stream response\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u76d1\u542c\u4e8b\u4ef6:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"response.on('data', (data) => {\n  process(data)\n})\nresponse.on('error', (err) => {\n  console.error(err)\n})\nresponse.on('end', () => {\n  stream.end()\n})\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u53d1\u51fa\u4e8b\u4ef6:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"response.end() //  \u4f20\u8f93\u7ed3\u675f\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"response.setEncoding('utf8') // \u81ea\u52a8\u5c06 data \u4e8b\u4ef6\u4e2d Buffer \u5bf9\u8c61\u8f6c\u6362\u6210 String\n\n//  content-type: text/plain\n//                application/json\nresponse.writeHead(200, { 'Content-Type': '' })\n"})}),"\n",(0,r.jsx)(n.h3,{id:"get",children:"Get"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"http.get(url, (response) => {})\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"http.get(url, (response) => {\n  let pipeData = ''\n\n  response.setEncoding('utf8')\n  response.on('data', (data) => {\n    pipeData += data\n  })\n  response.on('end', () => {\n    console.log(pipeData.length)\n    console.log(pipeData)\n  })\n})\n"})}),"\n",(0,r.jsx)(n.h3,{id:"server",children:"Server"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const server = http.createServer((request, response) => {\n  // \u5904\u7406\u8bf7\u6c42\u7684\u903b\u8f91...\n})\nserver.listen(8000)\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const net = require('node:net')\n\nconst chatServer = net.createServer()\n// \u7528\u4e8e\u68c0\u6d4b\u50f5\u5c38\u5ba2\u6237\u7aef,\u7528\u4e8e\u53ca\u65f6\u6e05\u9664\u50f5\u5c38\u5ba2\u6237\u7aef\nconst clientList = []\n\nchatServer.on('connection', (client) => {\n  client.name = `${client.remoteAddress}:${client.remotePort}`\n  client.write(`Hi ${client.name}!\\n`)\n  clientList.push(client)\n\n  client.on('data', (data) => {\n    broadcast(data, client)\n  })\n  client.on('end', () => {\n    clientList.splice(clientList.indexOf(client), 1)\n  })\n  client.on('error', (e) => {\n    console.log(e)\n  })\n})\n\nfunction broadcast(message, client) {\n  const cleanup = []\n\n  for (let i = 0; i < clientList.length; i += 1) {\n    // \u5411\u5176\u4ed6\u4eba(\u6392\u9664\u81ea\u8eab)\u53d1\u9001\u6d88\u606f\n    if (client !== clientList[i]) {\n      if (clientList[i].writable) {\n        clientList[i].write(`${client.name} says ${message}`)\n      } else {\n        cleanup.push(clientList[i])\n        clientList[i].destroy()\n      }\n    }\n  }\n\n  // \u6e05\u9664\u50f5\u5c38\u5ba2\u6237\u7aef\n  for (let i = 0; i < cleanup.length; i += 1)\n    clientList.splice(clientList.indexOf(cleanup[i]), 1)\n}\n\nchatServer.listen(9000)\n"})}),"\n",(0,r.jsx)(n.h2,{id:"socket",children:"Socket"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"socket.write(data)\nsocket.end(data)\nsocket.end()\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const fs = require('node:fs')\nconst http = require('node:http')\nconst io = require('socket.io')\n\nconst sockFile = fs.readFileSync('socket.html')\n\nserver = http.createServer()\nserver.on('request', (req, res) => {\n  res.writeHead(200, { 'content-type': 'text/html' })\n  res.end(sockFile)\n})\nserver.listen(8080)\n\nconst socket = io.listen(server)\n\n// \u547d\u540d\u7a7a\u95f4\nsocket.of('/upAndRunning').on('connection', (client) => {\n  console.log('Client connected to Up and Running namespace.')\n  client.send('Welcome to \\'Up and Running\\'')\n})\nsocket.of('/weather').on('connection', (client) => {\n  console.log('Client connected to Weather namespace.')\n  client.send('Welcome to \\'Weather Updates\\'')\n})\n"})}),"\n",(0,r.jsx)(n.h2,{id:"dns",children:"DNS"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"dns.resolve"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"dns.reverse"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"dns.lookup"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const dns = require('node:dns')\n\ndns.lookup('google.com', 4, (e, a) => {\n  console.log(a)\n})\n\ndns.resolve('tazimi.tk', 'A', (e, r) => {\n  if (e)\n    console.log(e)\n\n  console.log(JSON.stringify(r, null, 2))\n})\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const dns = require('node:dns')\n\ndns.resolve('tazimi.dev', 'A', (err, res) => {\n  if (err)\n    console.log(err)\n  else\n    console.log(`A: ${JSON.stringify(res, null, 2)}`)\n})\n\ndns.resolve('github.com', 'MX', (err, res) => {\n  if (err)\n    console.log(err)\n  else\n    console.log(`MX: ${JSON.stringify(res, null, 2)}`)\n})\n"})}),"\n",(0,r.jsx)(n.h2,{id:"url",children:"URL"}),"\n",(0,r.jsx)(n.p,{children:"\u89e3\u6790\u5904 URL \u5404\u4e2a\u7ec4\u6210\u90e8\u5206:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"href"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"protocol"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"host"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"auth"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"hostname"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"port"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"pathname"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"search"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"query"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"hash"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// true \u8868\u793a\u8c03\u7528 queryString \u6a21\u5757\u67e5\u8be2\u5b57\u7b26\u4e32\nurl.parse(request.url, true)\n"})})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},86145:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>i});var s=t(57140);const r={},l=s.createContext(r);function o(e){const n=s.useContext(l);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);