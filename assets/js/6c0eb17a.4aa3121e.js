"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[55112],{90011:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"web/node/debugging","title":"Debugging","description":"Inspector","source":"@site/content/web/node/debugging.md","sourceDirName":"web/node","slug":"/web/node/debugging","permalink":"/notes/web/node/debugging","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/node/debugging.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"Node.js","permalink":"/notes/tags/node-js"},{"inline":true,"label":"Debugging","permalink":"/notes/tags/debugging"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":11,"frontMatter":{"sidebar_position":11,"tags":["Web","Node.js","Debugging"]},"sidebar":"tutorialSidebar","previous":{"title":"Crypto","permalink":"/notes/web/node/crypto"},"next":{"title":"Testing","permalink":"/notes/web/node/testing"}}');var s=t(35656),a=t(86145);const i={sidebar_position:11,tags:["Web","Node.js","Debugging"]},o="Debugging",c={},l=[{value:"Inspector",id:"inspector",level:2},{value:"Crawler",id:"crawler",level:2}];function u(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,a.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"debugging",children:"Debugging"})}),"\n",(0,s.jsx)(e.h2,{id:"inspector",children:"Inspector"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.a,{href:"https://nodejs.org/en/docs/guides/debugging-getting-started",children:"Enable inspector"}),";"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"node --inspect server.js # Start debugging.\nnode --inspect-brk server.js # Start debugging and break.\n"})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.a,{href:"https://nodejs.dev/en/api/v18/cli/#node_debugmodule",children:"Enable core modules debug information"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"NODE_DEBUG=fs,net,stream yarn test\n"})}),"\n",(0,s.jsx)(e.h2,{id:"crawler",children:"Crawler"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.a,{href:"https://www.zenrows.com/blog/web-scraping-with-javascript-and-nodejs",children:"Simple example"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",children:"const axios = require('axios')\nconst cheerio = require('cheerio')\nconst playwright = require('playwright')\n\nconst url = 'https://scrapeme.live/shop/page/1/'\nconst useHeadless = false // \"true\" to use playwright\nconst maxVisits = 30 // Arbitrary number for the maximum of links visited\nconst visited = new Set()\nconst allProducts = []\n\nconst sleep = ms => new Promise(resolve => setTimeout(resolve, ms))\n\nasync function getHtmlPlaywright(url) {\n  const browser = await playwright.firefox.launch()\n  const context = await browser.newContext()\n  const page = await context.newPage()\n  await page.goto(url)\n  const html = await page.content()\n  await browser.close()\n\n  return html\n}\n\nasync function getHtmlAxios(url) {\n  const { data } = await axios.get(url)\n\n  return data\n}\n\nasync function getHtml(url) {\n  return useHeadless ? await getHtmlPlaywright(url) : await getHtmlAxios(url)\n}\n\nfunction extractContent($) {\n  return $('.product')\n    .map((_, product) => {\n      const $product = $(product)\n\n      return {\n        id: $product.find('a[data-product_id]').attr('data-product_id'),\n        title: $product.find('h2').text(),\n        price: $product.find('.price').text(),\n      }\n    })\n    .toArray()\n}\n\nfunction extractLinks($) {\n  return [\n    ...new Set(\n      $('.page-numbers a')\n        .map((_, a) => $(a).attr('href'))\n        .toArray()\n    ),\n  ]\n}\n\nasync function crawl(url) {\n  visited.add(url)\n  console.log('Crawl: ', url)\n  const html = await getHtml(url)\n  const $ = cheerio.load(html)\n  const content = extractContent($)\n  const links = extractLinks($)\n  links\n    .filter(link => !visited.has(link))\n    .forEach((link) => {\n      q.enqueue(crawlTask, link)\n    })\n  allProducts.push(...content)\n\n  // We can see how the list grows. Gotta catch 'em all!\n  console.log(allProducts.length)\n}\n\n// Change the default concurrency or pass it as param\nfunction queue(concurrency = 4) {\n  let running = 0\n  const tasks = []\n\n  return {\n    enqueue: async (task, ...params) => {\n      tasks.push({ task, params })\n      if (running >= concurrency)\n        return\n\n      ++running\n      while (tasks.length) {\n        const { task, params } = tasks.shift()\n        await task(...params)\n      }\n      --running\n    },\n  }\n}\n\nasync function crawlTask(url) {\n  if (visited.size >= maxVisits) {\n    console.log('Over Max Visits, exiting')\n    return\n  }\n\n  if (visited.has(url))\n    return\n\n  await crawl(url)\n}\n\nconst q = queue()\nq.enqueue(crawlTask, url)\n"})}),"\n",(0,s.jsxs)(e.p,{children:["Web scraping with ",(0,s.jsx)(e.a,{href:"https://lev.engineer/blog/web-scraping-like-a-pro-unlocking-the-power-of-impersonation",children:"impersonation"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",children:"const puppeteer = require('puppeteer-extra')\nconst StealthPlugin = require('puppeteer-extra-plugin-stealth')\n\npuppeteer.use(StealthPlugin());\n\n(async () => {\n  const browser = await puppeteer.launch()\n  const page = await browser.newPage()\n  await page.goto('https://example.com')\n\n  // Now your Puppeteer script is enhanced with advanced evasion techniques\n  // Proceed with your web scraping tasks\n\n  await browser.close()\n})()\n\nconst { chromium, devices } = require('playwright')\n\nconst iPhone11 = devices['iPhone 11'];\n\n(async () => {\n  const browser = await chromium.launch()\n  const context = await browser.newContext({\n    userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 '\n      + '(KHTML, like Gecko) Chrome/88.0.4324.150 Safari/537.36',\n    geolocation: { latitude: 48.8584, longitude: 2.2945 }, // Paris, France\n    permissions: ['geolocation'],\n    locale: 'fr-FR',\n    ...iPhone11,\n  })\n  const page = await context.newPage()\n  await page.goto('https://example.com')\n\n  // Your scraping logic here\n\n  await browser.close()\n})()\n"})})]})}function d(n={}){const{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(u,{...n})}):u(n)}},86145:(n,e,t)=>{t.d(e,{R:()=>i,x:()=>o});var r=t(57140);const s={},a=r.createContext(s);function i(n){const e=r.useContext(a);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:i(n.components),r.createElement(a.Provider,{value:e},n.children)}}}]);