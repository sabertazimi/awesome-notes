"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[63387],{32208:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"web/react/hooks/resource","title":"Resource","description":"Script Loading","source":"@site/content/web/react/hooks/resource.md","sourceDirName":"web/react/hooks","slug":"/web/react/hooks/resource","permalink":"/notes/web/react/hooks/resource","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/react/hooks/resource.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"React","permalink":"/notes/tags/react"},{"inline":true,"label":"Hook","permalink":"/notes/tags/hook"},{"inline":true,"label":"Resource","permalink":"/notes/tags/resource"},{"inline":true,"label":"Storage","permalink":"/notes/tags/storage"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":25,"frontMatter":{"sidebar_position":25,"tags":["Web","React","Hook","Resource","Storage"]},"sidebar":"tutorialSidebar","previous":{"title":"Router","permalink":"/notes/web/react/hooks/router"},"next":{"title":"Data","permalink":"/notes/web/react/hooks/data"}}');var s=n(35656),o=n(86145);const a={sidebar_position:25,tags:["Web","React","Hook","Resource","Storage"]},i="Resource",c={},l=[{value:"Script Loading",id:"script-loading",level:2},{value:"Cookie",id:"cookie",level:2},{value:"LocalStorage",id:"localstorage",level:2}];function d(e){const t={code:"code",h1:"h1",h2:"h2",header:"header",pre:"pre",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"resource",children:"Resource"})}),"\n",(0,s.jsx)(t.h2,{id:"script-loading",children:"Script Loading"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",children:"import { useEffect, useState } from 'react'\n\nexport type Status = 'idle' | 'loading' | 'ready' | 'error'\nexport type ScriptElt = HTMLScriptElement | null\n\nfunction useScript(src: string): Status {\n  const [status, setStatus] = useState<Status>(src ? 'loading' : 'idle')\n\n  useEffect(\n    () => {\n      if (!src) {\n        setStatus('idle')\n        return\n      }\n\n      // Fetch existing script element by src\n      // It may have been added by another instance of this hook\n      // **Cache mechanism**\n      let script: ScriptElt = document.querySelector(`script[src=\"${src}\"]`)\n\n      if (!script) {\n        // Create script\n        script = document.createElement('script')\n        script.src = src\n        script.async = true\n        script.setAttribute('data-status', 'loading')\n        // Add script to document body\n        document.body.appendChild(script)\n\n        // Store status in attribute on script\n        // This can be read by other instances of this hook\n        const setAttributeFromEvent = (event: Event) => {\n          script?.setAttribute(\n            'data-status',\n            event.type === 'load' ? 'ready' : 'error'\n          )\n        }\n\n        // eslint-disable-next-line react-web-api/no-leaked-event-listener -- Remove event listener on cleanup.\n        script.addEventListener('load', setAttributeFromEvent)\n        // eslint-disable-next-line react-web-api/no-leaked-event-listener -- Remove event listener on cleanup.\n        script.addEventListener('error', setAttributeFromEvent)\n      } else {\n        // Grab existing script status from attribute and set to state.\n        setStatus(script.getAttribute('data-status') as Status)\n      }\n\n      // Script event handler to update status in state\n      // Note: Even if the script already exists we still need to add\n      // event handlers to update the state for *this* hook instance.\n      const setStateFromEvent = (event: Event) => {\n        setStatus(event.type === 'load' ? 'ready' : 'error')\n      }\n\n      // Add event listeners\n      script.addEventListener('load', setStateFromEvent)\n      script.addEventListener('error', setStateFromEvent)\n\n      // Remove event listeners on cleanup\n      return () => {\n        if (script) {\n          script.removeEventListener('load', setStateFromEvent)\n          script.removeEventListener('error', setStateFromEvent)\n        }\n      }\n    },\n    [src] // Only re-run effect if script src changes\n  )\n\n  return status\n}\n\nexport default useScript\n"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",children:"const cachedScripts = []\n\nfunction useScript(src) {\n  // Keeping track of script loaded and error state\n  const [state, setState] = useState({\n    loaded: false,\n    error: false,\n  })\n\n  useEffect(\n    () => {\n      // If cachedScripts array already includes src\n      // that means another instance ...\n      // ... of this hook already loaded this script, so no need to load again.\n      if (cachedScripts.includes(src)) {\n        setState({\n          loaded: true,\n          error: false,\n        })\n      } else {\n        cachedScripts.push(src)\n\n        // Create script\n        const script = document.createElement('script')\n        script.src = src\n        script.async = true\n\n        // Script event listener callbacks for load and error\n        const onScriptLoad = () => {\n          setState({\n            loaded: true,\n            error: false,\n          })\n        }\n\n        const onScriptError = () => {\n          // Remove from cachedScripts we can try loading again\n          const index = cachedScripts.indexOf(src)\n          if (index >= 0)\n            cachedScripts.splice(index, 1)\n          script.remove()\n\n          setState({\n            loaded: true,\n            error: true,\n          })\n        }\n\n        script.addEventListener('load', onScriptLoad)\n        script.addEventListener('error', onScriptError)\n\n        // Add script to document body\n        document.body.appendChild(script)\n\n        // Remove event listeners on cleanup\n        return () => {\n          script.removeEventListener('load', onScriptLoad)\n          script.removeEventListener('error', onScriptError)\n        }\n      }\n    },\n    [src] // Only re-run effect if script src changes\n  )\n\n  return [state.loaded, state.error]\n}\n"})}),"\n",(0,s.jsx)(t.h2,{id:"cookie",children:"Cookie"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",children:"// https://github.com/tylerwolff/useCookie.\nimport { useState } from 'react'\n\nconst isBrowser = typeof window !== 'undefined'\n\nfunction stringifyOptions(options) {\n  return Object.keys(options).reduce((acc, key) => {\n    if (key === 'days') {\n      // Skip `days`.\n      return acc\n    } else {\n      if (options[key] === false)\n        return acc\n      else if (options[key] === true)\n        return `${acc}; ${key}`\n      else return `${acc}; ${key}=${options[key]}`\n    }\n  }, '')\n}\n\nfunction getCookie(name, initialValue = '') {\n  return (\n    (isBrowser\n      && document.cookie.split('; ').reduce((r, v) => {\n        const parts = v.split('=')\n        return parts[0] === name ? decodeURIComponent(parts[1]) : r\n      }, ''))\n      || initialValue\n  )\n}\n\nfunction setCookie(name, value, options) {\n  if (!isBrowser)\n    return\n\n  const optionsWithDefaults = {\n    days: 7,\n    path: '/',\n    ...options,\n  }\n\n  const expires = new Date(\n    Date.now() + optionsWithDefaults.days * 864e5\n  ).toUTCString()\n\n  document.cookie = `${name}=${encodeURIComponent(\n    value\n  )}; expires=${expires}${stringifyOptions(optionsWithDefaults)}`\n}\n\nfunction useCookie(key, initialValue) {\n  const [item, setItem] = useState(() => {\n    return getCookie(key, initialValue)\n  })\n\n  const updateItem = (value, options) => {\n    setItem(value)\n    setCookie(key, value, options)\n  }\n\n  return [item, updateItem]\n}\n"})}),"\n",(0,s.jsx)(t.h2,{id:"localstorage",children:"LocalStorage"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-tsx",children:"// https://www.robinwieruch.de/react-uselocalstorage-hook.\nfunction useLocalStorage(storageKey, fallbackState) {\n  const [value, setValue] = React.useState(\n    JSON.parse(localStorage.getItem(storageKey)) || fallbackState\n  )\n\n  // Update logic.\n  React.useEffect(() => {\n    localStorage.setItem(storageKey, JSON.stringify(value))\n  }, [value, storageKey])\n\n  return [value, setValue]\n}\n\nexport default function App() {\n  const [isOpen, setOpen] = useLocalStorage('is-open', false)\n\n  const handleToggle = () => {\n    setOpen(!isOpen)\n  }\n\n  return (\n    <div>\n      <button type=\"button\" onClick={handleToggle}>Toggle</button>\n      {isOpen && <div>Content</div>}\n    </div>\n  )\n}\n"})})]})}function u(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},86145:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>i});var r=n(57140);const s={},o=r.createContext(s);function a(e){const t=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(o.Provider,{value:t},e.children)}}}]);