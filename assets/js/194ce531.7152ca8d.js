"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[31588],{43717:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>p,frontMatter:()=>i,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"web/testing/cypress","title":"Cypress","description":"When it comes to test heavy visual features,","source":"@site/content/web/testing/cypress.md","sourceDirName":"web/testing","slug":"/web/testing/cypress","permalink":"/notes/web/testing/cypress","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/testing/cypress.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"Testing","permalink":"/notes/tags/testing"},{"inline":true,"label":"Cypress","permalink":"/notes/tags/cypress"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":3,"frontMatter":{"sidebar_position":3,"tags":["Web","Testing","Cypress"]},"sidebar":"tutorialSidebar","previous":{"title":"Jest","permalink":"/notes/web/testing/jest"},"next":{"title":"Debugging","permalink":"/notes/web/testing/debugging"}}');var r=s(35656),c=s(86145);const i={sidebar_position:3,tags:["Web","Testing","Cypress"]},l="Cypress",o={},a=[{value:"Installation",id:"installation",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Getting Started",id:"getting-started",level:2},{value:"Principles",id:"principles",level:2},{value:"Commands",id:"commands",level:2},{value:"Action",id:"action",level:3},{value:"Network",id:"network",level:3},{value:"Plugins",id:"plugins",level:2},{value:"References",id:"references",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"cypress",children:"Cypress"})}),"\n",(0,r.jsx)(n.p,{children:"When it comes to test heavy visual features,\n(e.g. fixed navigation based on window scroll event),\nE2E testing helps a lot."}),"\n",(0,r.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"yarn add -D cypress typescript\nyarn cypress open\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"cypress open"})," will initialize the cypress folder structure."]}),"\n",(0,r.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"cypress/tsconfig.json"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "extends": "../tsconfig.json",\n  "include": ["global.d.ts", "**/*.ts"],\n  "exclude": [],\n  "compilerOptions": {\n    "strict": true,\n    "target": "ES6",\n    "lib": ["ES6", "DOM"],\n    "types": ["cypress"],\n    "isolatedModules": false,\n    "noEmit": true\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"cypress/global.d.ts"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'/// <reference types="cypress" />\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"cypress.config.ts"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import { defineConfig } from 'cypress'\n\nexport default defineConfig({\n  e2e: {\n    baseUrl: 'http://localhost:3000',\n  },\n})\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"tsconfig.json"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx"],\n  "exclude": ["node_modules", "cypress"]\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"package.json"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "scripts": {\n    "e2e:chrome": "start-server-and-test e2e:prepare http://localhost:3000 cypress:chrome",\n    "e2e:firefox": "start-server-and-test e2e:prepare http://localhost:3000 cypress:firefox",\n    "e2e:ui": "start-server-and-test e2e:prepare http://localhost:3000 cypress:open",\n    "e2e:prepare": "yarn build && yarn serve",\n    "cypress:chrome": "cypress run --browser chrome",\n    "cypress:chromium": "cypress run --browser chromium",\n    "cypress:edge": "cypress run --browser edge",\n    "cypress:electron": "cypress run",\n    "cypress:firefox": "cypress run --browser firefox",\n    "cypress:open": "cypress open --browser electron --e2e"\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:".gitignore"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# cypress files\ncypress/screenshots\ncypress/videos\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"jest.config.js"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const config = {\n  testPathIgnorePatterns: ['/node_modules/', '/.next/', '/cypress/'],\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"getting-started",children:"Getting Started"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"cypress/support/commands.ts"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import '@testing-library/cypress/add-commands'\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"cypress/e2e/component.cy.ts"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"/// <reference types=\"cypress\"/>\n\ndescribe('component', () => {\n  it('should work', () => {\n    cy.visit('/')\n    cy.get('#onOff')\n      .should('have.text', 'off')\n      .click()\n      .should('have.text', 'on')\n  })\n})\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"cypress/e2e/payment.cy.ts"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import { v4 as uuid } from 'uuid'\n\ndescribe('payment', () => {\n  it('user can make payment', () => {\n    //  Login.\n    cy.visit('/')\n    cy.findByRole('textbox', { name: /username/i }).type('sabertaz')\n    cy.findByLabelText(/password/i).type('secret')\n    cy.findByRole('checkbox', { name: /remember me/i }).check()\n    cy.findByRole('button', { name: /sign in/i }).click()\n\n    // Check account balance.\n    let oldBalance\n    cy.get('[data-test=nav-user-balance]').then(\n      $balance => (oldBalance = $balance.text())\n    )\n\n    // Click on new button.\n    cy.findByRole('button', { name: /new/i }).click()\n\n    // Search for user.\n    cy.findByRole('textbox').type('devon becker')\n    cy.findByText(/devon becker/i).click()\n\n    // Add amount and note and click pay.\n    const paymentAmount = '5.00'\n    cy.findByPlaceholderText(/amount/i).type(paymentAmount)\n    const note = uuid()\n    cy.findByPlaceholderText(/add a note/i).type(note)\n    cy.findByRole('button', { name: /pay/i }).click()\n\n    // Return to transactions.\n    cy.findByRole('button', { name: /return to transactions/i }).click()\n\n    // Go to personal payments.\n    cy.findByRole('tab', { name: /mine/i }).click()\n\n    // Click on payment.\n    cy.findByText(note).click({ force: true })\n\n    // Verify if payment was made.\n    cy.findByText(`-$${paymentAmount}`).should('be.visible')\n    cy.findByText(note).should('be.visible')\n\n    // Verify if payment amount was deducted.\n    cy.get('[data-test=nav-user-balance]').then(($balance) => {\n      const convertedOldBalance = Number.parseFloat(oldBalance.replace(/\\$|,/g, ''))\n      const convertedNewBalance = Number.parseFloat(\n        $balance.text().replace(/\\$|,/g, '')\n      )\n      expect(convertedOldBalance - convertedNewBalance).to.equal(\n        Number.parseFloat(paymentAmount)\n      )\n    })\n  })\n})\n"})}),"\n",(0,r.jsx)(n.h2,{id:"principles",children:"Principles"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Flake resistance and retry-ability:\ndon't wait for fixed time, wait for specific elements (",(0,r.jsx)(n.code,{children:"cy.as"}),"):\n",(0,r.jsx)(n.code,{children:"cy.get"}),"/",(0,r.jsx)(n.code,{children:"cy.find"}),"/",(0,r.jsx)(n.code,{children:"cy.its"}),"/",(0,r.jsx)(n.code,{children:"cy.should"})," commands will\ngive the page an opportunity to fully load,\nand then the tests can proceed (Cypress run in browser directly)."]}),"\n",(0,r.jsxs)(n.li,{children:["Asynchronous nature:\nuse ",(0,r.jsx)(n.code,{children:"cy.then"}),"/",(0,r.jsx)(n.code,{children:"cy.wrap"})," for\n",(0,r.jsx)(n.a,{href:"https://learn.cypress.io/cypress-fundamentals/understanding-the-asynchronous-nature-of-cypress",children:"async nature of Cypress"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"commands",children:"Commands"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cy.its"}),": get property value on previously yielded subject."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cy.invoke"}),": invoke function on previously yielded subject."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"cy.wrap(['Wai Yan', 'Yu']).its(1).should('eq', 'Yu')\ncy.wrap({ age: 52 }).its('age').should('eq', 52)\ncy.wait('@publicTransactions')\n  .its('response.body.results')\n  .invoke('slice', 0, 5)\n"})}),"\n",(0,r.jsx)(n.p,{children:"Add custom commands:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"/// <reference types=\"cypress\" />\n\ndeclare global {\n  namespace Cypress {\n    interface Chainable {\n      findByRole: (role: string) => Chainable<JQuery<HTMLElement>>\n      findByTestId: (testId: string) => Chainable<JQuery<HTMLElement>>\n      getByRole: (role: string) => Chainable<JQuery<HTMLElement>>\n      getByTestId: (testId: string) => Chainable<JQuery<HTMLElement>>\n    }\n  }\n}\n\nCypress.Commands.add(\n  'findByRole',\n  { prevSubject: 'element' },\n  (subject, role) => {\n    return cy.wrap(subject, { log: false }).find(`[role=\"${role}\"]`)\n  }\n)\n\nCypress.Commands.add(\n  'findByTestId',\n  { prevSubject: 'element' },\n  (subject, testId) => {\n    return cy.wrap(subject, { log: false }).find(`[data-testid=\"${testId}\"]`)\n  }\n)\n\nCypress.Commands.add('getByRole', (role) => {\n  return cy.get(`[role=\"${role}\"]`)\n})\n\nCypress.Commands.add('getByTestId', (testId) => {\n  return cy.get(`[data-testid=\"${testId}\"]`)\n})\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Custom command ",(0,r.jsx)(n.a,{href:"https://filiphric.com/improve-your-custom-command-logs-in-cypress",children:"log"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"Cypress.Commands.add('take', (input: string) => {\n  let element: JQuery<HTMLElement> | HTMLElement[]\n  let count: number\n\n  const log = Cypress.log({\n    autoEnd: false,\n    consoleProps() {\n      return {\n        selector: input,\n        Yielded: element,\n        Elements: count,\n      }\n    },\n    displayName: 'take',\n    name: 'Get by [data-cy] attribute',\n  })\n\n  cy.get(`[data-cy=${input}]`, { log: false }).then(($el) => {\n    element = Cypress.dom.getElements($el)\n    count = $el.length\n    log.set({ $el })\n    log.snapshot().end()\n  })\n\n  cy.on('fail', (err) => {\n    log.error(err)\n    log.end()\n    throw err\n  })\n})\n"})}),"\n",(0,r.jsx)(n.h3,{id:"action",children:"Action"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cy.click"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cy.dbclick"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cy.type"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cy.clear"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cy.focus"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cy.blur"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cy.check"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cy.uncheck"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cy.select"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cy.selectFile"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cy.submit"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cy.trigger"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cy.scrollTo"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cy.scrollIntoView"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"network",children:"Network"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cy.intercept"}),": mock API response."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"cy.intercept('GET', '/transactions/public*', {\n  fixture: 'public-transactions.json',\n}).as('mockedPublicTransactions')\n\ncy.wait('@mockedPublicTransactions')\n\ncy.intercept('GET', '/transactions/public*', {\n  headers: {\n    'X-Powered-By': 'Express',\n    'Date': new Date().toString(),\n  },\n})\n\ncy.intercept('POST', '/bankAccounts', (req) => {\n  const { body } = req\n  req.continue((res) => {\n    res.body.data.listBankAccount = []\n  })\n})\n\ncy.intercept('POST', apiGraphQL, (req) => {\n  const { body } = req\n\n  if (\n    Object.hasOwn(body, 'operationName')\n    && body.operationName === 'CreateBankAccount'\n  ) {\n    req.alias = 'gqlCreateBankAccountMutation'\n  }\n})\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cy.request"}),": API integration/E2E tests."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"Cypress.Commands.add('getAllPosts', () => {\n  return cy.request('GET', '/api/posts').then((response) => {\n    return cy.wrap(response.body)\n  })\n})\n\nCypress.Commands.add('getFirstPost', () => {\n  return cy.request('GET', '/api/posts').then((response) => {\n    return cy.wrap(response.body).its(0)\n  })\n})\n\ndescribe('GET', () => {\n  it('gets a list of users', () => {\n    cy.request('GET', '/users').then((response) => {\n      expect(response.status).to.eq(200)\n      expect(response.body.results).length.to.be.greaterThan(1)\n    })\n  })\n\n  it('gets a list of comments', () => {\n    cy.request('/comments').as('comments')\n\n    cy.get('@comments').should((response) => {\n      expect(response.body).to.have.length(500)\n      expect(response).to.have.property('headers')\n      expect(response).to.have.property('duration')\n    })\n  })\n})\n"})}),"\n",(0,r.jsx)(n.h2,{id:"plugins",children:"Plugins"}),"\n",(0,r.jsxs)(n.p,{children:["Setup ",(0,r.jsx)(n.code,{children:"TypeScript"})," to transpile tests:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import wp from '@cypress/webpack-preprocessor'\n// cypress.config.ts\nimport { defineConfig } from 'cypress'\n\nexport default defineConfig({\n  e2e: {\n    setupNodeEvents(on, config) {\n      on(\n        'file:preprocessor',\n        wp({\n          webpackOptions: {\n            resolve: {\n              extensions: ['.ts', '.tsx', '.js', '.jsx'],\n            },\n            module: {\n              rules: [\n                {\n                  test: /\\.tsx?$/,\n                  loader: 'ts-loader',\n                  options: { transpileOnly: true },\n                },\n              ],\n            },\n          },\n        })\n      )\n    },\n  },\n})\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"AXE"})," a11y testing:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// cypress.config.ts\nimport { defineConfig } from 'cypress'\nimport fetch from 'undici'\n\nexport default defineConfig({\n  e2e: {\n    setupNodeEvents(on, config) {\n      on('task', {\n        sitemapLocations() {\n          return fetch(`${config.baseUrl}/sitemap.xml`, {\n            method: 'GET',\n            headers: {\n              'Content-Type': 'application/xml',\n            },\n          })\n            .then(res => res.text())\n            .then((xml) => {\n              const locs = [...xml.matchAll(`<loc>(.|\\n)*?</loc>`)].map(\n                ([loc]) => loc.replace('<loc>', '').replace('</loc>', '')\n              )\n              return locs\n            })\n        },\n      })\n\n      return config\n    },\n  },\n})\n\n// cypress/e2e/smoke.cy.ts\nit('should be accessible', () => {\n  cy.task('sitemapLocations').then((pages) => {\n    pages.forEach((page) => {\n      cy.visit(page)\n      cy.injectAxe()\n      cy.checkA11y(\n        {\n          exclude: ['.article-action'],\n        },\n        {\n          rules: {\n            'empty-heading': { enabled: false },\n            'scrollable-region-focusable': { enabled: false },\n          },\n        }\n      )\n    })\n  })\n})\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Cypress code coverage ",(0,r.jsx)(n.a,{href:"https://github.com/bahmutov/cypress-and-jest",children:"plugin"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Cypress commands ",(0,r.jsx)(n.a,{href:"https://github.com/testing-library/cypress-testing-library",children:"plugin"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Cypress events ",(0,r.jsx)(n.a,{href:"https://github.com/dmtrKovalenko/cypress-real-events",children:"plugin"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Cypress accessibility testing ",(0,r.jsx)(n.a,{href:"https://github.com/component-driven/cypress-axe",children:"plugin"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Cypress visual regression testing ",(0,r.jsx)(n.a,{href:"https://github.com/percy/percy-cypress",children:"plugin"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Cypress official ",(0,r.jsx)(n.a,{href:"https://learn.cypress.io",children:"guide"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Cypress CI ",(0,r.jsx)(n.a,{href:"https://github.com/cypress-io/github-action",children:"action"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Cypress real world ",(0,r.jsx)(n.a,{href:"https://github.com/cypress-io/cypress-realworld-app",children:"example"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Cypress ",(0,r.jsx)(n.a,{href:"https://github.com/cypress-io/cypress-example-recipes",children:"cookbook"}),"."]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},86145:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>l});var t=s(57140);const r={},c=t.createContext(r);function i(e){const n=t.useContext(c);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(c.Provider,{value:n},e.children)}}}]);