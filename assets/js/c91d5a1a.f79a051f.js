"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[25756],{96457:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>u,frontMatter:()=>o,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"programming/devops/docker","title":"Docker","description":"Installation","source":"@site/content/programming/devops/docker.md","sourceDirName":"programming/devops","slug":"/programming/devops/docker","permalink":"/notes/programming/devops/docker","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/programming/devops/docker.md","tags":[{"inline":true,"label":"Programming","permalink":"/notes/tags/programming"},{"inline":true,"label":"DevOps","permalink":"/notes/tags/dev-ops"},{"inline":true,"label":"Container","permalink":"/notes/tags/container"},{"inline":true,"label":"Docker","permalink":"/notes/tags/docker"},{"inline":true,"label":"Internals","permalink":"/notes/tags/internals"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"frontMatter":{"tags":["Programming","DevOps","Container","Docker","Internals"]},"sidebar":"tutorialSidebar","previous":{"title":"DevOps","permalink":"/notes/programming/devops/"},"next":{"title":"Kubernetes","permalink":"/notes/programming/devops/k8s"}}');var i=s(35656),l=s(86145);const o={tags:["Programming","DevOps","Container","Docker","Internals"]},t="Docker",c={},a=[{value:"Installation",id:"installation",level:2},{value:"Uninstallation",id:"uninstallation",level:2},{value:"Pull",id:"pull",level:2},{value:"Build",id:"build",level:2},{value:"Run",id:"run",level:2},{value:"List",id:"list",level:2},{value:"Execute",id:"execute",level:2},{value:"Remove",id:"remove",level:2},{value:"Log",id:"log",level:2},{value:"Dockerfile",id:"dockerfile",level:2},{value:"Directives",id:"directives",level:3},{value:"Hub",id:"hub",level:2},{value:"Mirrors",id:"mirrors",level:3},{value:"Internals",id:"internals",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"docker",children:"Docker"})}),"\n",(0,i.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:' sudo apt-get update\n sudo apt-get install \\\n  apt-transport-https \\\n  ca-certificates \\\n  curl \\\n  gnupg \\\n  lsb-release\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -\nsudo add-apt-repository \\\n  "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"\nsudo apt update\nsudo apt install docker-ce docker-ce-cli containerd.io\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl -fsSL https://get.docker.com -o get-docker.sh\nsudo DRY_RUN=1 sh get-docker.sh\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo systemctl status docker\nsudo usermod -aG docker $USER\n"})}),"\n",(0,i.jsx)(n.h2,{id:"uninstallation",children:"Uninstallation"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker container stop $(docker container ls -aq)\ndocker system prune -a --volumes\nsudo apt purge docker-ce docker-ce-cli containerd.io\nsudo apt autoremove\nsudo rm -rf /var/lib/docker\nsudo rm -rf /var/lib/containerd\n"})}),"\n",(0,i.jsx)(n.h2,{id:"pull",children:"Pull"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker images\ndocker images -a\ndocker search <images>\ndocker pull <images:tag>\n"})}),"\n",(0,i.jsx)(n.h2,{id:"build",children:"Build"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker build . -t image-name\n\n# use Dockerfile at the root of the repository\ndocker build <github-repo-url> -t image-name\n"})}),"\n",(0,i.jsx)(n.h2,{id:"run",children:"Run"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"run"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"start"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"stop"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"restart"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# docker run -dp <host-port>:<container-port> [docker-image]\ndocker run -d -p 80:80 --name app-name docker/getting-started\ndocker run -d -p 80:80/tcp -p 80:80/udp --name app-name docker/getting-started\n"})}),"\n",(0,i.jsx)(n.h2,{id:"list",children:"List"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker ps\ndocker ps -l\ndocker ps -a\ndocker ps -q\n"})}),"\n",(0,i.jsx)(n.h2,{id:"execute",children:"Execute"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker exec -it <container> <command>\ndocker exec -it <container> bash\n"})}),"\n",(0,i.jsx)(n.h2,{id:"remove",children:"Remove"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker rm <container>\n"})}),"\n",(0,i.jsx)(n.h2,{id:"log",children:"Log"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker logs -f <container>\n"})}),"\n",(0,i.jsx)(n.h2,{id:"dockerfile",children:"Dockerfile"}),"\n",(0,i.jsx)(n.h3,{id:"directives",children:"Directives"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"FROM"}),": source image."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ENV"}),": set environment variable."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"WORKDIR"}),": change directory."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"COPY"}),": copy file."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"RUN"}),": run command."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"CMD"}),": final command."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"EXPOSE"}),": expose port."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-Dockerfile",children:'FROM centos:7\nRUN yum -y install httpd\nCOPY index.html /usr/share/httpd/noindex/index.html\nEXPOSE 80\nCMD ["/usr/sbin/httpd", "-D", "FOREGROUND"]\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-Dockerfile",children:'FROM centos:7\nRUN rpm -Uvh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm\nRUN yum -y install nginx\nEXPOSE 80\nCMD ["nginx", "-g", "daemon off;"]\n'})}),"\n",(0,i.jsx)(n.h2,{id:"hub",children:"Hub"}),"\n",(0,i.jsx)(n.h3,{id:"mirrors",children:"Mirrors"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Docker ",(0,i.jsx)(n.a,{href:"https://github.com/dongyubin/DockerHub",children:"mirrors"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/sky22333/hubproxy",children:"HubProxy"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"internals",children:"Internals"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"Docker"})," is ",(0,i.jsx)(n.strong,{children:"process-level"})," ",(0,i.jsx)(n.code,{children:"Linux"})," virtual container:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Namespace"}),": IPC/network/PID/UTS/user isolation."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Cgroup"}),": resources control."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"rootfs"}),": file system isolation."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'// https://github.com/lizrice/containers-from-scratch\npackage main\n\nimport (\n    "fmt"\n    "io/ioutil"\n    "os"\n    "os/exec"\n    "path/filepath"\n    "strconv"\n    "syscall"\n)\n\n// go run main.go run <cmd> <args>\nfunc main() {\n    switch os.Args[1] {\n    case "run":\n        run()\n    case "child":\n        child()\n    default:\n        panic("help")\n    }\n}\n\nfunc run() {\n    fmt.Printf("Running %v \\n", os.Args[2:])\n\n    cmd := exec.Command("/proc/self/exe", append([]string{"child"}, os.Args[2:]...)...)\n    cmd.Stdin = os.Stdin\n    cmd.Stdout = os.Stdout\n    cmd.Stderr = os.Stderr\n    cmd.SysProcAttr = &syscall.SysProcAttr{\n        Cloneflags:   syscall.CLONE_NEWUTS | syscall.CLONE_NEWPID | syscall.CLONE_NEWNS,\n        Unshareflags: syscall.CLONE_NEWNS,\n    }\n\n    must(cmd.Run())\n}\n\nfunc child() {\n    fmt.Printf("Running %v \\n", os.Args[2:])\n\n    cg()\n\n    cmd := exec.Command(os.Args[2], os.Args[3:]...)\n    cmd.Stdin = os.Stdin\n    cmd.Stdout = os.Stdout\n    cmd.Stderr = os.Stderr\n\n    must(syscall.Sethostname([]byte("container")))\n    must(syscall.Chroot("/home/liz/ubuntufs"))\n    must(os.Chdir("/"))\n    must(syscall.Mount("proc", "proc", "proc", 0, ""))\n    must(syscall.Mount("thing", "myTemp", "tmpfs", 0, ""))\n\n    must(cmd.Run())\n\n    must(syscall.Unmount("proc", 0))\n    must(syscall.Unmount("thing", 0))\n}\n\nfunc cg() {\n    cgroups := "/sys/fs/cgroup/"\n    pids := filepath.Join(cgroups, "pids")\n    os.Mkdir(filepath.Join(pids, "liz"), 0755)\n    must(ioutil.WriteFile(filepath.Join(pids, "liz/pids.max"), []byte("20"), 0700))\n    // Removes the new cgroup in place after the container exits\n    must(ioutil.WriteFile(\n        filepath.Join(pids, "liz/notify_on_release"),\n        []byte("1"),\n        0700\n    ))\n    must(ioutil.WriteFile(\n        filepath.Join(pids, "liz/cgroup.procs"),\n        []byte(strconv.Itoa(os.Getpid())),\n        0700\n    ))\n}\n\nfunc must(err error) {\n    if err != nil {\n        panic(err)\n    }\n}\n'})})]})}function u(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},86145:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>t});var r=s(57140);const i={},l=r.createContext(i);function o(e){const n=r.useContext(l);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);