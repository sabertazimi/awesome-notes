"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[32874],{40314:(e,n,c)=>{c.r(n),c.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"web/react/architecture","title":"Architecture","description":"Virtual DOM","source":"@site/content/web/react/architecture.md","sourceDirName":"web/react","slug":"/web/react/architecture","permalink":"/notes/web/react/architecture","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/react/architecture.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"React","permalink":"/notes/tags/react"},{"inline":true,"label":"Internals","permalink":"/notes/tags/internals"},{"inline":true,"label":"Architecture","permalink":"/notes/tags/architecture"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":30,"frontMatter":{"sidebar_position":30,"tags":["Web","React","Internals","Architecture"]},"sidebar":"tutorialSidebar","previous":{"title":"Create React App","permalink":"/notes/web/react/cra"},"next":{"title":"Scheduler","permalink":"/notes/web/react/scheduler"}}');var i=c(35656),s=c(86145);const t={sidebar_position:30,tags:["Web","React","Internals","Architecture"]},l="Architecture",o={},a=[{value:"Virtual DOM",id:"virtual-dom",level:2},{value:"Packages",id:"packages",level:2},{value:"Workflow",id:"workflow",level:2},{value:"Create RootContainer",id:"create-rootcontainer",level:3},{value:"Legacy Root",id:"legacy-root",level:4},{value:"Concurrent Root",id:"concurrent-root",level:4},{value:"Update RootContainer",id:"update-rootcontainer",level:3},{value:"SetState",id:"setstate",level:3},{value:"ClassComponent",id:"classcomponent",level:3},{value:"FunctionComponent",id:"functioncomponent",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"architecture",children:"Architecture"})}),"\n",(0,i.jsx)(n.h2,{id:"virtual-dom",children:"Virtual DOM"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Reduce rendering times with reconciliation algorithm,\nimproving rendering efficiency:\nDeclarative UI performance = Diff performance + DOM performance,\n",(0,i.jsx)(n.code,{children:"Virtual DOM"})," \u4e3b\u8981\u662f\u4e3a\u4e86\u6700\u5c0f\u5316 Diff \u6027\u80fd\u6d88\u8017."]}),"\n",(0,i.jsx)(n.li,{children:"Cross platform code."}),"\n",(0,i.jsx)(n.li,{children:"Functional programming without details on DOM manipulation."}),"\n",(0,i.jsx)(n.li,{children:"Virtual DOM \u5f88\u591a\u65f6\u5019\u90fd\u4e0d\u662f\u6700\u4f18\u7684\u64cd\u4f5c,\n\u4f46\u5b83\u5177\u6709\u666e\u9002\u6027, \u5728\u6548\u7387\u4e0e\u53ef\u7ef4\u62a4\u6027\u4e4b\u95f4\u8fbe\u5230\u5e73\u8861."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/snabbdom/snabbdom",children:"SnabbDOM"}),":\nvirtual DOM library focus on modularity and performance."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"packages",children:"Packages"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Scheduler"})," \u8c03\u5ea6\u5668: \u8c03\u5ea6\u4efb\u52a1\u7684\u4f18\u5148\u7ea7, \u9ad8\u4f18\u4efb\u52a1\u4f18\u5148\u8fdb\u5165 ",(0,i.jsx)(n.code,{children:"Reconciler"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Reconciler"})," \u534f\u8c03\u5668:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u88c5\u8f7d ",(0,i.jsx)(n.code,{children:"Renderer"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["\u63a5\u6536 ",(0,i.jsx)(n.code,{children:"ReactDOM"})," \u548c ",(0,i.jsx)(n.code,{children:"React"})," \u6a21\u5757 (\u7528\u6237\u4ee3\u7801) \u53d1\u8d77\u7684\u66f4\u65b0\u8bf7\u6c42:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ReactFiberReconciler.updateContainer"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ReactFiberClassComponent.setState"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ReactFiberHooks.dispatchAction"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"\u627e\u51fa\u53d8\u5316\u7ec4\u4ef6, \u6784\u5efa Fiber Tree."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Renderer"})," \u6e32\u67d3\u5668:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u5f15\u5bfc ",(0,i.jsx)(n.code,{children:"React"})," \u5e94\u7528\u542f\u52a8 (e.g. ",(0,i.jsx)(n.code,{children:"ReactDOM.createRoot(rootNode).render(<App />)"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["\u5b9e\u73b0 ",(0,i.jsx)(n.code,{children:"HostConfig"})," \u534f\u8bae, \u5c06\u53d8\u5316\u7684\u7ec4\u4ef6\u6e32\u67d3\u5230\u9875\u9762\u4e0a."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\u5176\u4e2d ",(0,i.jsx)(n.code,{children:"Reconciler"})," \u6784\u5efa Fiber Tree \u7684\u8fc7\u7a0b\u88ab\u5305\u88c5\u6210\u4e00\u4e2a\u56de\u8c03\u51fd\u6570, \u4f20\u5165 ",(0,i.jsx)(n.code,{children:"Scheduler"})," \u6a21\u5757\u7b49\u5f85\u8c03\u5ea6.\n",(0,i.jsx)(n.code,{children:"Scheduler"})," \u5c06\u56de\u8c03\u51fd\u6570\u8fdb\u4e00\u6b65\u5305\u88c5\u6210\u4efb\u52a1\u5bf9\u8c61, \u653e\u5165\u591a\u4f18\u5148\u7ea7\u8c03\u5ea6\u7684\u4efb\u52a1\u961f\u5217, \u5faa\u73af\u6d88\u8d39\u4efb\u52a1\u961f\u5217, \u76f4\u81f3\u961f\u5217\u6e05\u7a7a.\nScheduler work loop (\u4efb\u52a1\u8c03\u5ea6\u5faa\u73af) \u8d1f\u8d23\u8c03\u5ea6 ",(0,i.jsx)(n.code,{children:"Task"}),",\nReconciler work loop (",(0,i.jsx)(n.code,{children:"Fiber"})," \u6784\u9020\u5faa\u73af) \u8d1f\u8d23\u5b9e\u73b0 ",(0,i.jsx)(n.code,{children:"Task"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"React"})," runtime main logic:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Updates: ",(0,i.jsx)(n.code,{children:"Add"}),"/",(0,i.jsx)(n.code,{children:"Delete"}),"/",(0,i.jsx)(n.code,{children:"Mutation"})," updates from ",(0,i.jsx)(n.code,{children:"User Code"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Registration:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Reconciler"})," receive updates request from ",(0,i.jsx)(n.code,{children:"User Code"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Scheduler"})," register new ",(0,i.jsx)(n.code,{children:"Task"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Execution:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Scheduler"})," consume ",(0,i.jsx)(n.code,{children:"Task"})," in ",(0,i.jsx)(n.code,{children:"TaskQueue"})," in work loop."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Reconciler"})," execute ",(0,i.jsx)(n.code,{children:"Task"})," work.","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Fiber"})," \u6784\u9020\u5faa\u73af: construct ",(0,i.jsx)(n.code,{children:"Fiber"})," tree."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"commitRoot"}),": render ",(0,i.jsx)(n.code,{children:"Fiber"})," tree with ",(0,i.jsx)(n.code,{children:"Renderer"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u4efb\u52a1\u8c03\u5ea6\u5faa\u73af\u4e0e ",(0,i.jsx)(n.code,{children:"Fiber"})," \u6784\u9020\u5faa\u73af\u76f8\u4e92\u914d\u5408\u53ef\u5b9e\u73b0",(0,i.jsx)(n.strong,{children:"\u53ef\u4e2d\u65ad\u6e32\u67d3"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u6e32\u67d3\u4e2d\u65ad (",(0,i.jsx)(n.code,{children:"Reconciler.renderRootConcurrent().shouldYield()"}),"):","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u5b58\u5728\u66f4\u9ad8\u4f18\u5148\u7ea7\u4efb\u52a1 (Priority Scheduling)."}),"\n",(0,i.jsx)(n.li,{children:"\u5f53\u524d\u5e27\u6ca1\u6709\u5269\u4f59\u65f6\u95f4 (Time Slicing)."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u6e32\u67d3\u6062\u590d (",(0,i.jsx)(n.code,{children:"Scheduler.workLoop()"}),"):\n\u5c06 ",(0,i.jsx)(n.code,{children:"callback()"})," \u8fd4\u56de\u7684\u4efb\u52a1\u653e\u5165\u4efb\u52a1\u961f\u5217, \u7ee7\u7eed\u8fdb\u884c\u8c03\u5ea6\u76f4\u81f3\u6e05\u7a7a\u4efb\u52a1\u961f\u5217."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://7kms.github.io/react-illustration-series/main/macro-structure",children:(0,i.jsx)(n.img,{alt:"React Core Packages",src:c(60578).A+"",width:"1918",height:"1382"})})}),"\n",(0,i.jsx)(n.h2,{id:"workflow",children:"Workflow"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://jser.dev/2023-07-14-initial-mount/#how-react-does-initial-mount-first-time-render-",children:(0,i.jsx)(n.img,{alt:"React Core Workflow",src:c(68202).A+"",width:"3560",height:"1160"})})}),"\n",(0,i.jsx)(n.h3,{id:"create-rootcontainer",children:"Create RootContainer"}),"\n",(0,i.jsx)(n.h4,{id:"legacy-root",children:"Legacy Root"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-dom/src/client/ReactDOMLegacy.js",children:"react-dom/src/client/ReactDOMLegacy"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"render"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"legacyRenderSubtreeIntoContainer."}),"\n",(0,i.jsx)(n.li,{children:"legacyCreateRootFromDOMContainer."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberReconciler.js",children:"react-reconciler/src/ReactFiberReconciler"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"createContainer"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-dom/src/client/ReactDOMComponentTree.js",children:"react-dom/src/client/ReactDOMComponentTree"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"markContainerAsRoot."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberRoot.js",children:"react-reconciler/src/ReactFiberRoot"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"createFiberRoot"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiber.js",children:"react-reconciler/src/ReactFiber"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"createHostRootFiber."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactUpdateQueue.js",children:"react-reconciler/src/ReactUpdateQueue"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"initializeUpdateQueue"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-dom/src/events/DOMPluginEventSystem.js",children:"react-dom/src/events/DOMPluginEventSystem"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"listenToAllSupportedEvents:\n\u4e8b\u4ef6\u7edf\u4e00\u5728 rootContainer \u4e0a\u5904\u7406 dispatchDiscreteEvent."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"concurrent-root",children:"Concurrent Root"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-dom/src/client/ReactDOMRoot.js",children:"react-dom/src/client/ReactDOMRoot"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"createRoot"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberReconciler.js",children:"react-reconciler/src/ReactFiberReconciler"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"createContainer"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-dom/src/client/ReactDOMComponentTree.js",children:"react-dom/src/client/ReactDOMComponentTree"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"markContainerAsRoot."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberRoot.js",children:"react-reconciler/src/ReactFiberRoot"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"createFiberRoot"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiber.js",children:"react-reconciler/src/ReactFiber"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"createHostRootFiber."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactUpdateQueue.js",children:"react-reconciler/src/ReactUpdateQueue"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"initializeUpdateQueue"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-dom/src/events/DOMPluginEventSystem.js",children:"react-dom/src/events/DOMPluginEventSystem"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"listenToAllSupportedEvents:\n\u4e8b\u4ef6\u7edf\u4e00\u5728 rootContainer \u4e0a\u5904\u7406 dispatchDiscreteEvent."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ReactDOMRoot.render(<App />)"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"update-rootcontainer",children:"Update RootContainer"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-dom/src/client/ReactDOMLegacy.js",children:"react-dom/src/client/ReactDOMLegacy"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"render."}),"\n",(0,i.jsx)(n.li,{children:"legacyRenderSubtreeIntoContainer."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-dom/src/client/ReactDOMRoot.js",children:"react-dom/src/client/ReactDOMRoot"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"render."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberReconciler.js",children:"react-reconciler/src/ReactFiberReconciler"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"updateContainer"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactUpdateQueue.js",children:"react-reconciler/src/ReactUpdateQueue"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"createUpdate."}),"\n",(0,i.jsx)(n.li,{children:"enqueueUpdate."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberWorkLoop.js",children:"react-reconciler/src/ReactFiberWorkLoop"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"scheduleUpdateOnFiber"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"ensureRootIsScheduled"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberSyncTaskQueue.js",children:"react-reconciler/src/ReactFiberSyncTaskQueue"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"flushSyncCallbacks."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberWorkLoop.js",children:"react-reconciler/src/ReactFiberWorkLoop"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"performSyncWorkOnRoot"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"renderRootSync."}),"\n",(0,i.jsx)(n.li,{children:"workLoopSync."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"performUnitOfWork"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberBeginWork.js",children:"react-reconciler/src/ReactFiberBeginWork"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"beginWork"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"updateHostRoot"}),"/",(0,i.jsx)(n.strong,{children:"updateXXXComponent"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ReactDOMComponent.createElement"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"reconcileChildren."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactChildFiber.js",children:"react-reconciler/src/ReactChildFiber"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"reconcileChildFibers."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberWorkLoop.js",children:"react-reconciler/src/ReactFiberWorkLoop"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"completeUnitOfWork"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberCompleteWork.js",children:"react-reconciler/src/ReactFiberCompleteWork"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"completeWork"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberWorkLoop.js",children:"react-reconciler/src/ReactFiberWorkLoop"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"commitRoot"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-dom/src/client/ReactDOMHostConfig.js",children:"react-dom/src/client/ReactDOMHostConfig"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"appendChildToContainer."}),"\n",(0,i.jsx)(n.li,{children:"finalizeInitialChildren."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-dom/src/client/ReactDOMComponent.js",children:"react-dom/src/client/ReactDOMComponent"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"setInitialProperties:\n\u8bbe\u7f6e\u521d\u59cb\u5316\u5c5e\u6027, \u5904\u7406\u7279\u6b8a\u5143\u7d20\u548c\u4e8b\u4ef6."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"// Legacy Mode\nimport type { ReactElement } from 'react'\nimport type { Container } from './types'\nimport Reconciler from './reconciler'\n\nconst Renderer = {\n  render: (\n    element: ReactElement,\n    container: Container | null,\n    callback?: Function\n  ): void => {\n    if (container) {\n      const root = Reconciler.createContainer(container, 0, false, null)\n      Reconciler.updateContainer(element, root, null)\n    }\n  },\n}\n\nexport default Renderer\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"// Modern Mode\nimport type { ReactElement } from 'react'\nimport type { Container, OpaqueRoot } from './types'\nimport Reconciler from './reconciler'\n\nconst Renderer = {\n  createRoot: (\n    container: Container | null,\n    callback?: Function\n  ): OpaqueRoot => {\n    if (container) {\n      const root = Reconciler.createContainer(container, 0, false, null)\n\n      root.render = function (element: ReactElement) {\n        Reconciler.updateContainer(element, this, null)\n      }\n\n      return root\n    }\n  },\n}\n\nexport default Renderer\n"})}),"\n",(0,i.jsx)(n.h3,{id:"setstate",children:"SetState"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-dom/src/events/ReactDOMEventListener.js",children:"react-dom/src/events/ReactDOMEventListener"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"dispatchDiscreteEvent."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react/src/ReactBaseClasses.js",children:"react/src/ReactBaseClasses"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"setState"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberClassComponent.js",children:"react-reconciler/src/ReactFiberClassComponent"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"enqueueSetState."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactUpdateQueue.js",children:"react-reconciler/src/ReactUpdateQueue"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"createUpdate."}),"\n",(0,i.jsx)(n.li,{children:"enqueueUpdate."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberWorkLoop.js",children:"react-reconciler/src/ReactFiberWorkLoop"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"scheduleUpdateOnFiber"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"discreteUpdates."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberSyncTaskQueue.js",children:"react-reconciler/src/ReactFiberSyncTaskQueue"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"flushSyncCallbacks."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberWorkLoop.js",children:"react-reconciler/src/ReactFiberWorkLoop"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"performSyncWorkOnRoot"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"workLoopSync."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"performUnitOfWork"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberBeginWork.js",children:"react-reconciler/src/ReactFiberBeginWork"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"beginWork"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"updateXXXComponent"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"reconcileChildren."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactChildFiber.js",children:"react-reconciler/src/ReactChildFiber"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"reconcileChildFibers."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberWorkLoop.js",children:"react-reconciler/src/ReactFiberWorkLoop"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"completeUnitOfWork"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberCompleteWork.js",children:"react-reconciler/src/ReactFiberCompleteWork"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"completeWork"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberWorkLoop.js",children:"react-reconciler/src/ReactFiberWorkLoop"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"commitRoot"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"commitMutationEffects."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberCommitWork.js",children:"react-reconciler/src/ReactFiberCommitWork"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"commitWork."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-dom/src/client/ReactDOMHostConfig.js",children:"react-dom/src/client/ReactDOMHostConfig"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"commitUpdate."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-dom/src/client/ReactDOMComponentTree.js",children:"react-dom/src/client/ReactDOMComponentTree"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"updateFiberProps."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-dom/src/client/ReactDOMComponent.js",children:"react-dom/src/client/ReactDOMComponent"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"updateProperties:\nApply diff."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"classcomponent",children:"ClassComponent"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberWorkLoop.js",children:"react-reconciler/src/ReactFiberWorkLoop"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"performSyncWorkOnRoot."}),"\n",(0,i.jsx)(n.li,{children:"workLoopSync."}),"\n",(0,i.jsx)(n.li,{children:"performUnitOfWork."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberBeginWork.js",children:"react-reconciler/src/ReactFiberBeginWork"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"beginWork"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"updateClassComponent"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberClassComponent.js",children:"react-reconciler/src/ReactFiberClassComponent"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"updateClassInstance."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberBeginWork.js",children:"react-reconciler/src/ReactFiberBeginWork"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"finishClassComponent."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"instance.render"})," (User defined Component)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"reconcileChildren"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactChildFiber.js",children:"react-reconciler/src/ReactChildFiber"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"reconcileChildFibers."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"functioncomponent",children:"FunctionComponent"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberWorkLoop.js",children:"react-reconciler/src/ReactFiberWorkLoop"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"performSyncWorkOnRoot."}),"\n",(0,i.jsx)(n.li,{children:"workLoopSync."}),"\n",(0,i.jsx)(n.li,{children:"performUnitOfWork."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberBeginWork.js",children:"react-reconciler/src/ReactFiberBeginWork"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"beginWork."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"updateFunctionComponent"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberHooks.js",children:"react-reconciler/src/ReactFiberHooks"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"renderWithHooks."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"FunctionComponent()"})," (User defined Function)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Hooks"}),": useXXX -> mountXXX -> updateXXX."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberBeginWork.js",children:"react-reconciler/src/ReactFiberBeginWork"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"reconcileChildren"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactChildFiber.js",children:"react-reconciler/src/ReactChildFiber"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"reconcileChildFibers."}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},60578:(e,n,c)=>{c.d(n,{A:()=>r});const r=c.p+"assets/images/react-core-packages-08e2adc3bb013c66966f9a71e93715c0.png"},68202:(e,n,c)=>{c.d(n,{A:()=>r});const r=c.p+"assets/images/react-core-workflow-ac78f336309ddd0c58c381bed5103e70.png"},86145:(e,n,c)=>{c.d(n,{R:()=>t,x:()=>l});var r=c(57140);const i={},s=r.createContext(i);function t(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);